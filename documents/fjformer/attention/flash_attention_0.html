<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 14.1.0"/>
    <title>fjformer.attention.flash_attention_0 API documentation</title>

    <style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
    <style>/*! syntax-highlighting.css */pre{line-height:125%;}span.linenos{color:inherit; background-color:transparent; padding-left:5px; padding-right:20px;}.pdoc-code .hll{background-color:#ffffcc}.pdoc-code{background:#f8f8f8;}.pdoc-code .c{color:#3D7B7B; font-style:italic}.pdoc-code .err{border:1px solid #FF0000}.pdoc-code .k{color:#008000; font-weight:bold}.pdoc-code .o{color:#666666}.pdoc-code .ch{color:#3D7B7B; font-style:italic}.pdoc-code .cm{color:#3D7B7B; font-style:italic}.pdoc-code .cp{color:#9C6500}.pdoc-code .cpf{color:#3D7B7B; font-style:italic}.pdoc-code .c1{color:#3D7B7B; font-style:italic}.pdoc-code .cs{color:#3D7B7B; font-style:italic}.pdoc-code .gd{color:#A00000}.pdoc-code .ge{font-style:italic}.pdoc-code .gr{color:#E40000}.pdoc-code .gh{color:#000080; font-weight:bold}.pdoc-code .gi{color:#008400}.pdoc-code .go{color:#717171}.pdoc-code .gp{color:#000080; font-weight:bold}.pdoc-code .gs{font-weight:bold}.pdoc-code .gu{color:#800080; font-weight:bold}.pdoc-code .gt{color:#0044DD}.pdoc-code .kc{color:#008000; font-weight:bold}.pdoc-code .kd{color:#008000; font-weight:bold}.pdoc-code .kn{color:#008000; font-weight:bold}.pdoc-code .kp{color:#008000}.pdoc-code .kr{color:#008000; font-weight:bold}.pdoc-code .kt{color:#B00040}.pdoc-code .m{color:#666666}.pdoc-code .s{color:#BA2121}.pdoc-code .na{color:#687822}.pdoc-code .nb{color:#008000}.pdoc-code .nc{color:#0000FF; font-weight:bold}.pdoc-code .no{color:#880000}.pdoc-code .nd{color:#AA22FF}.pdoc-code .ni{color:#717171; font-weight:bold}.pdoc-code .ne{color:#CB3F38; font-weight:bold}.pdoc-code .nf{color:#0000FF}.pdoc-code .nl{color:#767600}.pdoc-code .nn{color:#0000FF; font-weight:bold}.pdoc-code .nt{color:#008000; font-weight:bold}.pdoc-code .nv{color:#19177C}.pdoc-code .ow{color:#AA22FF; font-weight:bold}.pdoc-code .w{color:#bbbbbb}.pdoc-code .mb{color:#666666}.pdoc-code .mf{color:#666666}.pdoc-code .mh{color:#666666}.pdoc-code .mi{color:#666666}.pdoc-code .mo{color:#666666}.pdoc-code .sa{color:#BA2121}.pdoc-code .sb{color:#BA2121}.pdoc-code .sc{color:#BA2121}.pdoc-code .dl{color:#BA2121}.pdoc-code .sd{color:#BA2121; font-style:italic}.pdoc-code .s2{color:#BA2121}.pdoc-code .se{color:#AA5D1F; font-weight:bold}.pdoc-code .sh{color:#BA2121}.pdoc-code .si{color:#A45A77; font-weight:bold}.pdoc-code .sx{color:#008000}.pdoc-code .sr{color:#A45A77}.pdoc-code .s1{color:#BA2121}.pdoc-code .ss{color:#19177C}.pdoc-code .bp{color:#008000}.pdoc-code .fm{color:#0000FF}.pdoc-code .vc{color:#19177C}.pdoc-code .vg{color:#19177C}.pdoc-code .vi{color:#19177C}.pdoc-code .vm{color:#19177C}.pdoc-code .il{color:#666666}</style>
    <style>/*! theme.css */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f8f8f8;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}</style>
    <style>/*! layout.css */html, body{width:100%;height:100%;}html, main{scroll-behavior:smooth;}body{background-color:var(--pdoc-background);}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;z-index:999;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}header + main{margin-top:-3rem;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}header + main{margin-top:-4rem;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;opacity:0;}nav.pdoc{--pad:clamp(0.5rem, 2vw, 1.75rem);--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent; z-index:1}nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc > div > ul{margin-left:calc(0px - var(--pad));}nav.pdoc li a{padding:.2rem 0 .2rem calc(var(--pad) + var(--indent));}nav.pdoc > div > ul > li > a{padding-left:var(--pad);}nav.pdoc li{transition:all 100ms;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}</style>
    <style>/*! content.css */.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{cursor:pointer;display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .pdoc-alert{padding:1rem 1rem 1rem calc(1.5rem + 24px);border:1px solid transparent;border-radius:.25rem;background-repeat:no-repeat;background-position:1rem center;margin-bottom:1rem;}.pdoc .pdoc-alert > *:last-child{margin-bottom:0;}.pdoc .pdoc-alert-note {color:#084298;background-color:#cfe2ff;border-color:#b6d4fe;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23084298%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8%2016A8%208%200%201%200%208%200a8%208%200%200%200%200%2016zm.93-9.412-1%204.705c-.07.34.029.533.304.533.194%200%20.487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703%200-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381%202.29-.287zM8%205.5a1%201%200%201%201%200-2%201%201%200%200%201%200%202z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-warning{color:#664d03;background-color:#fff3cd;border-color:#ffecb5;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23664d03%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M8.982%201.566a1.13%201.13%200%200%200-1.96%200L.165%2013.233c-.457.778.091%201.767.98%201.767h13.713c.889%200%201.438-.99.98-1.767L8.982%201.566zM8%205c.535%200%20.954.462.9.995l-.35%203.507a.552.552%200%200%201-1.1%200L7.1%205.995A.905.905%200%200%201%208%205zm.002%206a1%201%200%201%201%200%202%201%201%200%200%201%200-2z%22/%3E%3C/svg%3E");}.pdoc .pdoc-alert-danger{color:#842029;background-color:#f8d7da;border-color:#f5c2c7;background-image:url("data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2224%22%20height%3D%2224%22%20fill%3D%22%23842029%22%20viewBox%3D%220%200%2016%2016%22%3E%3Cpath%20d%3D%22M5.52.359A.5.5%200%200%201%206%200h4a.5.5%200%200%201%20.474.658L8.694%206H12.5a.5.5%200%200%201%20.395.807l-7%209a.5.5%200%200%201-.873-.454L6.823%209.5H3.5a.5.5%200%200%201-.48-.641l2.5-8.5z%22/%3E%3C/svg%3E");}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc > section:not(.module-info) h1{font-size:1.5rem;font-weight:500;}.pdoc > section:not(.module-info) h2{font-size:1.4rem;font-weight:500;}.pdoc > section:not(.module-info) h3{font-size:1.3rem;font-weight:500;}.pdoc > section:not(.module-info) h4{font-size:1.2rem;}.pdoc > section:not(.module-info) h5{font-size:1.1rem;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-top:0;margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;background-color:var(--code);}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--accent);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc > section:not(.module-info){margin-bottom:1.5rem;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.view-source-toggle-state,.view-source-toggle-state ~ .pdoc-code{display:none;}.view-source-toggle-state:checked ~ .pdoc-code{display:block;}.view-source-button{display:inline-block;float:right;font-size:.75rem;line-height:1.5rem;color:var(--muted);padding:0 .4rem 0 1.3rem;cursor:pointer;text-indent:-2px;}.view-source-button > span{visibility:hidden;}.module-info .view-source-button{float:none;display:flex;justify-content:flex-end;margin:-1.2rem .4rem -.2rem 0;}.view-source-button::before{position:absolute;content:"View Source";display:list-item;list-style-type:disclosure-closed;}.view-source-toggle-state:checked ~ .attr .view-source-button::before,.view-source-toggle-state:checked ~ .view-source-button::before{list-style-type:disclosure-open;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc section:not(.module-info) .docstring{margin-left:clamp(0rem, 5vw - 2rem, 1rem);}.pdoc .docstring .pdoc-code{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target,.pdoc .pdoc-code > pre > span:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc .pdoc-code > pre > span:target{display:block;}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc *{scroll-margin:2rem;}.pdoc .pdoc-code .linenos{user-select:none;}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc section, .pdoc .classattr{position:relative;}.pdoc .headerlink{--width:clamp(1rem, 3vw, 2rem);position:absolute;top:0;left:calc(0rem - var(--width));transition:all 100ms ease-in-out;opacity:0;}.pdoc .headerlink::before{content:"#";display:block;text-align:center;width:var(--width);height:2.3rem;line-height:2.3rem;font-size:1.5rem;}.pdoc .attr:hover ~ .headerlink,.pdoc *:target > .headerlink,.pdoc .headerlink:hover{opacity:1;}.pdoc .attr{display:block;margin:.5rem 0 .5rem;padding:.4rem .4rem .4rem 1rem;background-color:var(--accent);overflow-x:auto;}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{background-color:transparent;}.pdoc .param, .pdoc .return-annotation{white-space:pre;}.pdoc .signature.multiline .param{display:block;}.pdoc .signature.condensed .param{display:inline-block;}.pdoc .annotation{color:var(--annotation);}.pdoc .view-value-toggle-state,.pdoc .view-value-toggle-state ~ .default_value{display:none;}.pdoc .view-value-toggle-state:checked ~ .default_value{display:inherit;}.pdoc .view-value-button{font-size:.5rem;vertical-align:middle;border-style:dashed;margin-top:-0.1rem;}.pdoc .view-value-button:hover{background:white;}.pdoc .view-value-button::before{content:"show";text-align:center;width:2.2em;display:inline-block;}.pdoc .view-value-toggle-state:checked ~ .view-value-button::before{content:"hide";}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
    <style>/*! custom.css */</style></head>
<body>
    <nav class="pdoc">
        <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
        <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
        <div>            <a class="pdoc-button module-list-button" href="../attention.html">
<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-left" viewBox="0 0 16 16">
  <path fill-rule="evenodd" d="M10 3.5a.5.5 0 0 0-.5-.5h-8a.5.5 0 0 0-.5.5v9a.5.5 0 0 0 .5.5h8a.5.5 0 0 0 .5-.5v-2a.5.5 0 0 1 1 0v2A1.5 1.5 0 0 1 9.5 14h-8A1.5 1.5 0 0 1 0 12.5v-9A1.5 1.5 0 0 1 1.5 2h8A1.5 1.5 0 0 1 11 3.5v2a.5.5 0 0 1-1 0v-2z"/>
  <path fill-rule="evenodd" d="M4.146 8.354a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H14.5a.5.5 0 0 1 0 1H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3z"/>
</svg>                &nbsp;fjformer.attention</a>

            <img src="https://raw.githubusercontent.com/erfanzar/FJFormer/main/logo/light-logo.png" class="logo" alt="project logo"/>

            <input type="search" placeholder="Search..." role="searchbox" aria-label="search"
                   pattern=".+" required>



            <h2>API Documentation</h2>
                <ul class="memberlist">
            <li>
                    <a class="class" href="#Array">Array</a>
                            <ul class="memberlist">
                        <li>
                                <a class="variable" href="#Array.at">at</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.all">all</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.any">any</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.argmax">argmax</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.argmin">argmin</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.argpartition">argpartition</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.argsort">argsort</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.astype">astype</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.choose">choose</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.clip">clip</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.conj">conj</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.conjugate">conjugate</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.compress">compress</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.copy">copy</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.cumprod">cumprod</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.cumsum">cumsum</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.diagonal">diagonal</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.dot">dot</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.flatten">flatten</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.item">item</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.max">max</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.mean">mean</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.min">min</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.nonzero">nonzero</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.prod">prod</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.ptp">ptp</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.ravel">ravel</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.repeat">repeat</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.reshape">reshape</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.round">round</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.searchsorted">searchsorted</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.sort">sort</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.squeeze">squeeze</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.std">std</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.sum">sum</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.swapaxes">swapaxes</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.take">take</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.trace">trace</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.transpose">transpose</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.var">var</a>
                        </li>
                        <li>
                                <a class="function" href="#Array.view">view</a>
                        </li>
                        <li>
                                <a class="variable" href="#Array.flat">flat</a>
                        </li>
                        <li>
                                <a class="variable" href="#Array.T">T</a>
                        </li>
                        <li>
                                <a class="variable" href="#Array.mT">mT</a>
                        </li>
                        <li>
                                <a class="variable" href="#Array.real">real</a>
                        </li>
                        <li>
                                <a class="variable" href="#Array.imag">imag</a>
                        </li>
                        <li>
                                <a class="variable" href="#Array.nbytes">nbytes</a>
                        </li>
                        <li>
                                <a class="variable" href="#Array.itemsize">itemsize</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="variable" href="#PRNGKey">PRNGKey</a>
            </li>
            <li>
                    <a class="variable" href="#DType">DType</a>
            </li>
            <li>
                    <a class="function" href="#dot_product_attention_queries_per_head">dot_product_attention_queries_per_head</a>
            </li>
            <li>
                    <a class="function" href="#dot_product_attention_multiquery">dot_product_attention_multiquery</a>
            </li>
            <li>
                    <a class="function" href="#dot_product_attention_multihead">dot_product_attention_multihead</a>
            </li>
    </ul>



        <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev" target="_blank">
            built with <span class="visually-hidden">pdoc</span><img
                alt="pdoc logo"
                src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
        </a>
</div>
    </nav>
    <main class="pdoc">
            <section class="module-info">
                    <h1 class="modulename">
<a href="./../../fjformer.html">fjformer</a><wbr>.<a href="./../attention.html">attention</a><wbr>.flash_attention_0    </h1>

                        <div class="docstring"><p>An implementation of memory-efficient attention.</p>

<p>Original version published here: <a href="https://arxiv.org/abs/2112.05682">https://arxiv.org/abs/2112.05682</a></p>

<p>Also known as Flash Attention: <a href="https://arxiv.org/abs/2205.14135">https://arxiv.org/abs/2205.14135</a></p>
</div>

                        <input id="mod-flash_attention_0-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">

                        <label class="view-source-button" for="mod-flash_attention_0-view-source"><span>View Source</span></label>

                        <div class="pdoc-code codehilite"><pre><span></span><span id="L-1"><a href="#L-1"><span class="linenos">  1</span></a><span class="c1"># This file is taken from the flaxformer library at</span>
</span><span id="L-2"><a href="#L-2"><span class="linenos">  2</span></a><span class="c1"># https://github.com/google/flaxformer</span>
</span><span id="L-3"><a href="#L-3"><span class="linenos">  3</span></a>
</span><span id="L-4"><a href="#L-4"><span class="linenos">  4</span></a><span class="c1"># Copyright 2023 Google LLC.</span>
</span><span id="L-5"><a href="#L-5"><span class="linenos">  5</span></a><span class="c1">#</span>
</span><span id="L-6"><a href="#L-6"><span class="linenos">  6</span></a><span class="c1"># Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span>
</span><span id="L-7"><a href="#L-7"><span class="linenos">  7</span></a><span class="c1"># you may not use this file except in compliance with the License.</span>
</span><span id="L-8"><a href="#L-8"><span class="linenos">  8</span></a><span class="c1"># You may obtain a copy of the License at</span>
</span><span id="L-9"><a href="#L-9"><span class="linenos">  9</span></a><span class="c1">#</span>
</span><span id="L-10"><a href="#L-10"><span class="linenos"> 10</span></a><span class="c1">#     http://www.apache.org/licenses/LICENSE-2.0</span>
</span><span id="L-11"><a href="#L-11"><span class="linenos"> 11</span></a><span class="c1">#</span>
</span><span id="L-12"><a href="#L-12"><span class="linenos"> 12</span></a><span class="c1"># Unless required by applicable law or agreed to in writing, software</span>
</span><span id="L-13"><a href="#L-13"><span class="linenos"> 13</span></a><span class="c1"># distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span>
</span><span id="L-14"><a href="#L-14"><span class="linenos"> 14</span></a><span class="c1"># WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span>
</span><span id="L-15"><a href="#L-15"><span class="linenos"> 15</span></a><span class="c1"># See the License for the specific language governing permissions and</span>
</span><span id="L-16"><a href="#L-16"><span class="linenos"> 16</span></a><span class="c1"># limitations under the License.</span>
</span><span id="L-17"><a href="#L-17"><span class="linenos"> 17</span></a>
</span><span id="L-18"><a href="#L-18"><span class="linenos"> 18</span></a><span class="sd">&quot;&quot;&quot;An implementation of memory-efficient attention.</span>
</span><span id="L-19"><a href="#L-19"><span class="linenos"> 19</span></a>
</span><span id="L-20"><a href="#L-20"><span class="linenos"> 20</span></a><span class="sd">Original version published here: https://arxiv.org/abs/2112.05682</span>
</span><span id="L-21"><a href="#L-21"><span class="linenos"> 21</span></a>
</span><span id="L-22"><a href="#L-22"><span class="linenos"> 22</span></a><span class="sd">Also known as Flash Attention: https://arxiv.org/abs/2205.14135</span>
</span><span id="L-23"><a href="#L-23"><span class="linenos"> 23</span></a><span class="sd">&quot;&quot;&quot;</span>
</span><span id="L-24"><a href="#L-24"><span class="linenos"> 24</span></a>
</span><span id="L-25"><a href="#L-25"><span class="linenos"> 25</span></a><span class="kn">import</span> <span class="nn">functools</span>
</span><span id="L-26"><a href="#L-26"><span class="linenos"> 26</span></a><span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">NamedTuple</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Any</span>
</span><span id="L-27"><a href="#L-27"><span class="linenos"> 27</span></a>
</span><span id="L-28"><a href="#L-28"><span class="linenos"> 28</span></a><span class="kn">import</span> <span class="nn">jax</span>
</span><span id="L-29"><a href="#L-29"><span class="linenos"> 29</span></a><span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">lax</span>
</span><span id="L-30"><a href="#L-30"><span class="linenos"> 30</span></a><span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">jnp</span>
</span><span id="L-31"><a href="#L-31"><span class="linenos"> 31</span></a><span class="kn">from</span> <span class="nn">jax</span> <span class="kn">import</span> <span class="n">random</span>
</span><span id="L-32"><a href="#L-32"><span class="linenos"> 32</span></a>
</span><span id="L-33"><a href="#L-33"><span class="linenos"> 33</span></a><span class="n">Array</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span>
</span><span id="L-34"><a href="#L-34"><span class="linenos"> 34</span></a><span class="n">PRNGKey</span> <span class="o">=</span> <span class="n">Any</span>
</span><span id="L-35"><a href="#L-35"><span class="linenos"> 35</span></a><span class="n">DType</span> <span class="o">=</span> <span class="n">Any</span>
</span><span id="L-36"><a href="#L-36"><span class="linenos"> 36</span></a>
</span><span id="L-37"><a href="#L-37"><span class="linenos"> 37</span></a>
</span><span id="L-38"><a href="#L-38"><span class="linenos"> 38</span></a><span class="k">def</span> <span class="nf">_causal_bias</span><span class="p">(</span>
</span><span id="L-39"><a href="#L-39"><span class="linenos"> 39</span></a>        <span class="n">q_len</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-40"><a href="#L-40"><span class="linenos"> 40</span></a>        <span class="n">k_len</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-41"><a href="#L-41"><span class="linenos"> 41</span></a>        <span class="n">offset</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-42"><a href="#L-42"><span class="linenos"> 42</span></a>        <span class="n">mask_to_bias_factor</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e6</span><span class="p">,</span>
</span><span id="L-43"><a href="#L-43"><span class="linenos"> 43</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="L-44"><a href="#L-44"><span class="linenos"> 44</span></a>    <span class="n">q_idxs</span> <span class="o">=</span> <span class="n">lax</span><span class="o">.</span><span class="n">broadcasted_iota</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="n">q_len</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">dimension</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="L-45"><a href="#L-45"><span class="linenos"> 45</span></a>    <span class="n">k_idxs</span> <span class="o">=</span> <span class="n">lax</span><span class="o">.</span><span class="n">broadcasted_iota</span><span class="p">(</span><span class="n">dtype</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">int32</span><span class="p">,</span> <span class="n">shape</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">k_len</span><span class="p">),</span> <span class="n">dimension</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-46"><a href="#L-46"><span class="linenos"> 46</span></a>    <span class="k">if</span> <span class="n">offset</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-47"><a href="#L-47"><span class="linenos"> 47</span></a>        <span class="n">q_idxs</span> <span class="o">+=</span> <span class="n">offset</span>
</span><span id="L-48"><a href="#L-48"><span class="linenos"> 48</span></a>    <span class="n">inverted_mask</span> <span class="o">=</span> <span class="n">q_idxs</span> <span class="o">&lt;</span> <span class="n">k_idxs</span>  <span class="c1"># broadcasts to shape (q_len, k_len)</span>
</span><span id="L-49"><a href="#L-49"><span class="linenos"> 49</span></a>    <span class="k">return</span> <span class="n">inverted_mask</span> <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">mask_to_bias_factor</span><span class="p">)</span>
</span><span id="L-50"><a href="#L-50"><span class="linenos"> 50</span></a>
</span><span id="L-51"><a href="#L-51"><span class="linenos"> 51</span></a>
</span><span id="L-52"><a href="#L-52"><span class="linenos"> 52</span></a><span class="k">def</span> <span class="nf">_local_causal_bias</span><span class="p">(</span>
</span><span id="L-53"><a href="#L-53"><span class="linenos"> 53</span></a>        <span class="n">q_len</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-54"><a href="#L-54"><span class="linenos"> 54</span></a>        <span class="n">k_len</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-55"><a href="#L-55"><span class="linenos"> 55</span></a>        <span class="n">query_offset</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-56"><a href="#L-56"><span class="linenos"> 56</span></a>        <span class="n">key_offset</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-57"><a href="#L-57"><span class="linenos"> 57</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="L-58"><a href="#L-58"><span class="linenos"> 58</span></a>    <span class="n">offset</span> <span class="o">=</span> <span class="n">query_offset</span> <span class="o">-</span> <span class="n">key_offset</span>
</span><span id="L-59"><a href="#L-59"><span class="linenos"> 59</span></a>    <span class="k">return</span> <span class="n">_causal_bias</span><span class="p">(</span><span class="n">q_len</span><span class="p">,</span> <span class="n">k_len</span><span class="p">,</span> <span class="n">offset</span><span class="o">=</span><span class="n">offset</span><span class="p">)</span>
</span><span id="L-60"><a href="#L-60"><span class="linenos"> 60</span></a>
</span><span id="L-61"><a href="#L-61"><span class="linenos"> 61</span></a>
</span><span id="L-62"><a href="#L-62"><span class="linenos"> 62</span></a><span class="k">class</span> <span class="nc">_AttentionSummary</span><span class="p">(</span><span class="n">NamedTuple</span><span class="p">):</span>
</span><span id="L-63"><a href="#L-63"><span class="linenos"> 63</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;The summary of the attention over a segment of keys and values.&quot;&quot;&quot;</span>
</span><span id="L-64"><a href="#L-64"><span class="linenos"> 64</span></a>
</span><span id="L-65"><a href="#L-65"><span class="linenos"> 65</span></a>    <span class="c1"># Sum of the values weighted by the exponentiated scores. Array of shape</span>
</span><span id="L-66"><a href="#L-66"><span class="linenos"> 66</span></a>    <span class="c1"># `[batch, queries, heads, queries_per_head, value_features]`.</span>
</span><span id="L-67"><a href="#L-67"><span class="linenos"> 67</span></a>    <span class="n">numerator</span><span class="p">:</span> <span class="n">Array</span>
</span><span id="L-68"><a href="#L-68"><span class="linenos"> 68</span></a>    <span class="c1"># Sum of the exponentiated scores per query. Array of shape</span>
</span><span id="L-69"><a href="#L-69"><span class="linenos"> 69</span></a>    <span class="c1"># `[batch, queries, heads, queries_per_head]`.</span>
</span><span id="L-70"><a href="#L-70"><span class="linenos"> 70</span></a>    <span class="n">denominator</span><span class="p">:</span> <span class="n">Array</span>
</span><span id="L-71"><a href="#L-71"><span class="linenos"> 71</span></a>    <span class="c1"># Maximum score encountered per query. Array of shape</span>
</span><span id="L-72"><a href="#L-72"><span class="linenos"> 72</span></a>    <span class="c1"># `[batch, queries, heads, queries_per_head]`.</span>
</span><span id="L-73"><a href="#L-73"><span class="linenos"> 73</span></a>    <span class="n">max_so_far</span><span class="p">:</span> <span class="n">Array</span>
</span><span id="L-74"><a href="#L-74"><span class="linenos"> 74</span></a>
</span><span id="L-75"><a href="#L-75"><span class="linenos"> 75</span></a>
</span><span id="L-76"><a href="#L-76"><span class="linenos"> 76</span></a><span class="k">def</span> <span class="nf">_summarize_chunk</span><span class="p">(</span>
</span><span id="L-77"><a href="#L-77"><span class="linenos"> 77</span></a>        <span class="n">query</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
</span><span id="L-78"><a href="#L-78"><span class="linenos"> 78</span></a>        <span class="n">key</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
</span><span id="L-79"><a href="#L-79"><span class="linenos"> 79</span></a>        <span class="n">value</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
</span><span id="L-80"><a href="#L-80"><span class="linenos"> 80</span></a>        <span class="n">current_summary</span><span class="p">:</span> <span class="n">_AttentionSummary</span><span class="p">,</span>
</span><span id="L-81"><a href="#L-81"><span class="linenos"> 81</span></a>        <span class="n">bias</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">],</span>
</span><span id="L-82"><a href="#L-82"><span class="linenos"> 82</span></a>        <span class="n">precision</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-83"><a href="#L-83"><span class="linenos"> 83</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_AttentionSummary</span><span class="p">:</span>
</span><span id="L-84"><a href="#L-84"><span class="linenos"> 84</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Attention for a segment of queries, keys, and values.</span>
</span><span id="L-85"><a href="#L-85"><span class="linenos"> 85</span></a>
</span><span id="L-86"><a href="#L-86"><span class="linenos"> 86</span></a><span class="sd">    Args:</span>
</span><span id="L-87"><a href="#L-87"><span class="linenos"> 87</span></a><span class="sd">        query: An array of shape `[batch, q_length, heads, queries_per_head,</span>
</span><span id="L-88"><a href="#L-88"><span class="linenos"> 88</span></a><span class="sd">            qk_depth_per_head]`.</span>
</span><span id="L-89"><a href="#L-89"><span class="linenos"> 89</span></a><span class="sd">        key: An array of shape `[batch, kv_length, heads, qk_depth_per_head]`.</span>
</span><span id="L-90"><a href="#L-90"><span class="linenos"> 90</span></a><span class="sd">        value: An array of shape `[batch, kv_length, heads, v_depth_per_head]`.</span>
</span><span id="L-91"><a href="#L-91"><span class="linenos"> 91</span></a><span class="sd">        current_summary: The partially summarized queries so far, before adding the</span>
</span><span id="L-92"><a href="#L-92"><span class="linenos"> 92</span></a><span class="sd">            summarization of this kv chunk.</span>
</span><span id="L-93"><a href="#L-93"><span class="linenos"> 93</span></a><span class="sd">        bias: bias for the attention weights. This should be broadcastable to the</span>
</span><span id="L-94"><a href="#L-94"><span class="linenos"> 94</span></a><span class="sd">            shape `[batch, heads, queries_per_head, q_length, kv_length]` This can be</span>
</span><span id="L-95"><a href="#L-95"><span class="linenos"> 95</span></a><span class="sd">            used for incorporating causal masks, padding masks, proximity bias, etc.</span>
</span><span id="L-96"><a href="#L-96"><span class="linenos"> 96</span></a><span class="sd">        precision: numerical precision of the computation see `jax.lax.Precision`</span>
</span><span id="L-97"><a href="#L-97"><span class="linenos"> 97</span></a><span class="sd">            for details.</span>
</span><span id="L-98"><a href="#L-98"><span class="linenos"> 98</span></a>
</span><span id="L-99"><a href="#L-99"><span class="linenos"> 99</span></a><span class="sd">    Returns:</span>
</span><span id="L-100"><a href="#L-100"><span class="linenos">100</span></a><span class="sd">        The summary for this segment, consisting of sum of the sum of the</span>
</span><span id="L-101"><a href="#L-101"><span class="linenos">101</span></a><span class="sd">        values weighted by their exponentiated attention scores, the exponentiated</span>
</span><span id="L-102"><a href="#L-102"><span class="linenos">102</span></a><span class="sd">        attention scores, and the maximum score of this segment.</span>
</span><span id="L-103"><a href="#L-103"><span class="linenos">103</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-104"><a href="#L-104"><span class="linenos">104</span></a>    <span class="n">batch</span><span class="p">,</span> <span class="n">q_len</span><span class="p">,</span> <span class="n">q_heads</span><span class="p">,</span> <span class="n">queries_per_head</span><span class="p">,</span> <span class="n">q_feat</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-105"><a href="#L-105"><span class="linenos">105</span></a>    <span class="k">del</span> <span class="n">q_feat</span>
</span><span id="L-106"><a href="#L-106"><span class="linenos">106</span></a>    <span class="n">_</span><span class="p">,</span> <span class="n">kv_len</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">v_feat</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-107"><a href="#L-107"><span class="linenos">107</span></a>
</span><span id="L-108"><a href="#L-108"><span class="linenos">108</span></a>    <span class="p">(</span><span class="n">numerator</span><span class="p">,</span> <span class="n">denominator</span><span class="p">,</span> <span class="n">max_so_far</span><span class="p">)</span> <span class="o">=</span> <span class="n">current_summary</span>
</span><span id="L-109"><a href="#L-109"><span class="linenos">109</span></a>
</span><span id="L-110"><a href="#L-110"><span class="linenos">110</span></a>    <span class="n">attn_weights</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
</span><span id="L-111"><a href="#L-111"><span class="linenos">111</span></a>        <span class="s1">&#39;bqhnd,bkhd-&gt;bqhnk&#39;</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span>
</span><span id="L-112"><a href="#L-112"><span class="linenos">112</span></a>    <span class="p">)</span>
</span><span id="L-113"><a href="#L-113"><span class="linenos">113</span></a>
</span><span id="L-114"><a href="#L-114"><span class="linenos">114</span></a>    <span class="k">if</span> <span class="n">bias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-115"><a href="#L-115"><span class="linenos">115</span></a>        <span class="n">bias</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">bias</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>  <span class="c1"># move sequence length outside</span>
</span><span id="L-116"><a href="#L-116"><span class="linenos">116</span></a>        <span class="n">attn_weights</span> <span class="o">+=</span> <span class="n">bias</span>
</span><span id="L-117"><a href="#L-117"><span class="linenos">117</span></a>
</span><span id="L-118"><a href="#L-118"><span class="linenos">118</span></a>    <span class="n">previous_max</span> <span class="o">=</span> <span class="n">max_so_far</span>
</span><span id="L-119"><a href="#L-119"><span class="linenos">119</span></a>    <span class="k">assert</span> <span class="n">previous_max</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">q_len</span><span class="p">,</span> <span class="n">q_heads</span><span class="p">,</span> <span class="n">queries_per_head</span><span class="p">)</span>
</span><span id="L-120"><a href="#L-120"><span class="linenos">120</span></a>    <span class="n">chunk_maxima</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">attn_weights</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-121"><a href="#L-121"><span class="linenos">121</span></a>    <span class="k">assert</span> <span class="n">chunk_maxima</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">q_len</span><span class="p">,</span> <span class="n">q_heads</span><span class="p">,</span> <span class="n">queries_per_head</span><span class="p">)</span>
</span><span id="L-122"><a href="#L-122"><span class="linenos">122</span></a>    <span class="n">max_so_far</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">max_so_far</span><span class="p">,</span> <span class="n">chunk_maxima</span><span class="p">)</span>
</span><span id="L-123"><a href="#L-123"><span class="linenos">123</span></a>    <span class="n">max_so_far</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">stop_gradient</span><span class="p">(</span><span class="n">max_so_far</span><span class="p">)</span>
</span><span id="L-124"><a href="#L-124"><span class="linenos">124</span></a>    <span class="n">correction</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">previous_max</span> <span class="o">-</span> <span class="n">max_so_far</span><span class="p">)</span>
</span><span id="L-125"><a href="#L-125"><span class="linenos">125</span></a>    <span class="k">assert</span> <span class="n">correction</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">q_len</span><span class="p">,</span> <span class="n">q_heads</span><span class="p">,</span> <span class="n">queries_per_head</span><span class="p">)</span>
</span><span id="L-126"><a href="#L-126"><span class="linenos">126</span></a>
</span><span id="L-127"><a href="#L-127"><span class="linenos">127</span></a>    <span class="n">corrected_weights</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
</span><span id="L-128"><a href="#L-128"><span class="linenos">128</span></a>        <span class="n">attn_weights</span> <span class="o">-</span> <span class="n">max_so_far</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
</span><span id="L-129"><a href="#L-129"><span class="linenos">129</span></a>    <span class="p">)</span>
</span><span id="L-130"><a href="#L-130"><span class="linenos">130</span></a>
</span><span id="L-131"><a href="#L-131"><span class="linenos">131</span></a>    <span class="k">assert</span> <span class="n">corrected_weights</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span>
</span><span id="L-132"><a href="#L-132"><span class="linenos">132</span></a>        <span class="n">batch</span><span class="p">,</span>
</span><span id="L-133"><a href="#L-133"><span class="linenos">133</span></a>        <span class="n">q_len</span><span class="p">,</span>
</span><span id="L-134"><a href="#L-134"><span class="linenos">134</span></a>        <span class="n">q_heads</span><span class="p">,</span>
</span><span id="L-135"><a href="#L-135"><span class="linenos">135</span></a>        <span class="n">queries_per_head</span><span class="p">,</span>
</span><span id="L-136"><a href="#L-136"><span class="linenos">136</span></a>        <span class="n">kv_len</span><span class="p">,</span>
</span><span id="L-137"><a href="#L-137"><span class="linenos">137</span></a>    <span class="p">)</span>
</span><span id="L-138"><a href="#L-138"><span class="linenos">138</span></a>
</span><span id="L-139"><a href="#L-139"><span class="linenos">139</span></a>    <span class="n">expected_numerator_shape</span> <span class="o">=</span> <span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">q_len</span><span class="p">,</span> <span class="n">q_heads</span><span class="p">,</span> <span class="n">queries_per_head</span><span class="p">,</span> <span class="n">v_feat</span><span class="p">)</span>
</span><span id="L-140"><a href="#L-140"><span class="linenos">140</span></a>    <span class="k">assert</span> <span class="n">numerator</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">expected_numerator_shape</span><span class="p">,</span> <span class="p">(</span>
</span><span id="L-141"><a href="#L-141"><span class="linenos">141</span></a>        <span class="sa">f</span><span class="s1">&#39;numerator.shape is </span><span class="si">{</span><span class="n">numerator</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">, but expected&#39;</span>
</span><span id="L-142"><a href="#L-142"><span class="linenos">142</span></a>        <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">expected_numerator_shape</span><span class="si">}</span><span class="s1">.&#39;</span>
</span><span id="L-143"><a href="#L-143"><span class="linenos">143</span></a>    <span class="p">)</span>
</span><span id="L-144"><a href="#L-144"><span class="linenos">144</span></a>
</span><span id="L-145"><a href="#L-145"><span class="linenos">145</span></a>    <span class="n">numerator</span> <span class="o">=</span> <span class="n">numerator</span> <span class="o">*</span> <span class="n">correction</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
</span><span id="L-146"><a href="#L-146"><span class="linenos">146</span></a>    <span class="n">numerator</span> <span class="o">=</span> <span class="n">numerator</span> <span class="o">+</span> <span class="n">jnp</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span>
</span><span id="L-147"><a href="#L-147"><span class="linenos">147</span></a>        <span class="s1">&#39;bqhnv,bvhf-&gt;bqhnf&#39;</span><span class="p">,</span> <span class="n">corrected_weights</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span>
</span><span id="L-148"><a href="#L-148"><span class="linenos">148</span></a>    <span class="p">)</span>
</span><span id="L-149"><a href="#L-149"><span class="linenos">149</span></a>
</span><span id="L-150"><a href="#L-150"><span class="linenos">150</span></a>    <span class="k">assert</span> <span class="n">denominator</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">q_len</span><span class="p">,</span> <span class="n">q_heads</span><span class="p">,</span> <span class="n">queries_per_head</span><span class="p">)</span>
</span><span id="L-151"><a href="#L-151"><span class="linenos">151</span></a>    <span class="n">denominator</span> <span class="o">=</span> <span class="n">denominator</span> <span class="o">*</span> <span class="n">correction</span>
</span><span id="L-152"><a href="#L-152"><span class="linenos">152</span></a>    <span class="n">denominator</span> <span class="o">=</span> <span class="n">denominator</span> <span class="o">+</span> <span class="n">corrected_weights</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="L-153"><a href="#L-153"><span class="linenos">153</span></a>
</span><span id="L-154"><a href="#L-154"><span class="linenos">154</span></a>    <span class="k">return</span> <span class="n">_AttentionSummary</span><span class="p">(</span>
</span><span id="L-155"><a href="#L-155"><span class="linenos">155</span></a>        <span class="n">numerator</span><span class="p">,</span>
</span><span id="L-156"><a href="#L-156"><span class="linenos">156</span></a>        <span class="n">denominator</span><span class="p">,</span>
</span><span id="L-157"><a href="#L-157"><span class="linenos">157</span></a>        <span class="n">max_so_far</span><span class="p">,</span>
</span><span id="L-158"><a href="#L-158"><span class="linenos">158</span></a>    <span class="p">)</span>
</span><span id="L-159"><a href="#L-159"><span class="linenos">159</span></a>
</span><span id="L-160"><a href="#L-160"><span class="linenos">160</span></a>
</span><span id="L-161"><a href="#L-161"><span class="linenos">161</span></a><span class="k">def</span> <span class="nf">_memory_efficient_attention</span><span class="p">(</span>
</span><span id="L-162"><a href="#L-162"><span class="linenos">162</span></a>        <span class="n">query</span><span class="p">,</span>
</span><span id="L-163"><a href="#L-163"><span class="linenos">163</span></a>        <span class="n">key</span><span class="p">,</span>
</span><span id="L-164"><a href="#L-164"><span class="linenos">164</span></a>        <span class="n">value</span><span class="p">,</span>
</span><span id="L-165"><a href="#L-165"><span class="linenos">165</span></a>        <span class="n">bias_fn</span><span class="p">:</span> <span class="n">Callable</span><span class="p">[[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="n">Array</span><span class="p">],</span>
</span><span id="L-166"><a href="#L-166"><span class="linenos">166</span></a>        <span class="n">query_chunk_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-167"><a href="#L-167"><span class="linenos">167</span></a>        <span class="n">key_chunk_size</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-168"><a href="#L-168"><span class="linenos">168</span></a>        <span class="n">precision</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
</span><span id="L-169"><a href="#L-169"><span class="linenos">169</span></a>        <span class="n">dtype</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
</span><span id="L-170"><a href="#L-170"><span class="linenos">170</span></a>        <span class="n">use_extra_logit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-171"><a href="#L-171"><span class="linenos">171</span></a>        <span class="n">causal_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-172"><a href="#L-172"><span class="linenos">172</span></a><span class="p">):</span>
</span><span id="L-173"><a href="#L-173"><span class="linenos">173</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes dot-product multiquery-attention given query, key, and value.&quot;&quot;&quot;</span>
</span><span id="L-174"><a href="#L-174"><span class="linenos">174</span></a>    <span class="n">batch</span><span class="p">,</span> <span class="n">num_q</span><span class="p">,</span> <span class="n">heads</span><span class="p">,</span> <span class="n">queries_per_head</span><span class="p">,</span> <span class="n">q_feat</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-175"><a href="#L-175"><span class="linenos">175</span></a>    <span class="n">batch</span><span class="p">,</span> <span class="n">num_kv</span><span class="p">,</span> <span class="n">heads</span><span class="p">,</span> <span class="n">k_features</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-176"><a href="#L-176"><span class="linenos">176</span></a>    <span class="n">batch</span><span class="p">,</span> <span class="n">num_kv</span><span class="p">,</span> <span class="n">heads</span><span class="p">,</span> <span class="n">v_features</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-177"><a href="#L-177"><span class="linenos">177</span></a>
</span><span id="L-178"><a href="#L-178"><span class="linenos">178</span></a>    <span class="n">num_q_chunks</span> <span class="o">=</span> <span class="n">num_q</span> <span class="o">//</span> <span class="n">query_chunk_size</span>
</span><span id="L-179"><a href="#L-179"><span class="linenos">179</span></a>    <span class="n">num_kv_chunks</span> <span class="o">=</span> <span class="n">num_kv</span> <span class="o">//</span> <span class="n">key_chunk_size</span>
</span><span id="L-180"><a href="#L-180"><span class="linenos">180</span></a>
</span><span id="L-181"><a href="#L-181"><span class="linenos">181</span></a>    <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
</span><span id="L-182"><a href="#L-182"><span class="linenos">182</span></a>        <span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">num_q_chunks</span><span class="p">,</span> <span class="n">query_chunk_size</span><span class="p">,</span> <span class="n">heads</span><span class="p">,</span> <span class="n">queries_per_head</span><span class="p">,</span> <span class="n">q_feat</span><span class="p">)</span>
</span><span id="L-183"><a href="#L-183"><span class="linenos">183</span></a>    <span class="p">)</span>
</span><span id="L-184"><a href="#L-184"><span class="linenos">184</span></a>    <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="n">batch</span><span class="p">,</span> <span class="n">num_kv_chunks</span><span class="p">,</span> <span class="n">key_chunk_size</span><span class="p">,</span> <span class="n">heads</span><span class="p">,</span> <span class="n">k_features</span><span class="p">))</span>
</span><span id="L-185"><a href="#L-185"><span class="linenos">185</span></a>    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span>
</span><span id="L-186"><a href="#L-186"><span class="linenos">186</span></a>        <span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">num_kv_chunks</span><span class="p">,</span> <span class="n">key_chunk_size</span><span class="p">,</span> <span class="n">heads</span><span class="p">,</span> <span class="n">v_features</span><span class="p">)</span>
</span><span id="L-187"><a href="#L-187"><span class="linenos">187</span></a>    <span class="p">)</span>
</span><span id="L-188"><a href="#L-188"><span class="linenos">188</span></a>    <span class="c1"># We move the chunk_idx axis to the front to iterate over it with lax.map.</span>
</span><span id="L-189"><a href="#L-189"><span class="linenos">189</span></a>    <span class="n">query</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-190"><a href="#L-190"><span class="linenos">190</span></a>    <span class="n">key</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-191"><a href="#L-191"><span class="linenos">191</span></a>    <span class="n">value</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="L-192"><a href="#L-192"><span class="linenos">192</span></a>
</span><span id="L-193"><a href="#L-193"><span class="linenos">193</span></a>    <span class="c1"># The zero_chunk is the output of _summarize_chunk when the inputs are zeros.</span>
</span><span id="L-194"><a href="#L-194"><span class="linenos">194</span></a>    <span class="c1"># We define the zero_chunk outside the loops to prevent the compiler from</span>
</span><span id="L-195"><a href="#L-195"><span class="linenos">195</span></a>    <span class="c1"># re-creating these arrays in every loop iteration.</span>
</span><span id="L-196"><a href="#L-196"><span class="linenos">196</span></a>    <span class="n">zero_chunk</span> <span class="o">=</span> <span class="n">_AttentionSummary</span><span class="p">(</span>
</span><span id="L-197"><a href="#L-197"><span class="linenos">197</span></a>        <span class="c1"># numerator</span>
</span><span id="L-198"><a href="#L-198"><span class="linenos">198</span></a>        <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
</span><span id="L-199"><a href="#L-199"><span class="linenos">199</span></a>            <span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">query_chunk_size</span><span class="p">,</span> <span class="n">heads</span><span class="p">,</span> <span class="n">queries_per_head</span><span class="p">,</span> <span class="n">v_features</span><span class="p">),</span>
</span><span id="L-200"><a href="#L-200"><span class="linenos">200</span></a>            <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
</span><span id="L-201"><a href="#L-201"><span class="linenos">201</span></a>        <span class="p">),</span>
</span><span id="L-202"><a href="#L-202"><span class="linenos">202</span></a>        <span class="c1"># denominator</span>
</span><span id="L-203"><a href="#L-203"><span class="linenos">203</span></a>        <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
</span><span id="L-204"><a href="#L-204"><span class="linenos">204</span></a>            <span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">query_chunk_size</span><span class="p">,</span> <span class="n">heads</span><span class="p">,</span> <span class="n">queries_per_head</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span>
</span><span id="L-205"><a href="#L-205"><span class="linenos">205</span></a>        <span class="p">),</span>
</span><span id="L-206"><a href="#L-206"><span class="linenos">206</span></a>        <span class="c1"># max_so_far</span>
</span><span id="L-207"><a href="#L-207"><span class="linenos">207</span></a>        <span class="p">(</span><span class="o">-</span><span class="n">jnp</span><span class="o">.</span><span class="n">inf</span><span class="p">)</span>
</span><span id="L-208"><a href="#L-208"><span class="linenos">208</span></a>        <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span>
</span><span id="L-209"><a href="#L-209"><span class="linenos">209</span></a>            <span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">query_chunk_size</span><span class="p">,</span> <span class="n">heads</span><span class="p">,</span> <span class="n">queries_per_head</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span>
</span><span id="L-210"><a href="#L-210"><span class="linenos">210</span></a>        <span class="p">),</span>
</span><span id="L-211"><a href="#L-211"><span class="linenos">211</span></a>    <span class="p">)</span>
</span><span id="L-212"><a href="#L-212"><span class="linenos">212</span></a>
</span><span id="L-213"><a href="#L-213"><span class="linenos">213</span></a>    <span class="k">def</span> <span class="nf">_query_chunk_attention</span><span class="p">(</span><span class="n">args</span><span class="p">):</span>
</span><span id="L-214"><a href="#L-214"><span class="linenos">214</span></a>        <span class="n">query_chunk</span><span class="p">,</span> <span class="n">query_chunk_idx</span> <span class="o">=</span> <span class="n">args</span>
</span><span id="L-215"><a href="#L-215"><span class="linenos">215</span></a>
</span><span id="L-216"><a href="#L-216"><span class="linenos">216</span></a>        <span class="nd">@functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">checkpoint</span><span class="p">,</span> <span class="n">prevent_cse</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-217"><a href="#L-217"><span class="linenos">217</span></a>        <span class="k">def</span> <span class="nf">conditional_summarize_fn</span><span class="p">(</span><span class="n">carry</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span>
</span><span id="L-218"><a href="#L-218"><span class="linenos">218</span></a>            <span class="n">key_chunk</span><span class="p">,</span> <span class="n">value_chunk</span><span class="p">,</span> <span class="n">key_chunk_idx</span> <span class="o">=</span> <span class="n">args</span>
</span><span id="L-219"><a href="#L-219"><span class="linenos">219</span></a>
</span><span id="L-220"><a href="#L-220"><span class="linenos">220</span></a>            <span class="n">skip_block</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
</span><span id="L-221"><a href="#L-221"><span class="linenos">221</span></a>            <span class="k">if</span> <span class="n">causal_mask</span><span class="p">:</span>
</span><span id="L-222"><a href="#L-222"><span class="linenos">222</span></a>                <span class="n">skip_block</span> <span class="o">=</span> <span class="n">query_chunk_idx</span> <span class="o">&lt;</span> <span class="n">key_chunk_idx</span>
</span><span id="L-223"><a href="#L-223"><span class="linenos">223</span></a>
</span><span id="L-224"><a href="#L-224"><span class="linenos">224</span></a>            <span class="k">def</span> <span class="nf">cond_fn</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">carry</span><span class="p">,</span> <span class="n">key_chunk_idx</span><span class="p">):</span>
</span><span id="L-225"><a href="#L-225"><span class="linenos">225</span></a>                <span class="k">with</span> <span class="n">jax</span><span class="o">.</span><span class="n">named_scope</span><span class="p">(</span><span class="s1">&#39;compute_bias&#39;</span><span class="p">):</span>
</span><span id="L-226"><a href="#L-226"><span class="linenos">226</span></a>                    <span class="n">chunk_bias</span> <span class="o">=</span> <span class="n">bias_fn</span><span class="p">(</span><span class="n">query_chunk_idx</span><span class="p">,</span> <span class="n">key_chunk_idx</span><span class="p">)</span>
</span><span id="L-227"><a href="#L-227"><span class="linenos">227</span></a>                <span class="k">return</span> <span class="p">(</span>
</span><span id="L-228"><a href="#L-228"><span class="linenos">228</span></a>                    <span class="n">_summarize_chunk</span><span class="p">(</span>
</span><span id="L-229"><a href="#L-229"><span class="linenos">229</span></a>                        <span class="n">query</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">carry</span><span class="p">,</span> <span class="n">chunk_bias</span><span class="p">,</span> <span class="n">precision</span><span class="o">=</span><span class="n">precision</span>
</span><span id="L-230"><a href="#L-230"><span class="linenos">230</span></a>                    <span class="p">),</span>
</span><span id="L-231"><a href="#L-231"><span class="linenos">231</span></a>                    <span class="kc">None</span><span class="p">,</span>
</span><span id="L-232"><a href="#L-232"><span class="linenos">232</span></a>                <span class="p">)</span>
</span><span id="L-233"><a href="#L-233"><span class="linenos">233</span></a>
</span><span id="L-234"><a href="#L-234"><span class="linenos">234</span></a>            <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">cond</span><span class="p">(</span>
</span><span id="L-235"><a href="#L-235"><span class="linenos">235</span></a>                <span class="n">skip_block</span><span class="p">,</span>
</span><span id="L-236"><a href="#L-236"><span class="linenos">236</span></a>                <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">carry</span><span class="p">,</span> <span class="n">d</span><span class="p">:</span> <span class="p">(</span><span class="n">carry</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span>
</span><span id="L-237"><a href="#L-237"><span class="linenos">237</span></a>                <span class="n">cond_fn</span><span class="p">,</span>
</span><span id="L-238"><a href="#L-238"><span class="linenos">238</span></a>                <span class="n">query_chunk</span><span class="p">,</span>
</span><span id="L-239"><a href="#L-239"><span class="linenos">239</span></a>                <span class="n">key_chunk</span><span class="p">,</span>
</span><span id="L-240"><a href="#L-240"><span class="linenos">240</span></a>                <span class="n">value_chunk</span><span class="p">,</span>
</span><span id="L-241"><a href="#L-241"><span class="linenos">241</span></a>                <span class="n">carry</span><span class="p">,</span>
</span><span id="L-242"><a href="#L-242"><span class="linenos">242</span></a>                <span class="n">key_chunk_idx</span><span class="p">,</span>
</span><span id="L-243"><a href="#L-243"><span class="linenos">243</span></a>            <span class="p">)</span>
</span><span id="L-244"><a href="#L-244"><span class="linenos">244</span></a>
</span><span id="L-245"><a href="#L-245"><span class="linenos">245</span></a>        <span class="p">(</span><span class="n">numerator</span><span class="p">,</span> <span class="n">denominator</span><span class="p">,</span> <span class="n">max_so_far</span><span class="p">),</span> <span class="n">_</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">scan</span><span class="p">(</span>
</span><span id="L-246"><a href="#L-246"><span class="linenos">246</span></a>            <span class="n">conditional_summarize_fn</span><span class="p">,</span>
</span><span id="L-247"><a href="#L-247"><span class="linenos">247</span></a>            <span class="n">zero_chunk</span><span class="p">,</span>
</span><span id="L-248"><a href="#L-248"><span class="linenos">248</span></a>            <span class="n">xs</span><span class="o">=</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_kv_chunks</span><span class="p">)),</span>
</span><span id="L-249"><a href="#L-249"><span class="linenos">249</span></a>        <span class="p">)</span>
</span><span id="L-250"><a href="#L-250"><span class="linenos">250</span></a>
</span><span id="L-251"><a href="#L-251"><span class="linenos">251</span></a>        <span class="k">if</span> <span class="n">use_extra_logit</span><span class="p">:</span>
</span><span id="L-252"><a href="#L-252"><span class="linenos">252</span></a>            <span class="n">denominator</span> <span class="o">+=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">max_so_far</span><span class="p">)</span>
</span><span id="L-253"><a href="#L-253"><span class="linenos">253</span></a>
</span><span id="L-254"><a href="#L-254"><span class="linenos">254</span></a>        <span class="k">return</span> <span class="n">numerator</span> <span class="o">/</span> <span class="n">denominator</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="p">:,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">newaxis</span><span class="p">]</span>
</span><span id="L-255"><a href="#L-255"><span class="linenos">255</span></a>
</span><span id="L-256"><a href="#L-256"><span class="linenos">256</span></a>    <span class="n">res</span> <span class="o">=</span> <span class="n">lax</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">_query_chunk_attention</span><span class="p">,</span> <span class="n">xs</span><span class="o">=</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">num_q_chunks</span><span class="p">)))</span>
</span><span id="L-257"><a href="#L-257"><span class="linenos">257</span></a>
</span><span id="L-258"><a href="#L-258"><span class="linenos">258</span></a>    <span class="n">expected_res_shape</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-259"><a href="#L-259"><span class="linenos">259</span></a>        <span class="n">num_q_chunks</span><span class="p">,</span>
</span><span id="L-260"><a href="#L-260"><span class="linenos">260</span></a>        <span class="n">batch</span><span class="p">,</span>
</span><span id="L-261"><a href="#L-261"><span class="linenos">261</span></a>        <span class="n">query_chunk_size</span><span class="p">,</span>
</span><span id="L-262"><a href="#L-262"><span class="linenos">262</span></a>        <span class="n">heads</span><span class="p">,</span>
</span><span id="L-263"><a href="#L-263"><span class="linenos">263</span></a>        <span class="n">queries_per_head</span><span class="p">,</span>
</span><span id="L-264"><a href="#L-264"><span class="linenos">264</span></a>        <span class="n">v_features</span><span class="p">,</span>
</span><span id="L-265"><a href="#L-265"><span class="linenos">265</span></a>    <span class="p">)</span>
</span><span id="L-266"><a href="#L-266"><span class="linenos">266</span></a>    <span class="k">assert</span> <span class="p">(</span>
</span><span id="L-267"><a href="#L-267"><span class="linenos">267</span></a>            <span class="n">res</span><span class="o">.</span><span class="n">shape</span> <span class="o">==</span> <span class="n">expected_res_shape</span>
</span><span id="L-268"><a href="#L-268"><span class="linenos">268</span></a>    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;res.shape is </span><span class="si">{</span><span class="n">res</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">, but expected </span><span class="si">{</span><span class="n">expected_res_shape</span><span class="si">}</span><span class="s1">.&#39;</span>
</span><span id="L-269"><a href="#L-269"><span class="linenos">269</span></a>    <span class="n">res</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">res</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="L-270"><a href="#L-270"><span class="linenos">270</span></a>    <span class="k">return</span> <span class="n">res</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">num_q</span><span class="p">,</span> <span class="n">heads</span><span class="p">,</span> <span class="n">queries_per_head</span><span class="p">,</span> <span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="L-271"><a href="#L-271"><span class="linenos">271</span></a>
</span><span id="L-272"><a href="#L-272"><span class="linenos">272</span></a>
</span><span id="L-273"><a href="#L-273"><span class="linenos">273</span></a><span class="k">def</span> <span class="nf">dot_product_attention_queries_per_head</span><span class="p">(</span>
</span><span id="L-274"><a href="#L-274"><span class="linenos">274</span></a>        <span class="n">query</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
</span><span id="L-275"><a href="#L-275"><span class="linenos">275</span></a>        <span class="n">key</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
</span><span id="L-276"><a href="#L-276"><span class="linenos">276</span></a>        <span class="n">value</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
</span><span id="L-277"><a href="#L-277"><span class="linenos">277</span></a>        <span class="n">bias</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-278"><a href="#L-278"><span class="linenos">278</span></a>        <span class="n">broadcast_dropout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-279"><a href="#L-279"><span class="linenos">279</span></a>        <span class="n">rescale_logits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-280"><a href="#L-280"><span class="linenos">280</span></a>        <span class="n">dropout_rng</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PRNGKey</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-281"><a href="#L-281"><span class="linenos">281</span></a>        <span class="n">dropout_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-282"><a href="#L-282"><span class="linenos">282</span></a>        <span class="n">enable_dropout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-283"><a href="#L-283"><span class="linenos">283</span></a>        <span class="n">dtype</span><span class="p">:</span> <span class="n">DType</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
</span><span id="L-284"><a href="#L-284"><span class="linenos">284</span></a>        <span class="n">precision</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lax</span><span class="o">.</span><span class="n">Precision</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-285"><a href="#L-285"><span class="linenos">285</span></a>        <span class="n">use_extra_logit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-286"><a href="#L-286"><span class="linenos">286</span></a>        <span class="n">float32_logits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-287"><a href="#L-287"><span class="linenos">287</span></a>        <span class="n">causal_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-288"><a href="#L-288"><span class="linenos">288</span></a>        <span class="n">query_chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span>
</span><span id="L-289"><a href="#L-289"><span class="linenos">289</span></a>        <span class="n">key_chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2048</span><span class="p">,</span>
</span><span id="L-290"><a href="#L-290"><span class="linenos">290</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="L-291"><a href="#L-291"><span class="linenos">291</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes dot-product attention given query, key, and value.</span>
</span><span id="L-292"><a href="#L-292"><span class="linenos">292</span></a>
</span><span id="L-293"><a href="#L-293"><span class="linenos">293</span></a><span class="sd">    This is a variant of attention that generalizes both multi-head and</span>
</span><span id="L-294"><a href="#L-294"><span class="linenos">294</span></a><span class="sd">    multi-query attention. It features an extra dimension for the query array,</span>
</span><span id="L-295"><a href="#L-295"><span class="linenos">295</span></a><span class="sd">    that specifies the number of queries per head.</span>
</span><span id="L-296"><a href="#L-296"><span class="linenos">296</span></a>
</span><span id="L-297"><a href="#L-297"><span class="linenos">297</span></a><span class="sd">    This function is improved by the memory-efficient attention algorithm</span>
</span><span id="L-298"><a href="#L-298"><span class="linenos">298</span></a><span class="sd">    (https://arxiv.org/abs/2112.05682), which is also called FlashAttention</span>
</span><span id="L-299"><a href="#L-299"><span class="linenos">299</span></a><span class="sd">    (https://arxiv.org/abs/2205.14135).</span>
</span><span id="L-300"><a href="#L-300"><span class="linenos">300</span></a>
</span><span id="L-301"><a href="#L-301"><span class="linenos">301</span></a><span class="sd">    Note: query, key, value needn&#39;t have any batch dimensions.</span>
</span><span id="L-302"><a href="#L-302"><span class="linenos">302</span></a>
</span><span id="L-303"><a href="#L-303"><span class="linenos">303</span></a><span class="sd">    Args:</span>
</span><span id="L-304"><a href="#L-304"><span class="linenos">304</span></a><span class="sd">        query: queries for calculating attention with shape of `[batch..., q_length,</span>
</span><span id="L-305"><a href="#L-305"><span class="linenos">305</span></a><span class="sd">            num_heads, queries_per_head, qk_depth_per_head]`.</span>
</span><span id="L-306"><a href="#L-306"><span class="linenos">306</span></a><span class="sd">        key: keys for calculating attention with shape of `[batch..., kv_length,</span>
</span><span id="L-307"><a href="#L-307"><span class="linenos">307</span></a><span class="sd">            num_heads, qk_depth_per_head]`.</span>
</span><span id="L-308"><a href="#L-308"><span class="linenos">308</span></a><span class="sd">        value: values to be used in attention with shape of `[batch..., kv_length,</span>
</span><span id="L-309"><a href="#L-309"><span class="linenos">309</span></a><span class="sd">            num_heads, v_depth_per_head]`.</span>
</span><span id="L-310"><a href="#L-310"><span class="linenos">310</span></a><span class="sd">        bias: bias for the attention weights. This should be broadcastable to the</span>
</span><span id="L-311"><a href="#L-311"><span class="linenos">311</span></a><span class="sd">            shape `[batch..., num_heads, queries_per_head, q_length, kv_length]` This</span>
</span><span id="L-312"><a href="#L-312"><span class="linenos">312</span></a><span class="sd">            can be used for incorporating causal masks, padding masks, proximity bias,</span>
</span><span id="L-313"><a href="#L-313"><span class="linenos">313</span></a><span class="sd">            etc.</span>
</span><span id="L-314"><a href="#L-314"><span class="linenos">314</span></a><span class="sd">        broadcast_dropout: bool: use a broadcasted dropout along batch dims.</span>
</span><span id="L-315"><a href="#L-315"><span class="linenos">315</span></a><span class="sd">        rescale_logits: bool. Whether to rescale `query` logits by 1/sqrt(depth_kq).</span>
</span><span id="L-316"><a href="#L-316"><span class="linenos">316</span></a><span class="sd">        dropout_rng: JAX PRNGKey: to be used for dropout</span>
</span><span id="L-317"><a href="#L-317"><span class="linenos">317</span></a><span class="sd">        dropout_rate: dropout rate</span>
</span><span id="L-318"><a href="#L-318"><span class="linenos">318</span></a><span class="sd">        enable_dropout: bool, whether to apply dropout</span>
</span><span id="L-319"><a href="#L-319"><span class="linenos">319</span></a><span class="sd">        dtype: the dtype of the computation (default: float32)</span>
</span><span id="L-320"><a href="#L-320"><span class="linenos">320</span></a><span class="sd">        precision: numerical precision of the computation see `jax.lax.Precision`</span>
</span><span id="L-321"><a href="#L-321"><span class="linenos">321</span></a><span class="sd">            for details.</span>
</span><span id="L-322"><a href="#L-322"><span class="linenos">322</span></a><span class="sd">        use_extra_logit: whether to include a virtual extra logit equal to zero.</span>
</span><span id="L-323"><a href="#L-323"><span class="linenos">323</span></a><span class="sd">        float32_logits: bool, if True then compute logits in float32 to avoid</span>
</span><span id="L-324"><a href="#L-324"><span class="linenos">324</span></a><span class="sd">            numerical issues with bfloat16.</span>
</span><span id="L-325"><a href="#L-325"><span class="linenos">325</span></a><span class="sd">        causal_mask: Apply a causal mask. This can be used alternatively or in</span>
</span><span id="L-326"><a href="#L-326"><span class="linenos">326</span></a><span class="sd">            addition to the given bias.</span>
</span><span id="L-327"><a href="#L-327"><span class="linenos">327</span></a><span class="sd">        query_chunk_size: Positive integer to control the size of the query chunks.</span>
</span><span id="L-328"><a href="#L-328"><span class="linenos">328</span></a><span class="sd">        key_chunk_size: Positive integer to control the size of the key chunks.</span>
</span><span id="L-329"><a href="#L-329"><span class="linenos">329</span></a>
</span><span id="L-330"><a href="#L-330"><span class="linenos">330</span></a><span class="sd">    Returns:</span>
</span><span id="L-331"><a href="#L-331"><span class="linenos">331</span></a><span class="sd">        Output of shape `[batch..., length, num_heads, queries_per_head,</span>
</span><span id="L-332"><a href="#L-332"><span class="linenos">332</span></a><span class="sd">        v_depth_per_head]`.</span>
</span><span id="L-333"><a href="#L-333"><span class="linenos">333</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-334"><a href="#L-334"><span class="linenos">334</span></a>    <span class="k">assert</span> <span class="p">(</span>
</span><span id="L-335"><a href="#L-335"><span class="linenos">335</span></a>            <span class="n">key</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="n">value</span><span class="o">.</span><span class="n">ndim</span>
</span><span id="L-336"><a href="#L-336"><span class="linenos">336</span></a>    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;k, v must have same rank. key: </span><span class="si">{</span><span class="n">key</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">, value: </span><span class="si">{</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-337"><a href="#L-337"><span class="linenos">337</span></a>    <span class="k">assert</span> <span class="p">(</span>
</span><span id="L-338"><a href="#L-338"><span class="linenos">338</span></a>            <span class="n">query</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="n">key</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
</span><span id="L-339"><a href="#L-339"><span class="linenos">339</span></a>    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;q, k, v batch dim must match. query: </span><span class="si">{</span><span class="n">query</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="L-340"><a href="#L-340"><span class="linenos">340</span></a>
</span><span id="L-341"><a href="#L-341"><span class="linenos">341</span></a>    <span class="k">assert</span> <span class="n">key</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;k, v lengths must match.&#39;</span>
</span><span id="L-342"><a href="#L-342"><span class="linenos">342</span></a>    <span class="k">assert</span> <span class="n">query</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">key</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;q, k depths must match.&#39;</span>
</span><span id="L-343"><a href="#L-343"><span class="linenos">343</span></a>
</span><span id="L-344"><a href="#L-344"><span class="linenos">344</span></a>    <span class="c1"># Ensure that we have exactly one batch dimension</span>
</span><span id="L-345"><a href="#L-345"><span class="linenos">345</span></a>    <span class="n">orig_batch_dims</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
</span><span id="L-346"><a href="#L-346"><span class="linenos">346</span></a>    <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">query</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span>
</span><span id="L-347"><a href="#L-347"><span class="linenos">347</span></a>    <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">key</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:])</span>
</span><span id="L-348"><a href="#L-348"><span class="linenos">348</span></a>    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:])</span>
</span><span id="L-349"><a href="#L-349"><span class="linenos">349</span></a>    <span class="k">if</span> <span class="n">bias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-350"><a href="#L-350"><span class="linenos">350</span></a>        <span class="n">bias</span> <span class="o">=</span> <span class="n">bias</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">bias</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span>
</span><span id="L-351"><a href="#L-351"><span class="linenos">351</span></a>
</span><span id="L-352"><a href="#L-352"><span class="linenos">352</span></a>    <span class="n">batch_size</span><span class="p">,</span> <span class="n">query_length</span><span class="p">,</span> <span class="n">heads</span><span class="p">,</span> <span class="n">queries_per_head</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-353"><a href="#L-353"><span class="linenos">353</span></a>    <span class="n">_</span><span class="p">,</span> <span class="n">key_length</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">shape</span>
</span><span id="L-354"><a href="#L-354"><span class="linenos">354</span></a>
</span><span id="L-355"><a href="#L-355"><span class="linenos">355</span></a>    <span class="c1"># TODO: Consider automatic padding to remove this constraint.</span>
</span><span id="L-356"><a href="#L-356"><span class="linenos">356</span></a>    <span class="k">if</span> <span class="n">query_length</span> <span class="o">%</span> <span class="n">query_chunk_size</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">query_length</span> <span class="o">&gt;</span> <span class="n">query_chunk_size</span><span class="p">:</span>
</span><span id="L-357"><a href="#L-357"><span class="linenos">357</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-358"><a href="#L-358"><span class="linenos">358</span></a>            <span class="s1">&#39;Sequence length of the query vector </span><span class="si">%d</span><span class="s1"> needs to be less &#39;</span>
</span><span id="L-359"><a href="#L-359"><span class="linenos">359</span></a>            <span class="s1">&#39;than, or a multiple of the query_chunk_size </span><span class="si">%d</span><span class="s1">.&#39;</span>
</span><span id="L-360"><a href="#L-360"><span class="linenos">360</span></a>            <span class="o">%</span> <span class="p">(</span><span class="n">query_length</span><span class="p">,</span> <span class="n">query_chunk_size</span><span class="p">)</span>
</span><span id="L-361"><a href="#L-361"><span class="linenos">361</span></a>        <span class="p">)</span>
</span><span id="L-362"><a href="#L-362"><span class="linenos">362</span></a>    <span class="k">if</span> <span class="n">key_length</span> <span class="o">%</span> <span class="n">key_chunk_size</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">key_length</span> <span class="o">&gt;</span> <span class="n">key_chunk_size</span><span class="p">:</span>
</span><span id="L-363"><a href="#L-363"><span class="linenos">363</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-364"><a href="#L-364"><span class="linenos">364</span></a>            <span class="s1">&#39;Sequence length of the key/value vector </span><span class="si">%d</span><span class="s1"> needs to be less &#39;</span>
</span><span id="L-365"><a href="#L-365"><span class="linenos">365</span></a>            <span class="s1">&#39;than, or a multiple of the key_chunk_size </span><span class="si">%d</span><span class="s1">.&#39;</span>
</span><span id="L-366"><a href="#L-366"><span class="linenos">366</span></a>            <span class="o">%</span> <span class="p">(</span><span class="n">key_length</span><span class="p">,</span> <span class="n">key_chunk_size</span><span class="p">)</span>
</span><span id="L-367"><a href="#L-367"><span class="linenos">367</span></a>        <span class="p">)</span>
</span><span id="L-368"><a href="#L-368"><span class="linenos">368</span></a>
</span><span id="L-369"><a href="#L-369"><span class="linenos">369</span></a>    <span class="n">query_chunk_size</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">query_chunk_size</span><span class="p">,</span> <span class="n">query_length</span><span class="p">)</span>
</span><span id="L-370"><a href="#L-370"><span class="linenos">370</span></a>    <span class="n">key_chunk_size</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">key_chunk_size</span><span class="p">,</span> <span class="n">key_length</span><span class="p">)</span>
</span><span id="L-371"><a href="#L-371"><span class="linenos">371</span></a>
</span><span id="L-372"><a href="#L-372"><span class="linenos">372</span></a>    <span class="k">if</span> <span class="n">bias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-373"><a href="#L-373"><span class="linenos">373</span></a>        <span class="n">broadcastable_to</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="L-374"><a href="#L-374"><span class="linenos">374</span></a>            <span class="n">batch_size</span><span class="p">,</span>
</span><span id="L-375"><a href="#L-375"><span class="linenos">375</span></a>            <span class="n">heads</span><span class="p">,</span>
</span><span id="L-376"><a href="#L-376"><span class="linenos">376</span></a>            <span class="n">queries_per_head</span><span class="p">,</span>
</span><span id="L-377"><a href="#L-377"><span class="linenos">377</span></a>            <span class="n">query_length</span><span class="p">,</span>
</span><span id="L-378"><a href="#L-378"><span class="linenos">378</span></a>            <span class="n">key_length</span><span class="p">,</span>
</span><span id="L-379"><a href="#L-379"><span class="linenos">379</span></a>        <span class="p">)</span>
</span><span id="L-380"><a href="#L-380"><span class="linenos">380</span></a>        <span class="c1"># Check that bias is broadcastable as expected:</span>
</span><span id="L-381"><a href="#L-381"><span class="linenos">381</span></a>        <span class="k">for</span> <span class="n">bias_dim</span><span class="p">,</span> <span class="n">broadcast_dim</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bias</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">broadcastable_to</span><span class="p">):</span>
</span><span id="L-382"><a href="#L-382"><span class="linenos">382</span></a>            <span class="k">if</span> <span class="n">bias_dim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">broadcast_dim</span><span class="p">]:</span>
</span><span id="L-383"><a href="#L-383"><span class="linenos">383</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="L-384"><a href="#L-384"><span class="linenos">384</span></a>                    <span class="sa">f</span><span class="s1">&#39;Expected bias dimensions </span><span class="si">{</span><span class="n">bias</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1"> to be broadcastable to&#39;</span>
</span><span id="L-385"><a href="#L-385"><span class="linenos">385</span></a>                    <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">broadcastable_to</span><span class="si">}</span><span class="s1">.&#39;</span>
</span><span id="L-386"><a href="#L-386"><span class="linenos">386</span></a>                <span class="p">)</span>
</span><span id="L-387"><a href="#L-387"><span class="linenos">387</span></a>
</span><span id="L-388"><a href="#L-388"><span class="linenos">388</span></a>    <span class="k">if</span> <span class="n">enable_dropout</span> <span class="ow">and</span> <span class="n">dropout_rate</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="L-389"><a href="#L-389"><span class="linenos">389</span></a>        <span class="c1"># Precompute dropout</span>
</span><span id="L-390"><a href="#L-390"><span class="linenos">390</span></a>        <span class="n">drop_shape</span> <span class="o">=</span> <span class="p">[</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">heads</span><span class="p">,</span> <span class="n">queries_per_head</span><span class="p">,</span> <span class="n">query_length</span><span class="p">,</span> <span class="n">key_length</span><span class="p">]</span>
</span><span id="L-391"><a href="#L-391"><span class="linenos">391</span></a>        <span class="k">if</span> <span class="n">broadcast_dropout</span><span class="p">:</span>
</span><span id="L-392"><a href="#L-392"><span class="linenos">392</span></a>            <span class="c1"># We mimick the semantics of T5 and broadcast along the &quot;length&quot; dim.</span>
</span><span id="L-393"><a href="#L-393"><span class="linenos">393</span></a>            <span class="n">drop_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># query_length dim</span>
</span><span id="L-394"><a href="#L-394"><span class="linenos">394</span></a>        <span class="n">precomputed_dropout</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">bernoulli</span><span class="p">(</span>
</span><span id="L-395"><a href="#L-395"><span class="linenos">395</span></a>            <span class="n">dropout_rng</span><span class="p">,</span> <span class="n">dropout_rate</span><span class="p">,</span> <span class="n">drop_shape</span>
</span><span id="L-396"><a href="#L-396"><span class="linenos">396</span></a>        <span class="p">)</span>
</span><span id="L-397"><a href="#L-397"><span class="linenos">397</span></a>
</span><span id="L-398"><a href="#L-398"><span class="linenos">398</span></a>    <span class="k">def</span> <span class="nf">bias_fn</span><span class="p">(</span>
</span><span id="L-399"><a href="#L-399"><span class="linenos">399</span></a>            <span class="n">query_chunk_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-400"><a href="#L-400"><span class="linenos">400</span></a>            <span class="n">key_chunk_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="L-401"><a href="#L-401"><span class="linenos">401</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="L-402"><a href="#L-402"><span class="linenos">402</span></a>        <span class="n">query_offset</span> <span class="o">=</span> <span class="n">query_chunk_idx</span> <span class="o">*</span> <span class="n">query_chunk_size</span>
</span><span id="L-403"><a href="#L-403"><span class="linenos">403</span></a>        <span class="n">key_offset</span> <span class="o">=</span> <span class="n">key_chunk_idx</span> <span class="o">*</span> <span class="n">key_chunk_size</span>
</span><span id="L-404"><a href="#L-404"><span class="linenos">404</span></a>
</span><span id="L-405"><a href="#L-405"><span class="linenos">405</span></a>        <span class="n">local_bias</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="L-406"><a href="#L-406"><span class="linenos">406</span></a>        <span class="k">if</span> <span class="n">bias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-407"><a href="#L-407"><span class="linenos">407</span></a>            <span class="c1"># If bias is not broadcasted yet, dynamic slice would fail with full slice</span>
</span><span id="L-408"><a href="#L-408"><span class="linenos">408</span></a>            <span class="c1"># size. In this case we keep the bias unbroadcasted.</span>
</span><span id="L-409"><a href="#L-409"><span class="linenos">409</span></a>            <span class="n">slice_q_len</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">bias</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">query_chunk_size</span><span class="p">)</span>
</span><span id="L-410"><a href="#L-410"><span class="linenos">410</span></a>            <span class="n">slice_k_len</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">bias</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">key_chunk_size</span><span class="p">)</span>
</span><span id="L-411"><a href="#L-411"><span class="linenos">411</span></a>            <span class="n">local_bias</span> <span class="o">=</span> <span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span>
</span><span id="L-412"><a href="#L-412"><span class="linenos">412</span></a>                <span class="n">bias</span><span class="p">,</span>
</span><span id="L-413"><a href="#L-413"><span class="linenos">413</span></a>                <span class="c1"># query_offset and key_offset might be &gt; 1 but bias dims might</span>
</span><span id="L-414"><a href="#L-414"><span class="linenos">414</span></a>                <span class="c1"># not yet be broadcasted. We rely on the protection against</span>
</span><span id="L-415"><a href="#L-415"><span class="linenos">415</span></a>                <span class="c1"># out-of-bounds array accesses built into dynamic_slice.</span>
</span><span id="L-416"><a href="#L-416"><span class="linenos">416</span></a>                <span class="n">start_indices</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">query_offset</span><span class="p">,</span> <span class="n">key_offset</span><span class="p">),</span>
</span><span id="L-417"><a href="#L-417"><span class="linenos">417</span></a>                <span class="n">slice_sizes</span><span class="o">=</span><span class="p">(</span><span class="o">*</span><span class="n">bias</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">slice_q_len</span><span class="p">,</span> <span class="n">slice_k_len</span><span class="p">),</span>
</span><span id="L-418"><a href="#L-418"><span class="linenos">418</span></a>            <span class="p">)</span>
</span><span id="L-419"><a href="#L-419"><span class="linenos">419</span></a>        <span class="k">if</span> <span class="n">causal_mask</span><span class="p">:</span>
</span><span id="L-420"><a href="#L-420"><span class="linenos">420</span></a>            <span class="n">causal</span> <span class="o">=</span> <span class="n">_local_causal_bias</span><span class="p">(</span>
</span><span id="L-421"><a href="#L-421"><span class="linenos">421</span></a>                <span class="n">query_chunk_size</span><span class="p">,</span> <span class="n">key_chunk_size</span><span class="p">,</span> <span class="n">query_offset</span><span class="p">,</span> <span class="n">key_offset</span>
</span><span id="L-422"><a href="#L-422"><span class="linenos">422</span></a>            <span class="p">)</span>
</span><span id="L-423"><a href="#L-423"><span class="linenos">423</span></a>            <span class="c1"># add batch, head, and queries_per_head dims</span>
</span><span id="L-424"><a href="#L-424"><span class="linenos">424</span></a>            <span class="n">local_bias</span> <span class="o">+=</span> <span class="n">causal</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">causal</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="L-425"><a href="#L-425"><span class="linenos">425</span></a>        <span class="c1"># We implement dropout as part of the bias, which is additive to the</span>
</span><span id="L-426"><a href="#L-426"><span class="linenos">426</span></a>        <span class="c1"># attention scores. In some other implementations it is treated as a</span>
</span><span id="L-427"><a href="#L-427"><span class="linenos">427</span></a>        <span class="c1"># multiplicative factor applied to the probabilities after softmax.</span>
</span><span id="L-428"><a href="#L-428"><span class="linenos">428</span></a>        <span class="k">if</span> <span class="n">enable_dropout</span> <span class="ow">and</span> <span class="n">dropout_rate</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="L-429"><a href="#L-429"><span class="linenos">429</span></a>            <span class="k">with</span> <span class="n">jax</span><span class="o">.</span><span class="n">named_scope</span><span class="p">(</span><span class="s1">&#39;dropout&#39;</span><span class="p">):</span>
</span><span id="L-430"><a href="#L-430"><span class="linenos">430</span></a>                <span class="c1"># If dropout is not broadcasted yet, we need the collapsed dims.</span>
</span><span id="L-431"><a href="#L-431"><span class="linenos">431</span></a>                <span class="n">slice_q_len</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">precomputed_dropout</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">query_chunk_size</span><span class="p">)</span>
</span><span id="L-432"><a href="#L-432"><span class="linenos">432</span></a>                <span class="n">slice_k_len</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">precomputed_dropout</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">key_chunk_size</span><span class="p">)</span>
</span><span id="L-433"><a href="#L-433"><span class="linenos">433</span></a>                <span class="n">dropout_slice</span> <span class="o">=</span> <span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span>
</span><span id="L-434"><a href="#L-434"><span class="linenos">434</span></a>                    <span class="n">precomputed_dropout</span><span class="p">,</span>
</span><span id="L-435"><a href="#L-435"><span class="linenos">435</span></a>                    <span class="c1"># query_offset and key_offset might be &gt; 1 but dropout dims might</span>
</span><span id="L-436"><a href="#L-436"><span class="linenos">436</span></a>                    <span class="c1"># not yet be broadcasted. We rely on the protection against</span>
</span><span id="L-437"><a href="#L-437"><span class="linenos">437</span></a>                    <span class="c1"># out-of-bounds array accesses built into dynamic_slice.</span>
</span><span id="L-438"><a href="#L-438"><span class="linenos">438</span></a>                    <span class="n">start_indices</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">query_offset</span><span class="p">,</span> <span class="n">key_offset</span><span class="p">),</span>
</span><span id="L-439"><a href="#L-439"><span class="linenos">439</span></a>                    <span class="n">slice_sizes</span><span class="o">=</span><span class="p">(</span>
</span><span id="L-440"><a href="#L-440"><span class="linenos">440</span></a>                        <span class="o">*</span><span class="n">precomputed_dropout</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span>
</span><span id="L-441"><a href="#L-441"><span class="linenos">441</span></a>                        <span class="n">slice_q_len</span><span class="p">,</span>
</span><span id="L-442"><a href="#L-442"><span class="linenos">442</span></a>                        <span class="n">slice_k_len</span><span class="p">,</span>
</span><span id="L-443"><a href="#L-443"><span class="linenos">443</span></a>                    <span class="p">),</span>
</span><span id="L-444"><a href="#L-444"><span class="linenos">444</span></a>                <span class="p">)</span>
</span><span id="L-445"><a href="#L-445"><span class="linenos">445</span></a>                <span class="n">local_bias</span> <span class="o">-=</span> <span class="n">dropout_slice</span> <span class="o">*</span> <span class="mf">1e6</span>
</span><span id="L-446"><a href="#L-446"><span class="linenos">446</span></a>        <span class="k">return</span> <span class="n">local_bias</span>
</span><span id="L-447"><a href="#L-447"><span class="linenos">447</span></a>
</span><span id="L-448"><a href="#L-448"><span class="linenos">448</span></a>    <span class="c1"># NOTE: T5 does not explicitly rescale the attention logits by</span>
</span><span id="L-449"><a href="#L-449"><span class="linenos">449</span></a>    <span class="c1">#       1/sqrt(depth_kq)!  This is folded into the initializers of the</span>
</span><span id="L-450"><a href="#L-450"><span class="linenos">450</span></a>    <span class="c1">#       linear transformations, which is equivalent under Adafactor.</span>
</span><span id="L-451"><a href="#L-451"><span class="linenos">451</span></a>    <span class="k">if</span> <span class="n">rescale_logits</span><span class="p">:</span>
</span><span id="L-452"><a href="#L-452"><span class="linenos">452</span></a>        <span class="n">depth</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="L-453"><a href="#L-453"><span class="linenos">453</span></a>        <span class="n">query</span> <span class="o">=</span> <span class="n">query</span> <span class="o">/</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">depth</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="L-454"><a href="#L-454"><span class="linenos">454</span></a>
</span><span id="L-455"><a href="#L-455"><span class="linenos">455</span></a>    <span class="c1"># Casting logits and softmax computation for float32 for model stability.</span>
</span><span id="L-456"><a href="#L-456"><span class="linenos">456</span></a>    <span class="k">if</span> <span class="n">float32_logits</span><span class="p">:</span>
</span><span id="L-457"><a href="#L-457"><span class="linenos">457</span></a>        <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="L-458"><a href="#L-458"><span class="linenos">458</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="L-459"><a href="#L-459"><span class="linenos">459</span></a>
</span><span id="L-460"><a href="#L-460"><span class="linenos">460</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">_memory_efficient_attention</span><span class="p">(</span>
</span><span id="L-461"><a href="#L-461"><span class="linenos">461</span></a>        <span class="n">query</span><span class="p">,</span>
</span><span id="L-462"><a href="#L-462"><span class="linenos">462</span></a>        <span class="n">key</span><span class="p">,</span>
</span><span id="L-463"><a href="#L-463"><span class="linenos">463</span></a>        <span class="n">value</span><span class="p">,</span>
</span><span id="L-464"><a href="#L-464"><span class="linenos">464</span></a>        <span class="n">bias_fn</span><span class="p">,</span>
</span><span id="L-465"><a href="#L-465"><span class="linenos">465</span></a>        <span class="n">query_chunk_size</span><span class="o">=</span><span class="n">query_chunk_size</span><span class="p">,</span>
</span><span id="L-466"><a href="#L-466"><span class="linenos">466</span></a>        <span class="n">key_chunk_size</span><span class="o">=</span><span class="n">key_chunk_size</span><span class="p">,</span>
</span><span id="L-467"><a href="#L-467"><span class="linenos">467</span></a>        <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span>
</span><span id="L-468"><a href="#L-468"><span class="linenos">468</span></a>        <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
</span><span id="L-469"><a href="#L-469"><span class="linenos">469</span></a>        <span class="n">use_extra_logit</span><span class="o">=</span><span class="n">use_extra_logit</span><span class="p">,</span>
</span><span id="L-470"><a href="#L-470"><span class="linenos">470</span></a>        <span class="n">causal_mask</span><span class="o">=</span><span class="n">causal_mask</span><span class="p">,</span>
</span><span id="L-471"><a href="#L-471"><span class="linenos">471</span></a>    <span class="p">)</span>
</span><span id="L-472"><a href="#L-472"><span class="linenos">472</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">*</span><span class="n">orig_batch_dims</span><span class="p">,</span> <span class="o">*</span><span class="n">result</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="L-473"><a href="#L-473"><span class="linenos">473</span></a>    <span class="k">return</span> <span class="n">result</span>
</span><span id="L-474"><a href="#L-474"><span class="linenos">474</span></a>
</span><span id="L-475"><a href="#L-475"><span class="linenos">475</span></a>
</span><span id="L-476"><a href="#L-476"><span class="linenos">476</span></a><span class="k">def</span> <span class="nf">dot_product_attention_multiquery</span><span class="p">(</span>
</span><span id="L-477"><a href="#L-477"><span class="linenos">477</span></a>        <span class="n">query</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
</span><span id="L-478"><a href="#L-478"><span class="linenos">478</span></a>        <span class="n">key</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
</span><span id="L-479"><a href="#L-479"><span class="linenos">479</span></a>        <span class="n">value</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
</span><span id="L-480"><a href="#L-480"><span class="linenos">480</span></a>        <span class="n">bias</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-481"><a href="#L-481"><span class="linenos">481</span></a>        <span class="n">broadcast_dropout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-482"><a href="#L-482"><span class="linenos">482</span></a>        <span class="n">rescale_logits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-483"><a href="#L-483"><span class="linenos">483</span></a>        <span class="n">dropout_rng</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PRNGKey</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-484"><a href="#L-484"><span class="linenos">484</span></a>        <span class="n">dropout_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-485"><a href="#L-485"><span class="linenos">485</span></a>        <span class="n">enable_dropout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-486"><a href="#L-486"><span class="linenos">486</span></a>        <span class="n">dtype</span><span class="p">:</span> <span class="n">DType</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
</span><span id="L-487"><a href="#L-487"><span class="linenos">487</span></a>        <span class="n">precision</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lax</span><span class="o">.</span><span class="n">Precision</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-488"><a href="#L-488"><span class="linenos">488</span></a>        <span class="n">use_extra_logit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-489"><a href="#L-489"><span class="linenos">489</span></a>        <span class="n">float32_logits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-490"><a href="#L-490"><span class="linenos">490</span></a>        <span class="n">causal_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-491"><a href="#L-491"><span class="linenos">491</span></a>        <span class="n">query_chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span>
</span><span id="L-492"><a href="#L-492"><span class="linenos">492</span></a>        <span class="n">key_chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2048</span><span class="p">,</span>
</span><span id="L-493"><a href="#L-493"><span class="linenos">493</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="L-494"><a href="#L-494"><span class="linenos">494</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes dot-product multiquery-attention given query, key, and value.</span>
</span><span id="L-495"><a href="#L-495"><span class="linenos">495</span></a>
</span><span id="L-496"><a href="#L-496"><span class="linenos">496</span></a><span class="sd">    This is a variant of the multi-head dot product attention introduced in</span>
</span><span id="L-497"><a href="#L-497"><span class="linenos">497</span></a><span class="sd">    https://arxiv.org/abs/1706.03762 and implemented in `dot_product_attention`.</span>
</span><span id="L-498"><a href="#L-498"><span class="linenos">498</span></a><span class="sd">    In this function, the key and the value have 1 head whereas query has 1 or</span>
</span><span id="L-499"><a href="#L-499"><span class="linenos">499</span></a><span class="sd">    more heads. This variant is called &quot;multi-query&quot; attention.</span>
</span><span id="L-500"><a href="#L-500"><span class="linenos">500</span></a>
</span><span id="L-501"><a href="#L-501"><span class="linenos">501</span></a><span class="sd">    This implementation is equivalent to</span>
</span><span id="L-502"><a href="#L-502"><span class="linenos">502</span></a><span class="sd">    `dense_attention.dot_product_attention_multiquery`, but is improved by the</span>
</span><span id="L-503"><a href="#L-503"><span class="linenos">503</span></a><span class="sd">    memory-efficient attention algorithm (https://arxiv.org/abs/2112.05682),</span>
</span><span id="L-504"><a href="#L-504"><span class="linenos">504</span></a><span class="sd">    which is also called FlashAttention (https://arxiv.org/abs/2205.14135).</span>
</span><span id="L-505"><a href="#L-505"><span class="linenos">505</span></a>
</span><span id="L-506"><a href="#L-506"><span class="linenos">506</span></a><span class="sd">    Note: query, key, value needn&#39;t have any batch dimensions.</span>
</span><span id="L-507"><a href="#L-507"><span class="linenos">507</span></a>
</span><span id="L-508"><a href="#L-508"><span class="linenos">508</span></a><span class="sd">    Args:</span>
</span><span id="L-509"><a href="#L-509"><span class="linenos">509</span></a><span class="sd">        query: queries for calculating attention with shape of `[batch..., q_length,</span>
</span><span id="L-510"><a href="#L-510"><span class="linenos">510</span></a><span class="sd">            num_heads, qk_depth_per_head]`.</span>
</span><span id="L-511"><a href="#L-511"><span class="linenos">511</span></a><span class="sd">        key: keys for calculating attention with shape of `[batch..., kv_length,</span>
</span><span id="L-512"><a href="#L-512"><span class="linenos">512</span></a><span class="sd">            qk_depth_per_head]`.</span>
</span><span id="L-513"><a href="#L-513"><span class="linenos">513</span></a><span class="sd">        value: values to be used in attention with shape of `[batch..., kv_length,</span>
</span><span id="L-514"><a href="#L-514"><span class="linenos">514</span></a><span class="sd">            v_depth_per_head]`.</span>
</span><span id="L-515"><a href="#L-515"><span class="linenos">515</span></a><span class="sd">        bias: bias for the attention weights. This should be broadcastable to the</span>
</span><span id="L-516"><a href="#L-516"><span class="linenos">516</span></a><span class="sd">            shape `[batch..., num_heads, q_length, kv_length]` This can be used for</span>
</span><span id="L-517"><a href="#L-517"><span class="linenos">517</span></a><span class="sd">            incorporating causal masks, padding masks, proximity bias, etc.</span>
</span><span id="L-518"><a href="#L-518"><span class="linenos">518</span></a><span class="sd">        broadcast_dropout: bool: use a broadcasted dropout along batch dims.</span>
</span><span id="L-519"><a href="#L-519"><span class="linenos">519</span></a><span class="sd">        rescale_logits: bool. Whether to rescale `query` logits by 1/sqrt(depth_kq).</span>
</span><span id="L-520"><a href="#L-520"><span class="linenos">520</span></a><span class="sd">        dropout_rng: JAX PRNGKey: to be used for dropout</span>
</span><span id="L-521"><a href="#L-521"><span class="linenos">521</span></a><span class="sd">        dropout_rate: dropout rate</span>
</span><span id="L-522"><a href="#L-522"><span class="linenos">522</span></a><span class="sd">        enable_dropout: bool, whether to apply dropout</span>
</span><span id="L-523"><a href="#L-523"><span class="linenos">523</span></a><span class="sd">        dtype: the dtype of the computation (default: float32)</span>
</span><span id="L-524"><a href="#L-524"><span class="linenos">524</span></a><span class="sd">        precision: numerical precision of the computation see `jax.lax.Precision`</span>
</span><span id="L-525"><a href="#L-525"><span class="linenos">525</span></a><span class="sd">            for details.</span>
</span><span id="L-526"><a href="#L-526"><span class="linenos">526</span></a><span class="sd">        use_extra_logit: whether to include a virtual extra logit equal to zero.</span>
</span><span id="L-527"><a href="#L-527"><span class="linenos">527</span></a><span class="sd">        float32_logits: bool, if True then compute logits in float32 to avoid</span>
</span><span id="L-528"><a href="#L-528"><span class="linenos">528</span></a><span class="sd">            numerical issues with bfloat16.</span>
</span><span id="L-529"><a href="#L-529"><span class="linenos">529</span></a><span class="sd">        causal_mask: Apply a causal mask. This can be used alternatively or in</span>
</span><span id="L-530"><a href="#L-530"><span class="linenos">530</span></a><span class="sd">            addition to the given bias.</span>
</span><span id="L-531"><a href="#L-531"><span class="linenos">531</span></a><span class="sd">        query_chunk_size: Positive integer to control the size of the query chunks.</span>
</span><span id="L-532"><a href="#L-532"><span class="linenos">532</span></a><span class="sd">        key_chunk_size: Positive integer to control the size of the key chunks.</span>
</span><span id="L-533"><a href="#L-533"><span class="linenos">533</span></a>
</span><span id="L-534"><a href="#L-534"><span class="linenos">534</span></a><span class="sd">    Returns:</span>
</span><span id="L-535"><a href="#L-535"><span class="linenos">535</span></a><span class="sd">        Output of shape `[batch..., length, num_heads, v_depth_per_head]`.</span>
</span><span id="L-536"><a href="#L-536"><span class="linenos">536</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-537"><a href="#L-537"><span class="linenos">537</span></a>    <span class="c1"># num_heads, treat current num_heads as queries_per_head</span>
</span><span id="L-538"><a href="#L-538"><span class="linenos">538</span></a>    <span class="n">query</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">3</span><span class="p">)</span>
</span><span id="L-539"><a href="#L-539"><span class="linenos">539</span></a>    <span class="c1"># add num_heads dim</span>
</span><span id="L-540"><a href="#L-540"><span class="linenos">540</span></a>    <span class="n">key</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-541"><a href="#L-541"><span class="linenos">541</span></a>    <span class="c1"># add num_heads dim</span>
</span><span id="L-542"><a href="#L-542"><span class="linenos">542</span></a>    <span class="n">value</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-543"><a href="#L-543"><span class="linenos">543</span></a>    <span class="k">if</span> <span class="n">bias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-544"><a href="#L-544"><span class="linenos">544</span></a>        <span class="c1"># add num_heads, treat current num_heads dim as queries_per_head</span>
</span><span id="L-545"><a href="#L-545"><span class="linenos">545</span></a>        <span class="n">bias</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">bias</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">4</span><span class="p">)</span>
</span><span id="L-546"><a href="#L-546"><span class="linenos">546</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">dot_product_attention_queries_per_head</span><span class="p">(</span>
</span><span id="L-547"><a href="#L-547"><span class="linenos">547</span></a>        <span class="n">query</span><span class="p">,</span>
</span><span id="L-548"><a href="#L-548"><span class="linenos">548</span></a>        <span class="n">key</span><span class="p">,</span>
</span><span id="L-549"><a href="#L-549"><span class="linenos">549</span></a>        <span class="n">value</span><span class="p">,</span>
</span><span id="L-550"><a href="#L-550"><span class="linenos">550</span></a>        <span class="n">bias</span><span class="p">,</span>
</span><span id="L-551"><a href="#L-551"><span class="linenos">551</span></a>        <span class="n">broadcast_dropout</span><span class="o">=</span><span class="n">broadcast_dropout</span><span class="p">,</span>
</span><span id="L-552"><a href="#L-552"><span class="linenos">552</span></a>        <span class="n">rescale_logits</span><span class="o">=</span><span class="n">rescale_logits</span><span class="p">,</span>
</span><span id="L-553"><a href="#L-553"><span class="linenos">553</span></a>        <span class="n">dropout_rng</span><span class="o">=</span><span class="n">dropout_rng</span><span class="p">,</span>
</span><span id="L-554"><a href="#L-554"><span class="linenos">554</span></a>        <span class="n">dropout_rate</span><span class="o">=</span><span class="n">dropout_rate</span><span class="p">,</span>
</span><span id="L-555"><a href="#L-555"><span class="linenos">555</span></a>        <span class="n">enable_dropout</span><span class="o">=</span><span class="n">enable_dropout</span><span class="p">,</span>
</span><span id="L-556"><a href="#L-556"><span class="linenos">556</span></a>        <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
</span><span id="L-557"><a href="#L-557"><span class="linenos">557</span></a>        <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span>
</span><span id="L-558"><a href="#L-558"><span class="linenos">558</span></a>        <span class="n">use_extra_logit</span><span class="o">=</span><span class="n">use_extra_logit</span><span class="p">,</span>
</span><span id="L-559"><a href="#L-559"><span class="linenos">559</span></a>        <span class="n">float32_logits</span><span class="o">=</span><span class="n">float32_logits</span><span class="p">,</span>
</span><span id="L-560"><a href="#L-560"><span class="linenos">560</span></a>        <span class="n">causal_mask</span><span class="o">=</span><span class="n">causal_mask</span><span class="p">,</span>
</span><span id="L-561"><a href="#L-561"><span class="linenos">561</span></a>        <span class="n">query_chunk_size</span><span class="o">=</span><span class="n">query_chunk_size</span><span class="p">,</span>
</span><span id="L-562"><a href="#L-562"><span class="linenos">562</span></a>        <span class="n">key_chunk_size</span><span class="o">=</span><span class="n">key_chunk_size</span><span class="p">,</span>
</span><span id="L-563"><a href="#L-563"><span class="linenos">563</span></a>    <span class="p">)</span>
</span><span id="L-564"><a href="#L-564"><span class="linenos">564</span></a>    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># remove head dim</span>
</span><span id="L-565"><a href="#L-565"><span class="linenos">565</span></a>
</span><span id="L-566"><a href="#L-566"><span class="linenos">566</span></a>
</span><span id="L-567"><a href="#L-567"><span class="linenos">567</span></a><span class="k">def</span> <span class="nf">dot_product_attention_multihead</span><span class="p">(</span>
</span><span id="L-568"><a href="#L-568"><span class="linenos">568</span></a>        <span class="n">query</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
</span><span id="L-569"><a href="#L-569"><span class="linenos">569</span></a>        <span class="n">key</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
</span><span id="L-570"><a href="#L-570"><span class="linenos">570</span></a>        <span class="n">value</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
</span><span id="L-571"><a href="#L-571"><span class="linenos">571</span></a>        <span class="n">bias</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-572"><a href="#L-572"><span class="linenos">572</span></a>        <span class="n">broadcast_dropout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-573"><a href="#L-573"><span class="linenos">573</span></a>        <span class="n">rescale_logits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-574"><a href="#L-574"><span class="linenos">574</span></a>        <span class="n">dropout_rng</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PRNGKey</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-575"><a href="#L-575"><span class="linenos">575</span></a>        <span class="n">dropout_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="L-576"><a href="#L-576"><span class="linenos">576</span></a>        <span class="n">enable_dropout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-577"><a href="#L-577"><span class="linenos">577</span></a>        <span class="n">dtype</span><span class="p">:</span> <span class="n">DType</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
</span><span id="L-578"><a href="#L-578"><span class="linenos">578</span></a>        <span class="n">precision</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lax</span><span class="o">.</span><span class="n">Precision</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="L-579"><a href="#L-579"><span class="linenos">579</span></a>        <span class="n">use_extra_logit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-580"><a href="#L-580"><span class="linenos">580</span></a>        <span class="n">float32_logits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="L-581"><a href="#L-581"><span class="linenos">581</span></a>        <span class="n">causal_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="L-582"><a href="#L-582"><span class="linenos">582</span></a>        <span class="n">query_chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span>
</span><span id="L-583"><a href="#L-583"><span class="linenos">583</span></a>        <span class="n">key_chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2048</span><span class="p">,</span>
</span><span id="L-584"><a href="#L-584"><span class="linenos">584</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="L-585"><a href="#L-585"><span class="linenos">585</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes dot-product multi-head attention given query, key, and value.</span>
</span><span id="L-586"><a href="#L-586"><span class="linenos">586</span></a>
</span><span id="L-587"><a href="#L-587"><span class="linenos">587</span></a><span class="sd">    This implementation is equivalent to `dense_attention.dot_product_attention`,</span>
</span><span id="L-588"><a href="#L-588"><span class="linenos">588</span></a><span class="sd">    but is more memory-efficient.</span>
</span><span id="L-589"><a href="#L-589"><span class="linenos">589</span></a>
</span><span id="L-590"><a href="#L-590"><span class="linenos">590</span></a><span class="sd">    Note: query, key, value needn&#39;t have any batch dimensions.</span>
</span><span id="L-591"><a href="#L-591"><span class="linenos">591</span></a>
</span><span id="L-592"><a href="#L-592"><span class="linenos">592</span></a><span class="sd">    Args:</span>
</span><span id="L-593"><a href="#L-593"><span class="linenos">593</span></a><span class="sd">        query: queries for calculating attention with shape of `[batch..., q_length,</span>
</span><span id="L-594"><a href="#L-594"><span class="linenos">594</span></a><span class="sd">            num_heads, qk_depth_per_head]`.</span>
</span><span id="L-595"><a href="#L-595"><span class="linenos">595</span></a><span class="sd">        key: keys for calculating attention with shape of `[batch..., kv_length,</span>
</span><span id="L-596"><a href="#L-596"><span class="linenos">596</span></a><span class="sd">            num_heads, qk_depth_per_head]`.</span>
</span><span id="L-597"><a href="#L-597"><span class="linenos">597</span></a><span class="sd">        value: values to be used in attention with shape of `[batch..., kv_length,</span>
</span><span id="L-598"><a href="#L-598"><span class="linenos">598</span></a><span class="sd">            num_heads, v_depth_per_head]`.</span>
</span><span id="L-599"><a href="#L-599"><span class="linenos">599</span></a><span class="sd">        bias: bias for the attention weights. This should be broadcastable to the</span>
</span><span id="L-600"><a href="#L-600"><span class="linenos">600</span></a><span class="sd">            shape `[batch..., num_heads, q_length, kv_length]` This can be used for</span>
</span><span id="L-601"><a href="#L-601"><span class="linenos">601</span></a><span class="sd">            incorporating causal masks, padding masks, proximity bias, etc.</span>
</span><span id="L-602"><a href="#L-602"><span class="linenos">602</span></a><span class="sd">        broadcast_dropout: bool: use a broadcasted dropout along batch dims.</span>
</span><span id="L-603"><a href="#L-603"><span class="linenos">603</span></a><span class="sd">        rescale_logits: bool. Whether to rescale `query` logits by 1/sqrt(depth_kq).</span>
</span><span id="L-604"><a href="#L-604"><span class="linenos">604</span></a><span class="sd">        dropout_rng: JAX PRNGKey: to be used for dropout</span>
</span><span id="L-605"><a href="#L-605"><span class="linenos">605</span></a><span class="sd">        dropout_rate: dropout rate</span>
</span><span id="L-606"><a href="#L-606"><span class="linenos">606</span></a><span class="sd">        enable_dropout: bool, whether to apply dropout</span>
</span><span id="L-607"><a href="#L-607"><span class="linenos">607</span></a><span class="sd">        dtype: the dtype of the computation (default: float32)</span>
</span><span id="L-608"><a href="#L-608"><span class="linenos">608</span></a><span class="sd">        precision: numerical precision of the computation see `jax.lax.Precision`</span>
</span><span id="L-609"><a href="#L-609"><span class="linenos">609</span></a><span class="sd">            for details.</span>
</span><span id="L-610"><a href="#L-610"><span class="linenos">610</span></a><span class="sd">        use_extra_logit: whether to include a virtual extra logit equal to zero.</span>
</span><span id="L-611"><a href="#L-611"><span class="linenos">611</span></a><span class="sd">        float32_logits: bool, if True then compute logits in float32 to avoid</span>
</span><span id="L-612"><a href="#L-612"><span class="linenos">612</span></a><span class="sd">            numerical issues with bfloat16.</span>
</span><span id="L-613"><a href="#L-613"><span class="linenos">613</span></a><span class="sd">        causal_mask: Apply a causal mask. This can be used alternatively or in</span>
</span><span id="L-614"><a href="#L-614"><span class="linenos">614</span></a><span class="sd">            addition to the given bias.</span>
</span><span id="L-615"><a href="#L-615"><span class="linenos">615</span></a><span class="sd">        query_chunk_size: Positive integer to control the size of the query chunks.</span>
</span><span id="L-616"><a href="#L-616"><span class="linenos">616</span></a><span class="sd">        key_chunk_size: Positive integer to control the size of the key chunks.</span>
</span><span id="L-617"><a href="#L-617"><span class="linenos">617</span></a>
</span><span id="L-618"><a href="#L-618"><span class="linenos">618</span></a><span class="sd">    Returns:</span>
</span><span id="L-619"><a href="#L-619"><span class="linenos">619</span></a><span class="sd">        Output of shape `[batch..., length, num_heads, v_depth_per_head]`.</span>
</span><span id="L-620"><a href="#L-620"><span class="linenos">620</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="L-621"><a href="#L-621"><span class="linenos">621</span></a>    <span class="c1"># queries_per_head</span>
</span><span id="L-622"><a href="#L-622"><span class="linenos">622</span></a>    <span class="n">query</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
</span><span id="L-623"><a href="#L-623"><span class="linenos">623</span></a>    <span class="k">if</span> <span class="n">bias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="L-624"><a href="#L-624"><span class="linenos">624</span></a>        <span class="c1"># add num_heads, treat current num_heads dim as queries_per_head</span>
</span><span id="L-625"><a href="#L-625"><span class="linenos">625</span></a>        <span class="n">bias</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">bias</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">3</span><span class="p">)</span>
</span><span id="L-626"><a href="#L-626"><span class="linenos">626</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">dot_product_attention_queries_per_head</span><span class="p">(</span>
</span><span id="L-627"><a href="#L-627"><span class="linenos">627</span></a>        <span class="n">query</span><span class="p">,</span>
</span><span id="L-628"><a href="#L-628"><span class="linenos">628</span></a>        <span class="n">key</span><span class="p">,</span>
</span><span id="L-629"><a href="#L-629"><span class="linenos">629</span></a>        <span class="n">value</span><span class="p">,</span>
</span><span id="L-630"><a href="#L-630"><span class="linenos">630</span></a>        <span class="n">bias</span><span class="p">,</span>
</span><span id="L-631"><a href="#L-631"><span class="linenos">631</span></a>        <span class="n">broadcast_dropout</span><span class="o">=</span><span class="n">broadcast_dropout</span><span class="p">,</span>
</span><span id="L-632"><a href="#L-632"><span class="linenos">632</span></a>        <span class="n">rescale_logits</span><span class="o">=</span><span class="n">rescale_logits</span><span class="p">,</span>
</span><span id="L-633"><a href="#L-633"><span class="linenos">633</span></a>        <span class="n">dropout_rng</span><span class="o">=</span><span class="n">dropout_rng</span><span class="p">,</span>
</span><span id="L-634"><a href="#L-634"><span class="linenos">634</span></a>        <span class="n">dropout_rate</span><span class="o">=</span><span class="n">dropout_rate</span><span class="p">,</span>
</span><span id="L-635"><a href="#L-635"><span class="linenos">635</span></a>        <span class="n">enable_dropout</span><span class="o">=</span><span class="n">enable_dropout</span><span class="p">,</span>
</span><span id="L-636"><a href="#L-636"><span class="linenos">636</span></a>        <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
</span><span id="L-637"><a href="#L-637"><span class="linenos">637</span></a>        <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span>
</span><span id="L-638"><a href="#L-638"><span class="linenos">638</span></a>        <span class="n">use_extra_logit</span><span class="o">=</span><span class="n">use_extra_logit</span><span class="p">,</span>
</span><span id="L-639"><a href="#L-639"><span class="linenos">639</span></a>        <span class="n">float32_logits</span><span class="o">=</span><span class="n">float32_logits</span><span class="p">,</span>
</span><span id="L-640"><a href="#L-640"><span class="linenos">640</span></a>        <span class="n">causal_mask</span><span class="o">=</span><span class="n">causal_mask</span><span class="p">,</span>
</span><span id="L-641"><a href="#L-641"><span class="linenos">641</span></a>        <span class="n">query_chunk_size</span><span class="o">=</span><span class="n">query_chunk_size</span><span class="p">,</span>
</span><span id="L-642"><a href="#L-642"><span class="linenos">642</span></a>        <span class="n">key_chunk_size</span><span class="o">=</span><span class="n">key_chunk_size</span><span class="p">,</span>
</span><span id="L-643"><a href="#L-643"><span class="linenos">643</span></a>    <span class="p">)</span>
</span><span id="L-644"><a href="#L-644"><span class="linenos">644</span></a>    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># remove queries_per_head dim</span>
</span></pre></div>


            </section>
                <section id="Array">
                    <div class="attr class">
            
    <span class="def">class</span>
    <span class="name">Array</span><wbr>(<span class="base">abc.ABC</span>):

        
    </div>
    <a class="headerlink" href="#Array"></a>
    
            <div class="docstring"><p>Array base class for JAX</p>

<p><code><a href="#Array">Array</a></code> is the public interface for instance checks and type annotation
of JAX arrays and tracers. Its main applications are in instance checks and
type annotations; for example::</p>

<p>x = jnp.arange(5)
  isinstance(x, <a href="#Array">Array</a>)  # returns True both inside and outside traced functions.</p>

<p>def f(x: Array) -> Array:  # type annotations are valid for traced and non-traced types.
    return x</p>

<p><code><a href="#Array">Array</a></code> should not be used directly for creation of arrays; instead you
should use array creation routines offered in <code>jax.numpy</code>, such as
<code>jax.numpy.array()</code>, <code>jax.numpy.zeros()</code>, <code>jax.numpy.ones()</code>,
<code>jax.numpy.full()</code>, <code>jax.numpy.arange()</code>, etc.</p>
</div>


                            <div id="Array.at" class="classattr">
                                <div class="attr variable">
            <span class="name">at</span>

        
    </div>
    <a class="headerlink" href="#Array.at"></a>
    
            <div class="docstring"><p>Helper property for index update functionality.</p>

<p>The <code><a href="#Array.at">at</a></code> property provides a functionally pure equivalent of in-place
array modifications.</p>

<p>In particular:</p>

<p>==============================  ================================
Alternate syntax                Equivalent In-place expression
==============================  ================================
<code>x = x.at[idx].set(y)</code>        <code>x[idx] = y</code>
<code>x = x.at[idx].add(y)</code>        <code>x[idx] += y</code>
<code>x = x.at[idx].multiply(y)</code>   <code>x[idx] *= y</code>
<code>x = x.at[idx].divide(y)</code>     <code>x[idx] /= y</code>
<code>x = x.at[idx].power(y)</code>      <code>x[idx] **= y</code>
<code>x = x.at[idx].min(y)</code>        <code>x[idx] = minimum(x[idx], y)</code>
<code>x = x.at[idx].max(y)</code>        <code>x[idx] = maximum(x[idx], y)</code>
<code>x = x.at[idx].apply(ufunc)</code>  <code>ufunc.at(x, idx)</code>
<code>x = x.at[idx].get()</code>         <code>x = x[idx]</code>
==============================  ================================</p>

<p>None of the <code>x.at</code> expressions modify the original <code>x</code>; instead they return
a modified copy of <code>x</code>. However, inside a <code>~jax.jit()</code> compiled function,
expressions like :code:<code>x = x.at[idx].set(y)</code> are guaranteed to be applied in-place.</p>

<p>Unlike NumPy in-place operations such as :code:<code>x[idx] += y</code>, if multiple
indices refer to the same location, all updates will be applied (NumPy would
only apply the last update, rather than applying all updates.) The order
in which conflicting updates are applied is implementation-defined and may be
nondeterministic (e.g., due to concurrency on some hardware platforms).</p>

<p>By default, JAX assumes that all indices are in-bounds. Alternative out-of-bound
index semantics can be specified via the <code>mode</code> parameter (see below).</p>

<h6 id="arguments">Arguments</h6>

<p>mode : str
    Specify out-of-bound indexing mode. Options are:</p>

<pre><code>- ``"promise_in_bounds"``: (default) The user promises that indices are in bounds.
  No additional checking will be performed. In practice, this means that
  out-of-bounds indices in ``get()`` will be clipped, and out-of-bounds indices
  in ``set()``, ``add()``, etc. will be dropped.
- ``"clip"``: clamp out of bounds indices into valid range.
- ``"drop"``: ignore out-of-bound indices.
- ``"fill"``: alias for ``"drop"``.  For `get()`, the optional ``fill_value``
  argument specifies the value that will be returned.

  See `jax.lax.GatherScatterMode` for more details.
</code></pre>

<p>indices_are_sorted : bool
    If True, the implementation will assume that the indices passed to <code>at[]</code>
    are sorted in ascending order, which can lead to more efficient execution
    on some backends.
unique_indices : bool
    If True, the implementation will assume that the indices passed to <code>at[]</code>
    are unique, which can result in more efficient execution on some backends.
fill_value : Any
    Only applies to the <code>get()</code> method: the fill value to return for out-of-bounds
    slices when <code>mode</code> is <code>'fill'</code>. Ignored otherwise. Defaults to <code>NaN</code> for
    inexact types, the largest negative value for signed types, the largest positive
    value for unsigned types, and <code>True</code> for booleans.</p>

<h6 id="examples">Examples</h6>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mf">5.0</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span>
<span class="go">Array([0., 1., 2., 3., 4.], dtype=float32)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="go">Array([ 0.,  1., 12.,  3.,  4.], dtype=float32)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>  <span class="c1"># out-of-bounds indices are ignored</span>
<span class="go">Array([0., 1., 2., 3., 4.], dtype=float32)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;clip&#39;</span><span class="p">)</span>
<span class="go">Array([ 0.,  1.,  2.,  3., 14.], dtype=float32)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>
<span class="go">Array(2., dtype=float32)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">()</span>  <span class="c1"># out-of-bounds indices clipped</span>
<span class="go">Array(4., dtype=float32)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;fill&#39;</span><span class="p">)</span>  <span class="c1"># out-of-bounds indices filled with NaN</span>
<span class="go">Array(nan, dtype=float32)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">20</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">mode</span><span class="o">=</span><span class="s1">&#39;fill&#39;</span><span class="p">,</span> <span class="n">fill_value</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># custom fill value</span>
<span class="go">Array(-1., dtype=float32)</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="Array.all" class="classattr">
                                        <input id="Array.all-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">all</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">axis</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">keepdims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">where</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.all-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.all"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.all-282"><a href="#Array.all-282"><span class="linenos">282</span></a><span class="nd">@_wraps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">,</span> <span class="n">skip_params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">])</span>
</span><span id="Array.all-283"><a href="#Array.all-283"><span class="linenos">283</span></a><span class="k">def</span> <span class="nf">all</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="n">Axis</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Array.all-284"><a href="#Array.all-284"><span class="linenos">284</span></a>        <span class="n">keepdims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">where</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.all-285"><a href="#Array.all-285"><span class="linenos">285</span></a>  <span class="k">return</span> <span class="n">_reduce_all</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">_ensure_optional_axes</span><span class="p">(</span><span class="n">axis</span><span class="p">),</span> <span class="n">out</span><span class="o">=</span><span class="n">out</span><span class="p">,</span>
</span><span id="Array.all-286"><a href="#Array.all-286"><span class="linenos">286</span></a>                     <span class="n">keepdims</span><span class="o">=</span><span class="n">keepdims</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">where</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Test whether all array elements along a given axis evaluate to True.</p>

<p>LAX-backend implementation of <code>numpy.all()</code>.</p>

<p><em>Original docstring below.</em></p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (array_like):
Input array or object that can be converted to an array.</li>
<li><strong>axis</strong> (None or int or tuple of ints, optional):
Axis or axes along which a logical AND reduction is performed.
The default (<code>axis=None</code>) is to perform a logical AND over all
the dimensions of the input array. <code>axis</code> may be negative, in
which case it counts from the last to the first axis.</li>
<li><p><strong>keepdims</strong> (bool, optional):
If this is set to True, the axes which are reduced are left
in the result as dimensions with size one. With this option,
the result will broadcast correctly against the input array.</p>

<p>If the default value is passed, then <code>keepdims</code> will not be
passed through to the <code><a href="#Array.all">all</a></code> method of sub-classes of
<code>ndarray</code>, however any non-default value will be.  If the
sub-class' method does not implement <code>keepdims</code> any
exceptions will be raised.</p></li>
<li><strong>where</strong> (array_like of bool, optional):
Elements to include in checking for all <code>True</code> values.
See <code>~numpy.ufunc.reduce</code> for details.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>all</strong> (ndarray, bool):
A new boolean or array is returned unless <code>out</code> is specified,
in which case a reference to <code>out</code> is returned.</li>
</ul>
</div>


                            </div>
                            <div id="Array.any" class="classattr">
                                        <input id="Array.any-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">any</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">axis</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">keepdims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">where</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.any-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.any"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.any-294"><a href="#Array.any-294"><span class="linenos">294</span></a><span class="nd">@_wraps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">,</span> <span class="n">skip_params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">])</span>
</span><span id="Array.any-295"><a href="#Array.any-295"><span class="linenos">295</span></a><span class="k">def</span> <span class="nf">any</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="n">Axis</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Array.any-296"><a href="#Array.any-296"><span class="linenos">296</span></a>        <span class="n">keepdims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">where</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.any-297"><a href="#Array.any-297"><span class="linenos">297</span></a>  <span class="k">return</span> <span class="n">_reduce_any</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">_ensure_optional_axes</span><span class="p">(</span><span class="n">axis</span><span class="p">),</span> <span class="n">out</span><span class="o">=</span><span class="n">out</span><span class="p">,</span>
</span><span id="Array.any-298"><a href="#Array.any-298"><span class="linenos">298</span></a>                     <span class="n">keepdims</span><span class="o">=</span><span class="n">keepdims</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">where</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Test whether any array element along a given axis evaluates to True.</p>

<p>LAX-backend implementation of <code>numpy.any()</code>.</p>

<p><em>Original docstring below.</em></p>

<p>Returns single boolean if <code>axis</code> is <code>None</code></p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (array_like):
Input array or object that can be converted to an array.</li>
<li><strong>axis</strong> (None or int or tuple of ints, optional):
Axis or axes along which a logical OR reduction is performed.
The default (<code>axis=None</code>) is to perform a logical OR over all
the dimensions of the input array. <code>axis</code> may be negative, in
which case it counts from the last to the first axis.</li>
<li><p><strong>keepdims</strong> (bool, optional):
If this is set to True, the axes which are reduced are left
in the result as dimensions with size one. With this option,
the result will broadcast correctly against the input array.</p>

<p>If the default value is passed, then <code>keepdims</code> will not be
passed through to the <code><a href="#Array.any">any</a></code> method of sub-classes of
<code>ndarray</code>, however any non-default value will be.  If the
sub-class' method does not implement <code>keepdims</code> any
exceptions will be raised.</p></li>
<li><strong>where</strong> (array_like of bool, optional):
Elements to include in checking for any <code>True</code> values.
See <code>~numpy.ufunc.reduce</code> for details.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>any</strong> (bool or ndarray):
A new boolean or <code>ndarray</code> is returned unless <code>out</code> is specified,
in which case a reference to <code>out</code> is returned.</li>
</ul>
</div>


                            </div>
                            <div id="Array.argmax" class="classattr">
                                        <input id="Array.argmax-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@util._wraps(np.argmax, skip_params=[&#39;out&#39;])</div>

        <span class="def">def</span>
        <span class="name">argmax</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">keepdims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.argmax-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.argmax"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.argmax-3676"><a href="#Array.argmax-3676"><span class="linenos">3676</span></a><span class="nd">@util</span><span class="o">.</span><span class="n">_wraps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">,</span> <span class="n">skip_params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">])</span>
</span><span id="Array.argmax-3677"><a href="#Array.argmax-3677"><span class="linenos">3677</span></a><span class="k">def</span> <span class="nf">argmax</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Array.argmax-3678"><a href="#Array.argmax-3678"><span class="linenos">3678</span></a>           <span class="n">keepdims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.argmax-3679"><a href="#Array.argmax-3679"><span class="linenos">3679</span></a>  <span class="n">util</span><span class="o">.</span><span class="n">check_arraylike</span><span class="p">(</span><span class="s2">&quot;argmax&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span><span id="Array.argmax-3680"><a href="#Array.argmax-3680"><span class="linenos">3680</span></a>  <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Array.argmax-3681"><a href="#Array.argmax-3681"><span class="linenos">3681</span></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;The &#39;out&#39; argument to jnp.argmax is not supported.&quot;</span><span class="p">)</span>
</span><span id="Array.argmax-3682"><a href="#Array.argmax-3682"><span class="linenos">3682</span></a>  <span class="k">return</span> <span class="n">_argmax</span><span class="p">(</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">operator</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">axis</span><span class="p">),</span>
</span><span id="Array.argmax-3683"><a href="#Array.argmax-3683"><span class="linenos">3683</span></a>                 <span class="n">keepdims</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">keepdims</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Returns the indices of the maximum values along an axis.</p>

<p>LAX-backend implementation of <code>numpy.argmax()</code>.</p>

<p><em>Original docstring below.</em></p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (array_like):
Input array.</li>
<li><strong>axis</strong> (int, optional):
By default, the index is into the flattened array, otherwise
along the specified axis.</li>
<li><strong>keepdims</strong> (bool, optional):
If this is set to True, the axes which are reduced are left
in the result as dimensions with size one. With this option,
the result will broadcast correctly against the array.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>index_array</strong> (ndarray of ints):
Array of indices into the array. It has the same shape as <code>a.shape</code>
with the dimension along <code>axis</code> removed. If <code>keepdims</code> is set to True,
then the size of <code>axis</code> will be 1 with the resulting array having same
shape as <code>a.shape</code>.</li>
</ul>
</div>


                            </div>
                            <div id="Array.argmin" class="classattr">
                                        <input id="Array.argmin-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@util._wraps(np.argmin, skip_params=[&#39;out&#39;])</div>

        <span class="def">def</span>
        <span class="name">argmin</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">keepdims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.argmin-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.argmin"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.argmin-3698"><a href="#Array.argmin-3698"><span class="linenos">3698</span></a><span class="nd">@util</span><span class="o">.</span><span class="n">_wraps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">,</span> <span class="n">skip_params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">])</span>
</span><span id="Array.argmin-3699"><a href="#Array.argmin-3699"><span class="linenos">3699</span></a><span class="k">def</span> <span class="nf">argmin</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Array.argmin-3700"><a href="#Array.argmin-3700"><span class="linenos">3700</span></a>           <span class="n">keepdims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.argmin-3701"><a href="#Array.argmin-3701"><span class="linenos">3701</span></a>  <span class="n">util</span><span class="o">.</span><span class="n">check_arraylike</span><span class="p">(</span><span class="s2">&quot;argmin&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span><span id="Array.argmin-3702"><a href="#Array.argmin-3702"><span class="linenos">3702</span></a>  <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Array.argmin-3703"><a href="#Array.argmin-3703"><span class="linenos">3703</span></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;The &#39;out&#39; argument to jnp.argmin is not supported.&quot;</span><span class="p">)</span>
</span><span id="Array.argmin-3704"><a href="#Array.argmin-3704"><span class="linenos">3704</span></a>  <span class="k">return</span> <span class="n">_argmin</span><span class="p">(</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">operator</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">axis</span><span class="p">),</span>
</span><span id="Array.argmin-3705"><a href="#Array.argmin-3705"><span class="linenos">3705</span></a>                 <span class="n">keepdims</span><span class="o">=</span><span class="nb">bool</span><span class="p">(</span><span class="n">keepdims</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Returns the indices of the minimum values along an axis.</p>

<p>LAX-backend implementation of <code>numpy.argmin()</code>.</p>

<p><em>Original docstring below.</em></p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (array_like):
Input array.</li>
<li><strong>axis</strong> (int, optional):
By default, the index is into the flattened array, otherwise
along the specified axis.</li>
<li><strong>keepdims</strong> (bool, optional):
If this is set to True, the axes which are reduced are left
in the result as dimensions with size one. With this option,
the result will broadcast correctly against the array.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>index_array</strong> (ndarray of ints):
Array of indices into the array. It has the same shape as <code>a.shape</code>
with the dimension along <code>axis</code> removed. If <code>keepdims</code> is set to True,
then the size of <code>axis</code> will be 1 with the resulting array having same
shape as <code>a.shape</code>.</li>
</ul>
</div>


                            </div>
                            <div id="Array.argpartition" class="classattr">
                                        <input id="Array.argpartition-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@util._wraps(np.argpartition, lax_description=&#34;\nThe JAX version requires the ``kth`` argument to be a static integer rather than\na general array. This is implemented via two calls to :func:`jax.lax.top_k`. If\nyou&#39;re only accessing the top or bottom k values of the output, it may be more\nefficient to call :func:`jax.lax.top_k` directly.\n\nThe JAX version differs from the NumPy version in the treatment of NaN entries;\nNaNs which have the negative bit set are sorted to the beginning of the array.\n&#34;)</div>
        <div class="decorator">@partial(jit, static_argnames=[&#39;kth&#39;, &#39;axis&#39;])</div>

        <span class="def">def</span>
        <span class="name">argpartition</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">kth</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.argpartition-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.argpartition"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.argpartition-3877"><a href="#Array.argpartition-3877"><span class="linenos">3877</span></a><span class="nd">@util</span><span class="o">.</span><span class="n">_wraps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argpartition</span><span class="p">,</span> <span class="n">lax_description</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="Array.argpartition-3878"><a href="#Array.argpartition-3878"><span class="linenos">3878</span></a><span class="s2">The JAX version requires the ``kth`` argument to be a static integer rather than</span>
</span><span id="Array.argpartition-3879"><a href="#Array.argpartition-3879"><span class="linenos">3879</span></a><span class="s2">a general array. This is implemented via two calls to :func:`jax.lax.top_k`. If</span>
</span><span id="Array.argpartition-3880"><a href="#Array.argpartition-3880"><span class="linenos">3880</span></a><span class="s2">you&#39;re only accessing the top or bottom k values of the output, it may be more</span>
</span><span id="Array.argpartition-3881"><a href="#Array.argpartition-3881"><span class="linenos">3881</span></a><span class="s2">efficient to call :func:`jax.lax.top_k` directly.</span>
</span><span id="Array.argpartition-3882"><a href="#Array.argpartition-3882"><span class="linenos">3882</span></a>
</span><span id="Array.argpartition-3883"><a href="#Array.argpartition-3883"><span class="linenos">3883</span></a><span class="s2">The JAX version differs from the NumPy version in the treatment of NaN entries;</span>
</span><span id="Array.argpartition-3884"><a href="#Array.argpartition-3884"><span class="linenos">3884</span></a><span class="s2">NaNs which have the negative bit set are sorted to the beginning of the array.</span>
</span><span id="Array.argpartition-3885"><a href="#Array.argpartition-3885"><span class="linenos">3885</span></a><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="Array.argpartition-3886"><a href="#Array.argpartition-3886"><span class="linenos">3886</span></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnames</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;kth&#39;</span><span class="p">,</span> <span class="s1">&#39;axis&#39;</span><span class="p">])</span>
</span><span id="Array.argpartition-3887"><a href="#Array.argpartition-3887"><span class="linenos">3887</span></a><span class="k">def</span> <span class="nf">argpartition</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">kth</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.argpartition-3888"><a href="#Array.argpartition-3888"><span class="linenos">3888</span></a>  <span class="c1"># TODO(jakevdp): handle NaN values like numpy.</span>
</span><span id="Array.argpartition-3889"><a href="#Array.argpartition-3889"><span class="linenos">3889</span></a>  <span class="n">util</span><span class="o">.</span><span class="n">check_arraylike</span><span class="p">(</span><span class="s2">&quot;partition&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span><span id="Array.argpartition-3890"><a href="#Array.argpartition-3890"><span class="linenos">3890</span></a>  <span class="n">arr</span> <span class="o">=</span> <span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="Array.argpartition-3891"><a href="#Array.argpartition-3891"><span class="linenos">3891</span></a>  <span class="k">if</span> <span class="n">issubdtype</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">complexfloating</span><span class="p">):</span>
</span><span id="Array.argpartition-3892"><a href="#Array.argpartition-3892"><span class="linenos">3892</span></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;jnp.argpartition for complex dtype is not implemented.&quot;</span><span class="p">)</span>
</span><span id="Array.argpartition-3893"><a href="#Array.argpartition-3893"><span class="linenos">3893</span></a>  <span class="n">axis</span> <span class="o">=</span> <span class="n">_canonicalize_axis</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">arr</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span>
</span><span id="Array.argpartition-3894"><a href="#Array.argpartition-3894"><span class="linenos">3894</span></a>  <span class="n">kth</span> <span class="o">=</span> <span class="n">_canonicalize_axis</span><span class="p">(</span><span class="n">kth</span><span class="p">,</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis</span><span class="p">])</span>
</span><span id="Array.argpartition-3895"><a href="#Array.argpartition-3895"><span class="linenos">3895</span></a>
</span><span id="Array.argpartition-3896"><a href="#Array.argpartition-3896"><span class="linenos">3896</span></a>  <span class="n">arr</span> <span class="o">=</span> <span class="n">swapaxes</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Array.argpartition-3897"><a href="#Array.argpartition-3897"><span class="linenos">3897</span></a>  <span class="n">bottom_ind</span> <span class="o">=</span> <span class="n">lax</span><span class="o">.</span><span class="n">top_k</span><span class="p">(</span><span class="o">-</span><span class="n">arr</span><span class="p">,</span> <span class="n">kth</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Array.argpartition-3898"><a href="#Array.argpartition-3898"><span class="linenos">3898</span></a>
</span><span id="Array.argpartition-3899"><a href="#Array.argpartition-3899"><span class="linenos">3899</span></a>  <span class="c1"># To avoid issues with duplicate values, we compute the top indices via a proxy</span>
</span><span id="Array.argpartition-3900"><a href="#Array.argpartition-3900"><span class="linenos">3900</span></a>  <span class="n">set_to_zero</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span> <span class="n">i</span><span class="p">:</span> <span class="n">a</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Array.argpartition-3901"><a href="#Array.argpartition-3901"><span class="linenos">3901</span></a>  <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
</span><span id="Array.argpartition-3902"><a href="#Array.argpartition-3902"><span class="linenos">3902</span></a>    <span class="n">set_to_zero</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">set_to_zero</span><span class="p">)</span>
</span><span id="Array.argpartition-3903"><a href="#Array.argpartition-3903"><span class="linenos">3903</span></a>  <span class="n">proxy</span> <span class="o">=</span> <span class="n">set_to_zero</span><span class="p">(</span><span class="n">ones</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="n">bottom_ind</span><span class="p">)</span>
</span><span id="Array.argpartition-3904"><a href="#Array.argpartition-3904"><span class="linenos">3904</span></a>  <span class="n">top_ind</span> <span class="o">=</span> <span class="n">lax</span><span class="o">.</span><span class="n">top_k</span><span class="p">(</span><span class="n">proxy</span><span class="p">,</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">kth</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
</span><span id="Array.argpartition-3905"><a href="#Array.argpartition-3905"><span class="linenos">3905</span></a>  <span class="n">out</span> <span class="o">=</span> <span class="n">lax</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">bottom_ind</span><span class="p">,</span> <span class="n">top_ind</span><span class="p">],</span> <span class="n">dimension</span><span class="o">=</span><span class="n">arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Array.argpartition-3906"><a href="#Array.argpartition-3906"><span class="linenos">3906</span></a>  <span class="k">return</span> <span class="n">swapaxes</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Perform an indirect partition along the given axis using the</p>

<p>LAX-backend implementation of <code>numpy.argpartition()</code>.</p>

<p>The JAX version requires the <code>kth</code> argument to be a static integer rather than
a general array. This is implemented via two calls to <code>jax.lax.top_k()</code>. If
you're only accessing the top or bottom k values of the output, it may be more
efficient to call <code>jax.lax.top_k()</code> directly.</p>

<p>The JAX version differs from the NumPy version in the treatment of NaN entries;
NaNs which have the negative bit set are sorted to the beginning of the array.</p>

<p><em>Original docstring below.</em></p>

<p>algorithm specified by the <code>kind</code> keyword. It returns an array of
indices of the same shape as <code>a</code> that index data along the given
axis in partitioned order.</p>

<p><em>New in version 1.8.0.</em></p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (array_like):
Array to sort.</li>
<li><p><strong>kth</strong> (int or sequence of ints):
Element index to partition by. The k-th element will be in its
final sorted position and all smaller elements will be moved
before it and all larger elements behind it. The order of all
elements in the partitions is undefined. If provided with a
sequence of k-th it will partition all of them into their sorted
position at once.</p>

<p><em>Deprecated since version 1.22.0:</em>
Passing booleans as index is deprecated.</p></li>
<li><strong>axis</strong> (int or None, optional):
Axis along which to sort. The default is -1 (the last axis). If
None, the flattened array is used.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>index_array</strong> (ndarray, int):
Array of indices that partition <code>a</code> along the specified axis.
If <code>a</code> is one-dimensional, <code>a[index_array]</code> yields a partitioned <code>a</code>.
More generally, <code>np.take_along_axis(a, index_array, axis=axis)</code>
always yields the partitioned <code>a</code>, irrespective of dimensionality.</li>
</ul>
</div>


                            </div>
                            <div id="Array.argsort" class="classattr">
                                        <input id="Array.argsort-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@util._wraps(np.argsort, lax_description=_ARGSORT_DOC)</div>
        <div class="decorator">@partial(jit, static_argnames=(&#39;axis&#39;, &#39;kind&#39;, &#39;order&#39;))</div>

        <span class="def">def</span>
        <span class="name">argsort</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>,</span><span class="param">	<span class="n">kind</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;stable&#39;</span>,</span><span class="param">	<span class="n">order</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.argsort-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.argsort"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.argsort-3825"><a href="#Array.argsort-3825"><span class="linenos">3825</span></a><span class="nd">@util</span><span class="o">.</span><span class="n">_wraps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">,</span> <span class="n">lax_description</span><span class="o">=</span><span class="n">_ARGSORT_DOC</span><span class="p">)</span>
</span><span id="Array.argsort-3826"><a href="#Array.argsort-3826"><span class="linenos">3826</span></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnames</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;axis&#39;</span><span class="p">,</span> <span class="s1">&#39;kind&#39;</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">))</span>
</span><span id="Array.argsort-3827"><a href="#Array.argsort-3827"><span class="linenos">3827</span></a><span class="k">def</span> <span class="nf">argsort</span><span class="p">(</span>
</span><span id="Array.argsort-3828"><a href="#Array.argsort-3828"><span class="linenos">3828</span></a>    <span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="Array.argsort-3829"><a href="#Array.argsort-3829"><span class="linenos">3829</span></a>    <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
</span><span id="Array.argsort-3830"><a href="#Array.argsort-3830"><span class="linenos">3830</span></a>    <span class="n">kind</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;stable&quot;</span><span class="p">,</span>
</span><span id="Array.argsort-3831"><a href="#Array.argsort-3831"><span class="linenos">3831</span></a>    <span class="n">order</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Array.argsort-3832"><a href="#Array.argsort-3832"><span class="linenos">3832</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.argsort-3833"><a href="#Array.argsort-3833"><span class="linenos">3833</span></a>  <span class="n">util</span><span class="o">.</span><span class="n">check_arraylike</span><span class="p">(</span><span class="s2">&quot;argsort&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span><span id="Array.argsort-3834"><a href="#Array.argsort-3834"><span class="linenos">3834</span></a>  <span class="n">arr</span> <span class="o">=</span> <span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="Array.argsort-3835"><a href="#Array.argsort-3835"><span class="linenos">3835</span></a>  <span class="k">if</span> <span class="n">kind</span> <span class="o">!=</span> <span class="s1">&#39;stable&#39;</span><span class="p">:</span>
</span><span id="Array.argsort-3836"><a href="#Array.argsort-3836"><span class="linenos">3836</span></a>    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;&#39;kind&#39; argument to argsort is ignored; only &#39;stable&#39; sorts &quot;</span>
</span><span id="Array.argsort-3837"><a href="#Array.argsort-3837"><span class="linenos">3837</span></a>                  <span class="s2">&quot;are supported.&quot;</span><span class="p">)</span>
</span><span id="Array.argsort-3838"><a href="#Array.argsort-3838"><span class="linenos">3838</span></a>  <span class="k">if</span> <span class="n">order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Array.argsort-3839"><a href="#Array.argsort-3839"><span class="linenos">3839</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;order&#39; argument to argsort is not supported.&quot;</span><span class="p">)</span>
</span><span id="Array.argsort-3840"><a href="#Array.argsort-3840"><span class="linenos">3840</span></a>
</span><span id="Array.argsort-3841"><a href="#Array.argsort-3841"><span class="linenos">3841</span></a>  <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Array.argsort-3842"><a href="#Array.argsort-3842"><span class="linenos">3842</span></a>    <span class="k">return</span> <span class="n">argsort</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">ravel</span><span class="p">(),</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Array.argsort-3843"><a href="#Array.argsort-3843"><span class="linenos">3843</span></a>  <span class="k">else</span><span class="p">:</span>
</span><span id="Array.argsort-3844"><a href="#Array.argsort-3844"><span class="linenos">3844</span></a>    <span class="n">axis_num</span> <span class="o">=</span> <span class="n">_canonicalize_axis</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">arr</span><span class="o">.</span><span class="n">ndim</span><span class="p">)</span>
</span><span id="Array.argsort-3845"><a href="#Array.argsort-3845"><span class="linenos">3845</span></a>    <span class="n">use_64bit_index</span> <span class="o">=</span> <span class="ow">not</span> <span class="n">core</span><span class="o">.</span><span class="n">is_constant_dim</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis_num</span><span class="p">])</span> <span class="ow">or</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="n">axis_num</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">31</span><span class="p">)</span>
</span><span id="Array.argsort-3846"><a href="#Array.argsort-3846"><span class="linenos">3846</span></a>    <span class="n">iota</span> <span class="o">=</span> <span class="n">lax</span><span class="o">.</span><span class="n">broadcasted_iota</span><span class="p">(</span><span class="n">int64</span> <span class="k">if</span> <span class="n">use_64bit_index</span> <span class="k">else</span> <span class="n">int_</span><span class="p">,</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">axis_num</span><span class="p">)</span>
</span><span id="Array.argsort-3847"><a href="#Array.argsort-3847"><span class="linenos">3847</span></a>    <span class="n">_</span><span class="p">,</span> <span class="n">perm</span> <span class="o">=</span> <span class="n">lax</span><span class="o">.</span><span class="n">sort_key_val</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">iota</span><span class="p">,</span> <span class="n">dimension</span><span class="o">=</span><span class="n">axis_num</span><span class="p">)</span>
</span><span id="Array.argsort-3848"><a href="#Array.argsort-3848"><span class="linenos">3848</span></a>    <span class="k">return</span> <span class="n">perm</span>
</span></pre></div>


            <div class="docstring"><p>Returns the indices that would sort an array.</p>

<p>LAX-backend implementation of <code>numpy.argsort()</code>.</p>

<p>Only :code:<code>kind='stable'</code> is supported. Other :code:<code>kind</code> values will produce
a warning and be treated as if they were :code:<code>'stable'</code>.</p>

<p><em>Original docstring below.</em></p>

<p>Perform an indirect sort along the given axis using the algorithm specified
by the <code>kind</code> keyword. It returns an array of indices of the same shape as
<code>a</code> that index data along the given axis in sorted order.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (array_like):
Array to sort.</li>
<li><strong>axis</strong> (int or None, optional):
Axis along which to sort.  The default is -1 (the last axis). If None,
the flattened array is used.</li>
<li><p><strong>kind</strong> ({'quicksort', 'mergesort', 'heapsort', 'stable'}, optional):
Sorting algorithm. The default is 'quicksort'. Note that both 'stable'
and 'mergesort' use timsort under the covers and, in general, the
actual implementation will vary with data type. The 'mergesort' option
is retained for backwards compatibility.</p>

<p><em>Changed in version 1.15.0.:</em>
The 'stable' option was added.</p></li>
<li><strong>order</strong> (str or list of str, optional):
When <code>a</code> is an array with fields defined, this argument specifies
which fields to compare first, second, etc.  A single field can
be specified as a string, and not all fields need be specified,
but unspecified fields will still be used, in the order in which
they come up in the dtype, to break ties.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>index_array</strong> (ndarray, int):
Array of indices that sort <code>a</code> along the specified <code>axis</code>.
If <code>a</code> is one-dimensional, <code>a[index_array]</code> yields a sorted <code>a</code>.
More generally, <code>np.take_along_axis(a, index_array, axis=axis)</code>
always yields the sorted <code>a</code>, irrespective of dimensionality.</li>
</ul>
</div>


                            </div>
                            <div id="Array.astype" class="classattr">
                                        <input id="Array.astype-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">astype</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">arr</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">dtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">SupportsDType</span><span class="p">]</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.astype-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.astype"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.astype-56"><a href="#Array.astype-56"><span class="linenos">56</span></a><span class="k">def</span> <span class="nf">_astype</span><span class="p">(</span><span class="n">arr</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">DTypeLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.astype-57"><a href="#Array.astype-57"><span class="linenos">57</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Copy the array and cast to a specified dtype.</span>
</span><span id="Array.astype-58"><a href="#Array.astype-58"><span class="linenos">58</span></a>
</span><span id="Array.astype-59"><a href="#Array.astype-59"><span class="linenos">59</span></a><span class="sd">  This is implemented via :func:`jax.lax.convert_element_type`, which may</span>
</span><span id="Array.astype-60"><a href="#Array.astype-60"><span class="linenos">60</span></a><span class="sd">  have slightly different behavior than :meth:`numpy.ndarray.astype` in</span>
</span><span id="Array.astype-61"><a href="#Array.astype-61"><span class="linenos">61</span></a><span class="sd">  some cases. In particular, the details of float-to-int and int-to-float</span>
</span><span id="Array.astype-62"><a href="#Array.astype-62"><span class="linenos">62</span></a><span class="sd">  casts are implementation dependent.</span>
</span><span id="Array.astype-63"><a href="#Array.astype-63"><span class="linenos">63</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="Array.astype-64"><a href="#Array.astype-64"><span class="linenos">64</span></a>  <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Array.astype-65"><a href="#Array.astype-65"><span class="linenos">65</span></a>    <span class="n">dtype</span> <span class="o">=</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">canonicalize_dtype</span><span class="p">(</span><span class="n">lax_numpy</span><span class="o">.</span><span class="n">float_</span><span class="p">)</span>
</span><span id="Array.astype-66"><a href="#Array.astype-66"><span class="linenos">66</span></a>  <span class="n">dtypes</span><span class="o">.</span><span class="n">check_user_dtype_supported</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;astype&quot;</span><span class="p">)</span>
</span><span id="Array.astype-67"><a href="#Array.astype-67"><span class="linenos">67</span></a>  <span class="k">return</span> <span class="n">lax</span><span class="o">.</span><span class="n">convert_element_type</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Copy the array and cast to a specified dtype.</p>

<p>This is implemented via <code>jax.lax.convert_element_type()</code>, which may
have slightly different behavior than <code>numpy.ndarray.astype()</code> in
some cases. In particular, the details of float-to-int and int-to-float
casts are implementation dependent.</p>
</div>


                            </div>
                            <div id="Array.choose" class="classattr">
                                        <input id="Array.choose-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@util._wraps(np.choose, skip_params=[&#39;out&#39;])</div>

        <span class="def">def</span>
        <span class="name">choose</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">choices</span><span class="p">:</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="n">typing</span><span class="o">.</span><span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]]</span>,</span><span class="param">	<span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;raise&#39;</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.choose-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.choose"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.choose-1909"><a href="#Array.choose-1909"><span class="linenos">1909</span></a><span class="nd">@util</span><span class="o">.</span><span class="n">_wraps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">choose</span><span class="p">,</span> <span class="n">skip_params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">])</span>
</span><span id="Array.choose-1910"><a href="#Array.choose-1910"><span class="linenos">1910</span></a><span class="k">def</span> <span class="nf">choose</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">choices</span><span class="p">:</span> <span class="n">Sequence</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">],</span>
</span><span id="Array.choose-1911"><a href="#Array.choose-1911"><span class="linenos">1911</span></a>           <span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;raise&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.choose-1912"><a href="#Array.choose-1912"><span class="linenos">1912</span></a>  <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Array.choose-1913"><a href="#Array.choose-1913"><span class="linenos">1913</span></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;The &#39;out&#39; argument to jnp.choose is not supported.&quot;</span><span class="p">)</span>
</span><span id="Array.choose-1914"><a href="#Array.choose-1914"><span class="linenos">1914</span></a>  <span class="n">util</span><span class="o">.</span><span class="n">check_arraylike</span><span class="p">(</span><span class="s1">&#39;choose&#39;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="o">*</span><span class="n">choices</span><span class="p">)</span>
</span><span id="Array.choose-1915"><a href="#Array.choose-1915"><span class="linenos">1915</span></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">issubdtype</span><span class="p">(</span><span class="n">_dtype</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">integer</span><span class="p">):</span>
</span><span id="Array.choose-1916"><a href="#Array.choose-1916"><span class="linenos">1916</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;`a` array must be integer typed&quot;</span><span class="p">)</span>
</span><span id="Array.choose-1917"><a href="#Array.choose-1917"><span class="linenos">1917</span></a>  <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">choices</span><span class="p">)</span>
</span><span id="Array.choose-1918"><a href="#Array.choose-1918"><span class="linenos">1918</span></a>
</span><span id="Array.choose-1919"><a href="#Array.choose-1919"><span class="linenos">1919</span></a>  <span class="k">if</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;raise&#39;</span><span class="p">:</span>
</span><span id="Array.choose-1920"><a href="#Array.choose-1920"><span class="linenos">1920</span></a>    <span class="n">arr</span><span class="p">:</span> <span class="n">Array</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">concrete_or_error</span><span class="p">(</span><span class="n">asarray</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span>
</span><span id="Array.choose-1921"><a href="#Array.choose-1921"><span class="linenos">1921</span></a>      <span class="s2">&quot;The error occurred because jnp.choose was jit-compiled&quot;</span>
</span><span id="Array.choose-1922"><a href="#Array.choose-1922"><span class="linenos">1922</span></a>      <span class="s2">&quot; with mode=&#39;raise&#39;. Use mode=&#39;wrap&#39; or mode=&#39;clip&#39; instead.&quot;</span><span class="p">)</span>
</span><span id="Array.choose-1923"><a href="#Array.choose-1923"><span class="linenos">1923</span></a>    <span class="k">if</span> <span class="n">reductions</span><span class="o">.</span><span class="n">any</span><span class="p">((</span><span class="n">arr</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">arr</span> <span class="o">&gt;=</span> <span class="n">N</span><span class="p">)):</span>
</span><span id="Array.choose-1924"><a href="#Array.choose-1924"><span class="linenos">1924</span></a>      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;invalid entry in choice array&quot;</span><span class="p">)</span>
</span><span id="Array.choose-1925"><a href="#Array.choose-1925"><span class="linenos">1925</span></a>  <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;wrap&#39;</span><span class="p">:</span>
</span><span id="Array.choose-1926"><a href="#Array.choose-1926"><span class="linenos">1926</span></a>    <span class="n">arr</span> <span class="o">=</span> <span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">%</span> <span class="n">N</span>
</span><span id="Array.choose-1927"><a href="#Array.choose-1927"><span class="linenos">1927</span></a>  <span class="k">elif</span> <span class="n">mode</span> <span class="o">==</span> <span class="s1">&#39;clip&#39;</span><span class="p">:</span>
</span><span id="Array.choose-1928"><a href="#Array.choose-1928"><span class="linenos">1928</span></a>    <span class="n">arr</span> <span class="o">=</span> <span class="n">clip</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">N</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span>
</span><span id="Array.choose-1929"><a href="#Array.choose-1929"><span class="linenos">1929</span></a>  <span class="k">else</span><span class="p">:</span>
</span><span id="Array.choose-1930"><a href="#Array.choose-1930"><span class="linenos">1930</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;mode=</span><span class="si">{</span><span class="n">mode</span><span class="si">!r}</span><span class="s2"> not understood. Must be &#39;raise&#39;, &#39;wrap&#39;, or &#39;clip&#39;&quot;</span><span class="p">)</span>
</span><span id="Array.choose-1931"><a href="#Array.choose-1931"><span class="linenos">1931</span></a>
</span><span id="Array.choose-1932"><a href="#Array.choose-1932"><span class="linenos">1932</span></a>  <span class="n">arr</span><span class="p">,</span> <span class="o">*</span><span class="n">choices</span> <span class="o">=</span> <span class="n">broadcast_arrays</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="o">*</span><span class="n">choices</span><span class="p">)</span>
</span><span id="Array.choose-1933"><a href="#Array.choose-1933"><span class="linenos">1933</span></a>  <span class="k">return</span> <span class="n">array</span><span class="p">(</span><span class="n">choices</span><span class="p">)[(</span><span class="n">arr</span><span class="p">,)</span> <span class="o">+</span> <span class="n">indices</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">sparse</span><span class="o">=</span><span class="kc">True</span><span class="p">)]</span>
</span></pre></div>


            <div class="docstring"><p>Construct an array from an index array and a list of arrays to choose from.</p>

<p>LAX-backend implementation of <code>numpy.choose()</code>.</p>

<p><em>Original docstring below.</em></p>

<p>First of all, if confused or uncertain, definitely look at the Examples -
in its full generality, this function is less simple than it might
seem from the following code description (below ndi =
<code>numpy.lib.index_tricks</code>):</p>

<p><code>np.choose(a,c) == np.array([c[a[I]][I] for I in ndi.ndindex(a.shape)])</code>.</p>

<p>But this omits some subtleties.  Here is a fully general summary:</p>

<p>Given an "index" array (<code>a</code>) of integers and a sequence of <code>n</code> arrays
(<code>choices</code>), <code>a</code> and each choice array are first broadcast, as necessary,
to arrays of a common shape; calling these <em>Ba</em> and <em>Bchoices[i], i =
0,...,n-1</em> we have that, necessarily, <code>Ba.shape == Bchoices[i].shape</code>
for each <code>i</code>.  Then, a new array with shape <code>Ba.shape</code> is created as
follows:</p>

<ul>
<li><p>if <code>mode='raise'</code> (the default), then, first of all, each element of
<code>a</code> (and thus <code>Ba</code>) must be in the range <code>[0, n-1]</code>; now, suppose
that <code>i</code> (in that range) is the value at the <code>(j0, j1, ..., jm)</code>
position in <code>Ba</code> - then the value at the same position in the new array
is the value in <code>Bchoices[i]</code> at that same position;</p></li>
<li><p>if <code>mode='wrap'</code>, values in <code>a</code> (and thus <code>Ba</code>) may be any (signed)
integer; modular arithmetic is used to map integers outside the range
<code>[0, n-1]</code> back into that range; and then the new array is constructed
as above;</p></li>
<li><p>if <code>mode='clip'</code>, values in <code>a</code> (and thus <code>Ba</code>) may be any (signed)
integer; negative integers are mapped to 0; values greater than <code>n-1</code>
are mapped to <code>n-1</code>; and then the new array is constructed as above.</p></li>
</ul>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (int array):
This array must contain integers in <code>[0, n-1]</code>, where <code>n</code> is the
number of choices, unless <code>mode=wrap</code> or <code>mode=clip</code>, in which
cases any integers are permissible.</li>
<li><strong>choices</strong> (sequence of arrays):
Choice arrays. <code>a</code> and all of the choices must be broadcastable to the
same shape.  If <code>choices</code> is itself an array (not recommended), then
its outermost dimension (i.e., the one corresponding to
<code>choices.shape[0]</code>) is taken as defining the "sequence".</li>
<li><p><strong>mode</strong> ({'raise' (default), 'wrap', 'clip'}, optional):
Specifies how indices outside <code>[0, n-1]</code> will be treated:</p>

<ul>
<li>'raise' : an exception is raised</li>
<li>'wrap' : value becomes value mod <code>n</code></li>
<li>'clip' : values &lt; 0 are mapped to 0, values &gt; n-1 are mapped to n-1</li>
</ul></li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>merged_array</strong> (array):
The merged result.</li>
</ul>
</div>


                            </div>
                            <div id="Array.clip" class="classattr">
                                        <input id="Array.clip-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">clip</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">number</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="nb">min</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="nb">max</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.clip-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.clip"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.clip-94"><a href="#Array.clip-94"><span class="linenos"> 94</span></a><span class="k">def</span> <span class="nf">_clip</span><span class="p">(</span><span class="n">number</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="Array.clip-95"><a href="#Array.clip-95"><span class="linenos"> 95</span></a>          <span class="nb">min</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">max</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Array.clip-96"><a href="#Array.clip-96"><span class="linenos"> 96</span></a>          <span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.clip-97"><a href="#Array.clip-97"><span class="linenos"> 97</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return an array whose values are limited to a specified range.</span>
</span><span id="Array.clip-98"><a href="#Array.clip-98"><span class="linenos"> 98</span></a>
</span><span id="Array.clip-99"><a href="#Array.clip-99"><span class="linenos"> 99</span></a><span class="sd">  Refer to :func:`jax.numpy.clip` for full documentation.&quot;&quot;&quot;</span>
</span><span id="Array.clip-100"><a href="#Array.clip-100"><span class="linenos">100</span></a>  <span class="k">return</span> <span class="n">lax_numpy</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="n">number</span><span class="p">,</span> <span class="n">a_min</span><span class="o">=</span><span class="nb">min</span><span class="p">,</span> <span class="n">a_max</span><span class="o">=</span><span class="nb">max</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">out</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return an array whose values are limited to a specified range.</p>

<p>Refer to <code>jax.numpy.clip()</code> for full documentation.</p>
</div>


                            </div>
                            <div id="Array.conj" class="classattr">
                                        <input id="Array.conj-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@partial(jit, inline=True)</div>

        <span class="def">def</span>
        <span class="name">conj</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">x</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="o">/</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.conj-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.conj"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.conj-622"><a href="#Array.conj-622"><span class="linenos">622</span></a><span class="nd">@_wraps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="s1">&#39;numpy&#39;</span><span class="p">)</span>
</span><span id="Array.conj-623"><a href="#Array.conj-623"><span class="linenos">623</span></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Array.conj-624"><a href="#Array.conj-624"><span class="linenos">624</span></a><span class="k">def</span> <span class="nf">conjugate</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.conj-625"><a href="#Array.conj-625"><span class="linenos">625</span></a>  <span class="n">check_arraylike</span><span class="p">(</span><span class="s2">&quot;conjugate&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="Array.conj-626"><a href="#Array.conj-626"><span class="linenos">626</span></a>  <span class="k">return</span> <span class="n">lax</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">iscomplexobj</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="n">lax</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return the complex conjugate, element-wise.</p>

<p>LAX-backend implementation of <code>numpy.conjugate()</code>.</p>

<p><em>Original docstring below.</em></p>

<p>The complex conjugate of a complex number is obtained by changing the
sign of its imaginary part.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>x</strong> (array_like):
Input value.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>y</strong> (ndarray):
The complex conjugate of <code>x</code>, with same dtype as <code>y</code>.
This is a scalar if <code>x</code> is a scalar.</li>
</ul>
</div>


                            </div>
                            <div id="Array.conjugate" class="classattr">
                                        <input id="Array.conjugate-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@partial(jit, inline=True)</div>

        <span class="def">def</span>
        <span class="name">conjugate</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">x</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="o">/</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.conjugate-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.conjugate"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.conjugate-622"><a href="#Array.conjugate-622"><span class="linenos">622</span></a><span class="nd">@_wraps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">conjugate</span><span class="p">,</span> <span class="n">module</span><span class="o">=</span><span class="s1">&#39;numpy&#39;</span><span class="p">)</span>
</span><span id="Array.conjugate-623"><a href="#Array.conjugate-623"><span class="linenos">623</span></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Array.conjugate-624"><a href="#Array.conjugate-624"><span class="linenos">624</span></a><span class="k">def</span> <span class="nf">conjugate</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="o">/</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.conjugate-625"><a href="#Array.conjugate-625"><span class="linenos">625</span></a>  <span class="n">check_arraylike</span><span class="p">(</span><span class="s2">&quot;conjugate&quot;</span><span class="p">,</span> <span class="n">x</span><span class="p">)</span>
</span><span id="Array.conjugate-626"><a href="#Array.conjugate-626"><span class="linenos">626</span></a>  <span class="k">return</span> <span class="n">lax</span><span class="o">.</span><span class="n">conj</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">iscomplexobj</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">else</span> <span class="n">lax</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return the complex conjugate, element-wise.</p>

<p>LAX-backend implementation of <code>numpy.conjugate()</code>.</p>

<p><em>Original docstring below.</em></p>

<p>The complex conjugate of a complex number is obtained by changing the
sign of its imaginary part.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>x</strong> (array_like):
Input value.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>y</strong> (ndarray):
The complex conjugate of <code>x</code>, with same dtype as <code>y</code>.
This is a scalar if <code>x</code> is a scalar.</li>
</ul>
</div>


                            </div>
                            <div id="Array.compress" class="classattr">
                                        <input id="Array.compress-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">compress</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">condition</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">axis</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.compress-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.compress"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.compress-298"><a href="#Array.compress-298"><span class="linenos">298</span></a><span class="k">def</span> <span class="nf">_compress_method</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">condition</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="Array.compress-299"><a href="#Array.compress-299"><span class="linenos">299</span></a>                     <span class="n">axis</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.compress-300"><a href="#Array.compress-300"><span class="linenos">300</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return selected slices of this array along given axis.</span>
</span><span id="Array.compress-301"><a href="#Array.compress-301"><span class="linenos">301</span></a>
</span><span id="Array.compress-302"><a href="#Array.compress-302"><span class="linenos">302</span></a><span class="sd">  Refer to :func:`jax.numpy.compress` for full documentation.&quot;&quot;&quot;</span>
</span><span id="Array.compress-303"><a href="#Array.compress-303"><span class="linenos">303</span></a>  <span class="k">return</span> <span class="n">lax_numpy</span><span class="o">.</span><span class="n">jaxcompress</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return selected slices of this array along given axis.</p>

<p>Refer to <code>jax.numpy.compress()</code> for full documentation.</p>
</div>


                            </div>
                            <div id="Array.copy" class="classattr">
                                        <input id="Array.copy-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@util._wraps(np.copy, lax_description=_ARRAY_DOC)</div>

        <span class="def">def</span>
        <span class="name">copy</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">order</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.copy-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.copy"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.copy-2114"><a href="#Array.copy-2114"><span class="linenos">2114</span></a><span class="nd">@util</span><span class="o">.</span><span class="n">_wraps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">copy</span><span class="p">,</span> <span class="n">lax_description</span><span class="o">=</span><span class="n">_ARRAY_DOC</span><span class="p">)</span>
</span><span id="Array.copy-2115"><a href="#Array.copy-2115"><span class="linenos">2115</span></a><span class="k">def</span> <span class="nf">copy</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">order</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.copy-2116"><a href="#Array.copy-2116"><span class="linenos">2116</span></a>  <span class="n">util</span><span class="o">.</span><span class="n">check_arraylike</span><span class="p">(</span><span class="s2">&quot;copy&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span><span id="Array.copy-2117"><a href="#Array.copy-2117"><span class="linenos">2117</span></a>  <span class="k">return</span> <span class="n">array</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">copy</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="n">order</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return an array copy of the given object.</p>

<p>LAX-backend implementation of <code>numpy.copy()</code>.</p>

<p>This function will create arrays on JAX's default device. For control of the
device placement of data, see <code>jax.device_put()</code>. More information is
available in the JAX FAQ at :ref:<code>faq-data-placement</code> (full FAQ at
https://jax.readthedocs.io/en/latest/faq.html).</p>

<p><em>Original docstring below.</em></p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (array_like):
Input data.</li>
<li><strong>order</strong> ({'C', 'F', 'A', 'K'}, optional):
Controls the memory layout of the copy. 'C' means C-order,
'F' means F-order, 'A' means 'F' if <code>a</code> is Fortran contiguous,
'C' otherwise. 'K' means match the layout of <code>a</code> as closely
as possible. (Note that this function and <code>ndarray.copy()</code> are very
similar, but have different default values for their order=
arguments.)</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>arr</strong> (ndarray):
Array interpretation of <code>a</code>.</li>
</ul>
</div>


                            </div>
                            <div id="Array.cumprod" class="classattr">
                                        <input id="Array.cumprod-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">cumprod</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">axis</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">dtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">SupportsDType</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.cumprod-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.cumprod"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.cumprod-655"><a href="#Array.cumprod-655"><span class="linenos">655</span></a>  <span class="nd">@_wraps</span><span class="p">(</span><span class="n">np_reduction</span><span class="p">,</span> <span class="n">skip_params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">])</span>
</span><span id="Array.cumprod-656"><a href="#Array.cumprod-656"><span class="linenos">656</span></a>  <span class="k">def</span> <span class="nf">cumulative_reduction</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="n">Axis</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Array.cumprod-657"><a href="#Array.cumprod-657"><span class="linenos">657</span></a>                           <span class="n">dtype</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DTypeLike</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.cumprod-658"><a href="#Array.cumprod-658"><span class="linenos">658</span></a>    <span class="k">return</span> <span class="n">_cumulative_reduction</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">_ensure_optional_axes</span><span class="p">(</span><span class="n">axis</span><span class="p">),</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return the cumulative product of elements along a given axis.</p>

<p>LAX-backend implementation of <code>numpy.cumprod()</code>.</p>

<p><em>Original docstring below.</em></p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (array_like):
Input array.</li>
<li><strong>axis</strong> (int, optional):
Axis along which the cumulative product is computed.  By default
the input is flattened.</li>
<li><strong>dtype</strong> (dtype, optional):
Type of the returned array, as well as of the accumulator in which
the elements are multiplied.  If <em>dtype</em> is not specified, it
defaults to the dtype of <code>a</code>, unless <code>a</code> has an integer dtype with
a precision less than that of the default platform integer.  In
that case, the default platform integer is used instead.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>cumprod</strong> (ndarray):
A new array holding the result is returned unless <code>out</code> is
specified, in which case a reference to out is returned.</li>
</ul>
</div>


                            </div>
                            <div id="Array.cumsum" class="classattr">
                                        <input id="Array.cumsum-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">cumsum</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">axis</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">dtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">SupportsDType</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.cumsum-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.cumsum"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.cumsum-655"><a href="#Array.cumsum-655"><span class="linenos">655</span></a>  <span class="nd">@_wraps</span><span class="p">(</span><span class="n">np_reduction</span><span class="p">,</span> <span class="n">skip_params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">])</span>
</span><span id="Array.cumsum-656"><a href="#Array.cumsum-656"><span class="linenos">656</span></a>  <span class="k">def</span> <span class="nf">cumulative_reduction</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="n">Axis</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Array.cumsum-657"><a href="#Array.cumsum-657"><span class="linenos">657</span></a>                           <span class="n">dtype</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DTypeLike</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.cumsum-658"><a href="#Array.cumsum-658"><span class="linenos">658</span></a>    <span class="k">return</span> <span class="n">_cumulative_reduction</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">_ensure_optional_axes</span><span class="p">(</span><span class="n">axis</span><span class="p">),</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">out</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return the cumulative sum of the elements along a given axis.</p>

<p>LAX-backend implementation of <code>numpy.cumsum()</code>.</p>

<p><em>Original docstring below.</em></p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (array_like):
Input array.</li>
<li><strong>axis</strong> (int, optional):
Axis along which the cumulative sum is computed. The default
(None) is to compute the cumsum over the flattened array.</li>
<li><strong>dtype</strong> (dtype, optional):
Type of the returned array and of the accumulator in which the
elements are summed.  If <code>dtype</code> is not specified, it defaults
to the dtype of <code>a</code>, unless <code>a</code> has an integer dtype with a
precision less than that of the default platform integer.  In
that case, the default platform integer is used.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>cumsum_along_axis</strong> (ndarray.):
A new array holding the result is returned unless <code>out</code> is
specified, in which case a reference to <code>out</code> is returned. The
result has the same size as <code>a</code>, and the same shape as <code>a</code> if
<code>axis</code> is not None or <code>a</code> is a 1-d array.</li>
</ul>
</div>


                            </div>
                            <div id="Array.diagonal" class="classattr">
                                        <input id="Array.diagonal-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@util._wraps(np.diagonal, lax_description=_ARRAY_VIEW_DOC)</div>
        <div class="decorator">@partial(jit, static_argnames=(&#39;offset&#39;, &#39;axis1&#39;, &#39;axis2&#39;))</div>

        <span class="def">def</span>
        <span class="name">diagonal</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">axis1</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">axis2</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.diagonal-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.diagonal"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.diagonal-2879"><a href="#Array.diagonal-2879"><span class="linenos">2879</span></a><span class="nd">@util</span><span class="o">.</span><span class="n">_wraps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diagonal</span><span class="p">,</span> <span class="n">lax_description</span><span class="o">=</span><span class="n">_ARRAY_VIEW_DOC</span><span class="p">)</span>
</span><span id="Array.diagonal-2880"><a href="#Array.diagonal-2880"><span class="linenos">2880</span></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnames</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;offset&#39;</span><span class="p">,</span> <span class="s1">&#39;axis1&#39;</span><span class="p">,</span> <span class="s1">&#39;axis2&#39;</span><span class="p">))</span>
</span><span id="Array.diagonal-2881"><a href="#Array.diagonal-2881"><span class="linenos">2881</span></a><span class="k">def</span> <span class="nf">diagonal</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis1</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
</span><span id="Array.diagonal-2882"><a href="#Array.diagonal-2882"><span class="linenos">2882</span></a>             <span class="n">axis2</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.diagonal-2883"><a href="#Array.diagonal-2883"><span class="linenos">2883</span></a>  <span class="n">util</span><span class="o">.</span><span class="n">check_arraylike</span><span class="p">(</span><span class="s2">&quot;diagonal&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span><span id="Array.diagonal-2884"><a href="#Array.diagonal-2884"><span class="linenos">2884</span></a>  <span class="n">a_shape</span> <span class="o">=</span> <span class="n">shape</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="Array.diagonal-2885"><a href="#Array.diagonal-2885"><span class="linenos">2885</span></a>  <span class="k">if</span> <span class="n">ndim</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">:</span>
</span><span id="Array.diagonal-2886"><a href="#Array.diagonal-2886"><span class="linenos">2886</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;diagonal requires an array of at least two dimensions.&quot;</span><span class="p">)</span>
</span><span id="Array.diagonal-2887"><a href="#Array.diagonal-2887"><span class="linenos">2887</span></a>  <span class="n">offset</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">concrete_or_error</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">offset</span><span class="p">,</span> <span class="s2">&quot;&#39;offset&#39; argument of jnp.diagonal()&quot;</span><span class="p">)</span>
</span><span id="Array.diagonal-2888"><a href="#Array.diagonal-2888"><span class="linenos">2888</span></a>
</span><span id="Array.diagonal-2889"><a href="#Array.diagonal-2889"><span class="linenos">2889</span></a>  <span class="n">a</span> <span class="o">=</span> <span class="n">moveaxis</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">axis1</span><span class="p">,</span> <span class="n">axis2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="Array.diagonal-2890"><a href="#Array.diagonal-2890"><span class="linenos">2890</span></a>
</span><span id="Array.diagonal-2891"><a href="#Array.diagonal-2891"><span class="linenos">2891</span></a>  <span class="n">diag_size</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">a_shape</span><span class="p">[</span><span class="n">axis1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">min</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span><span id="Array.diagonal-2892"><a href="#Array.diagonal-2892"><span class="linenos">2892</span></a>                         <span class="n">a_shape</span><span class="p">[</span><span class="n">axis2</span><span class="p">]</span> <span class="o">-</span> <span class="nb">max</span><span class="p">(</span><span class="n">offset</span><span class="p">,</span> <span class="mi">0</span><span class="p">)))</span>
</span><span id="Array.diagonal-2893"><a href="#Array.diagonal-2893"><span class="linenos">2893</span></a>  <span class="n">i</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="n">diag_size</span><span class="p">)</span>
</span><span id="Array.diagonal-2894"><a href="#Array.diagonal-2894"><span class="linenos">2894</span></a>  <span class="n">j</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">offset</span><span class="p">),</span> <span class="nb">abs</span><span class="p">(</span><span class="n">offset</span><span class="p">)</span> <span class="o">+</span> <span class="n">diag_size</span><span class="p">)</span>
</span><span id="Array.diagonal-2895"><a href="#Array.diagonal-2895"><span class="linenos">2895</span></a>  <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span> <span class="k">if</span> <span class="n">offset</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">a</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">]</span>
</span></pre></div>


            <div class="docstring"><p>Return specified diagonals.</p>

<p>LAX-backend implementation of <code>numpy.diagonal()</code>.</p>

<p>The JAX version of this function may in some cases return a copy rather than a
view of the input.</p>

<p><em>Original docstring below.</em></p>

<p>If <code>a</code> is 2-D, returns the diagonal of <code>a</code> with the given offset,
i.e., the collection of elements of the form <code>a[i, i+offset]</code>.  If
<code>a</code> has more than two dimensions, then the axes specified by <code>axis1</code>
and <code>axis2</code> are used to determine the 2-D sub-array whose diagonal is
returned.  The shape of the resulting array can be determined by
removing <code>axis1</code> and <code>axis2</code> and appending an index to the right equal
to the size of the resulting diagonals.</p>

<p>In versions of NumPy prior to 1.7, this function always returned a new,
independent array containing a copy of the values in the diagonal.</p>

<p>In NumPy 1.7 and 1.8, it continues to return a copy of the diagonal,
but depending on this fact is deprecated. Writing to the resulting
array continues to work as it used to, but a FutureWarning is issued.</p>

<p>Starting in NumPy 1.9 it returns a read-only view on the original array.
Attempting to write to the resulting array will produce an error.</p>

<p>In some future release, it will return a read/write view and writing to
the returned array will alter your original array.  The returned array
will have the same type as the input array.</p>

<p>If you don't write to the array returned by this function, then you can
just ignore all of the above.</p>

<p>If you depend on the current behavior, then we suggest copying the
returned array explicitly, i.e., use <code>np.diagonal(a).copy()</code> instead
of just <code>np.diagonal(a)</code>. This will work with both past and future
versions of NumPy.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (array_like):
Array from which the diagonals are taken.</li>
<li><strong>offset</strong> (int, optional):
Offset of the diagonal from the main diagonal.  Can be positive or
negative.  Defaults to main diagonal (0).</li>
<li><strong>axis1</strong> (int, optional):
Axis to be used as the first axis of the 2-D sub-arrays from which
the diagonals should be taken.  Defaults to first axis (0).</li>
<li><strong>axis2</strong> (int, optional):
Axis to be used as the second axis of the 2-D sub-arrays from
which the diagonals should be taken. Defaults to second axis (1).</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><p><strong>array_of_diagonals</strong> (ndarray):
If <code>a</code> is 2-D, then a 1-D array containing the diagonal and of the
same type as <code>a</code> is returned unless <code>a</code> is a <code>matrix</code>, in which case
a 1-D array rather than a (2-D) <code>matrix</code> is returned in order to
maintain backward compatibility.</p>

<p>If <code>a.ndim &gt; 2</code>, then the dimensions specified by <code>axis1</code> and <code>axis2</code>
are removed, and a new axis inserted at the end corresponding to the
diagonal.</p></li>
</ul>
</div>


                            </div>
                            <div id="Array.dot" class="classattr">
                                        <input id="Array.dot-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@util._wraps(np.dot, lax_description=_PRECISION_DOC)</div>
        <div class="decorator">@partial(jit, static_argnames=(&#39;precision&#39;, &#39;preferred_element_type&#39;), inline=True)</div>

        <span class="def">def</span>
        <span class="name">dot</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">b</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">precision</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">str</span><span class="p">,</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">Precision</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">str</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">Precision</span><span class="p">,</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">Precision</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">preferred_element_type</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">SupportsDType</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.dot-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.dot"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.dot-3133"><a href="#Array.dot-3133"><span class="linenos">3133</span></a><span class="nd">@util</span><span class="o">.</span><span class="n">_wraps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">,</span> <span class="n">lax_description</span><span class="o">=</span><span class="n">_PRECISION_DOC</span><span class="p">)</span>
</span><span id="Array.dot-3134"><a href="#Array.dot-3134"><span class="linenos">3134</span></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnames</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;precision&#39;</span><span class="p">,</span> <span class="s1">&#39;preferred_element_type&#39;</span><span class="p">),</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Array.dot-3135"><a href="#Array.dot-3135"><span class="linenos">3135</span></a><span class="k">def</span> <span class="nf">dot</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">b</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
</span><span id="Array.dot-3136"><a href="#Array.dot-3136"><span class="linenos">3136</span></a>        <span class="n">precision</span><span class="p">:</span> <span class="n">PrecisionLike</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Array.dot-3137"><a href="#Array.dot-3137"><span class="linenos">3137</span></a>        <span class="n">preferred_element_type</span><span class="p">:</span> <span class="n">DTypeLike</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.dot-3138"><a href="#Array.dot-3138"><span class="linenos">3138</span></a>  <span class="n">util</span><span class="o">.</span><span class="n">check_arraylike</span><span class="p">(</span><span class="s2">&quot;dot&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span><span id="Array.dot-3139"><a href="#Array.dot-3139"><span class="linenos">3139</span></a>  <span class="n">dtypes</span><span class="o">.</span><span class="n">check_user_dtype_supported</span><span class="p">(</span><span class="n">preferred_element_type</span><span class="p">,</span> <span class="s2">&quot;dot&quot;</span><span class="p">)</span>
</span><span id="Array.dot-3140"><a href="#Array.dot-3140"><span class="linenos">3140</span></a>  <span class="n">a</span><span class="p">,</span> <span class="n">b</span> <span class="o">=</span> <span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">asarray</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</span><span id="Array.dot-3141"><a href="#Array.dot-3141"><span class="linenos">3141</span></a>  <span class="k">if</span> <span class="n">preferred_element_type</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Array.dot-3142"><a href="#Array.dot-3142"><span class="linenos">3142</span></a>    <span class="n">preferred_element_type</span><span class="p">,</span> <span class="n">output_weak_type</span> <span class="o">=</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">result_type</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">return_weak_type_flag</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Array.dot-3143"><a href="#Array.dot-3143"><span class="linenos">3143</span></a>  <span class="k">else</span><span class="p">:</span>
</span><span id="Array.dot-3144"><a href="#Array.dot-3144"><span class="linenos">3144</span></a>    <span class="n">output_weak_type</span> <span class="o">=</span> <span class="kc">False</span>
</span><span id="Array.dot-3145"><a href="#Array.dot-3145"><span class="linenos">3145</span></a>
</span><span id="Array.dot-3146"><a href="#Array.dot-3146"><span class="linenos">3146</span></a>  <span class="n">batch_dims</span> <span class="o">=</span> <span class="p">((),</span> <span class="p">())</span>
</span><span id="Array.dot-3147"><a href="#Array.dot-3147"><span class="linenos">3147</span></a>  <span class="n">a_ndim</span><span class="p">,</span> <span class="n">b_ndim</span> <span class="o">=</span> <span class="n">ndim</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">ndim</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
</span><span id="Array.dot-3148"><a href="#Array.dot-3148"><span class="linenos">3148</span></a>  <span class="k">if</span> <span class="n">a_ndim</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">b_ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Array.dot-3149"><a href="#Array.dot-3149"><span class="linenos">3149</span></a>    <span class="c1"># TODO(jakevdp): lower this case to dot_general as well?</span>
</span><span id="Array.dot-3150"><a href="#Array.dot-3150"><span class="linenos">3150</span></a>    <span class="c1"># Currently, doing so causes issues in remat tests due to #16805</span>
</span><span id="Array.dot-3151"><a href="#Array.dot-3151"><span class="linenos">3151</span></a>    <span class="k">if</span> <span class="n">preferred_element_type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Array.dot-3152"><a href="#Array.dot-3152"><span class="linenos">3152</span></a>      <span class="n">a</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">preferred_element_type</span><span class="p">)</span>
</span><span id="Array.dot-3153"><a href="#Array.dot-3153"><span class="linenos">3153</span></a>      <span class="n">b</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">preferred_element_type</span><span class="p">)</span>
</span><span id="Array.dot-3154"><a href="#Array.dot-3154"><span class="linenos">3154</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">lax</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</span><span id="Array.dot-3155"><a href="#Array.dot-3155"><span class="linenos">3155</span></a>  <span class="k">else</span><span class="p">:</span>
</span><span id="Array.dot-3156"><a href="#Array.dot-3156"><span class="linenos">3156</span></a>    <span class="k">if</span> <span class="n">b_ndim</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Array.dot-3157"><a href="#Array.dot-3157"><span class="linenos">3157</span></a>      <span class="n">contract_dims</span> <span class="o">=</span> <span class="p">((</span><span class="n">a_ndim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,))</span>
</span><span id="Array.dot-3158"><a href="#Array.dot-3158"><span class="linenos">3158</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="Array.dot-3159"><a href="#Array.dot-3159"><span class="linenos">3159</span></a>      <span class="n">contract_dims</span> <span class="o">=</span> <span class="p">((</span><span class="n">a_ndim</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,),</span> <span class="p">(</span><span class="n">b_ndim</span> <span class="o">-</span> <span class="mi">2</span><span class="p">,))</span>
</span><span id="Array.dot-3160"><a href="#Array.dot-3160"><span class="linenos">3160</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">lax</span><span class="o">.</span><span class="n">dot_general</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">dimension_numbers</span><span class="o">=</span><span class="p">(</span><span class="n">contract_dims</span><span class="p">,</span> <span class="n">batch_dims</span><span class="p">),</span>
</span><span id="Array.dot-3161"><a href="#Array.dot-3161"><span class="linenos">3161</span></a>                             <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span> <span class="n">preferred_element_type</span><span class="o">=</span><span class="n">preferred_element_type</span><span class="p">)</span>
</span><span id="Array.dot-3162"><a href="#Array.dot-3162"><span class="linenos">3162</span></a>  <span class="k">return</span> <span class="n">lax_internal</span><span class="o">.</span><span class="n">_convert_element_type</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">preferred_element_type</span><span class="p">,</span> <span class="n">output_weak_type</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Dot product of two arrays. Specifically,</p>

<p>LAX-backend implementation of <code>numpy.dot()</code>.</p>

<p>In addition to the original NumPy arguments listed below, also supports
<code>precision</code> for extra control over matrix-multiplication precision
on supported devices. <code>precision</code> may be set to <code>None</code>, which means
default precision for the backend, a <code>~jax.lax.Precision</code> enum value
(<code>Precision.DEFAULT</code>, <code>Precision.HIGH</code> or <code>Precision.HIGHEST</code>) or a tuple
of two <code>~jax.lax.Precision</code> enums indicating separate precision for each argument.</p>

<p><em>Original docstring below.</em></p>

<ul>
<li><p>If both <code>a</code> and <code>b</code> are 1-D arrays, it is inner product of vectors
(without complex conjugation).</p></li>
<li><p>If both <code>a</code> and <code>b</code> are 2-D arrays, it is matrix multiplication,
but using <code>matmul()</code> or <code>a @ b</code> is preferred.</p></li>
<li><p>If either <code>a</code> or <code>b</code> is 0-D (scalar), it is equivalent to
<code>multiply()</code> and using <code>numpy.multiply(a, b)</code> or <code>a * b</code> is
preferred.</p></li>
<li><p>If <code>a</code> is an N-D array and <code>b</code> is a 1-D array, it is a sum product over
the last axis of <code>a</code> and <code>b</code>.</p></li>
<li><p>If <code>a</code> is an N-D array and <code>b</code> is an M-D array (where <code>M&gt;=2</code>), it is a
sum product over the last axis of <code>a</code> and the second-to-last axis of
<code>b</code>::</p>

<p>dot(a, b)[i,j,k,m] = sum(a[i,j,:] * b[k,:,m])</p></li>
</ul>

<p>It uses an optimized BLAS library when possible (see <code>numpy.linalg</code>).</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (array_like):
First argument.</li>
<li><strong>b</strong> (array_like):
Second argument.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>output</strong> (ndarray):
Returns the dot product of <code>a</code> and <code>b</code>.  If <code>a</code> and <code>b</code> are both
scalars or both 1-D arrays then a scalar is returned; otherwise
an array is returned.
If <code>out</code> is given, then it is returned.</li>
</ul>
</div>


                            </div>
                            <div id="Array.flatten" class="classattr">
                                        <input id="Array.flatten-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@util._wraps(np.ravel, lax_description=_ARRAY_VIEW_DOC)</div>
        <div class="decorator">@partial(jit, static_argnames=(&#39;order&#39;,), inline=True)</div>

        <span class="def">def</span>
        <span class="name">flatten</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">order</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.flatten-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.flatten"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.flatten-792"><a href="#Array.flatten-792"><span class="linenos">792</span></a><span class="nd">@util</span><span class="o">.</span><span class="n">_wraps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">,</span> <span class="n">lax_description</span><span class="o">=</span><span class="n">_ARRAY_VIEW_DOC</span><span class="p">)</span>
</span><span id="Array.flatten-793"><a href="#Array.flatten-793"><span class="linenos">793</span></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnames</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;order&#39;</span><span class="p">,),</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Array.flatten-794"><a href="#Array.flatten-794"><span class="linenos">794</span></a><span class="k">def</span> <span class="nf">ravel</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">order</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;C&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.flatten-795"><a href="#Array.flatten-795"><span class="linenos">795</span></a>  <span class="n">util</span><span class="o">.</span><span class="n">check_arraylike</span><span class="p">(</span><span class="s2">&quot;ravel&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span><span id="Array.flatten-796"><a href="#Array.flatten-796"><span class="linenos">796</span></a>  <span class="k">if</span> <span class="n">order</span> <span class="o">==</span> <span class="s2">&quot;K&quot;</span><span class="p">:</span>
</span><span id="Array.flatten-797"><a href="#Array.flatten-797"><span class="linenos">797</span></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Ravel not implemented for order=&#39;K&#39;.&quot;</span><span class="p">)</span>
</span><span id="Array.flatten-798"><a href="#Array.flatten-798"><span class="linenos">798</span></a>  <span class="k">return</span> <span class="n">reshape</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">a</span><span class="p">),),</span> <span class="n">order</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return a contiguous flattened array.</p>

<p>LAX-backend implementation of <code>numpy.ravel()</code>.</p>

<p>The JAX version of this function may in some cases return a copy rather than a
view of the input.</p>

<p><em>Original docstring below.</em></p>

<p>A 1-D array, containing the elements of the input, is returned.  A copy is
made only if needed.</p>

<p>As of NumPy 1.10, the returned array will have the same type as the input
array. (for example, a masked array will be returned for a masked array
input)</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (array_like):
Input array.  The elements in <code>a</code> are read in the order specified by
<code>order</code>, and packed as a 1-D array.</li>
<li><strong>order</strong> ({'C','F', 'A', 'K'}, optional):
The elements of <code>a</code> are read using this index order. 'C' means
to index the elements in row-major, C-style order,
with the last axis index changing fastest, back to the first
axis index changing slowest.  'F' means to index the elements
in column-major, Fortran-style order, with the
first index changing fastest, and the last index changing
slowest. Note that the 'C' and 'F' options take no account of
the memory layout of the underlying array, and only refer to
the order of axis indexing.  'A' means to read the elements in
Fortran-like index order if <code>a</code> is Fortran <em>contiguous</em> in
memory, C-like order otherwise.  'K' means to read the
elements in the order they occur in memory, except for
reversing the data when strides are negative.  By default, 'C'
index order is used.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>y</strong> (array_like):
y is an array of the same subtype as <code>a</code>, with shape <code>(a.size,)</code>.
Note that matrices are special cased for backward compatibility, if <code>a</code>
is a matrix, then y is a 1-D ndarray.</li>
</ul>
</div>


                            </div>
                            <div id="Array.item" class="classattr">
                                        <input id="Array.item-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">item</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">a</span><span class="p">:</span> <span class="n"><a href="#Array">Array</a></span></span><span class="return-annotation">) -> <span class="n">Any</span>:</span></span>

                <label class="view-source-button" for="Array.item-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.item"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.item-75"><a href="#Array.item-75"><span class="linenos">75</span></a><span class="k">def</span> <span class="nf">_item</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
</span><span id="Array.item-76"><a href="#Array.item-76"><span class="linenos">76</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Copy an element of an array to a standard Python scalar and return it.&quot;&quot;&quot;</span>
</span><span id="Array.item-77"><a href="#Array.item-77"><span class="linenos">77</span></a>  <span class="k">if</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">complexfloating</span><span class="p">):</span>
</span><span id="Array.item-78"><a href="#Array.item-78"><span class="linenos">78</span></a>    <span class="k">return</span> <span class="nb">complex</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="Array.item-79"><a href="#Array.item-79"><span class="linenos">79</span></a>  <span class="k">elif</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">floating</span><span class="p">):</span>
</span><span id="Array.item-80"><a href="#Array.item-80"><span class="linenos">80</span></a>    <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="Array.item-81"><a href="#Array.item-81"><span class="linenos">81</span></a>  <span class="k">elif</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">integer</span><span class="p">):</span>
</span><span id="Array.item-82"><a href="#Array.item-82"><span class="linenos">82</span></a>    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="Array.item-83"><a href="#Array.item-83"><span class="linenos">83</span></a>  <span class="k">elif</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">bool_</span><span class="p">):</span>
</span><span id="Array.item-84"><a href="#Array.item-84"><span class="linenos">84</span></a>    <span class="k">return</span> <span class="nb">bool</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="Array.item-85"><a href="#Array.item-85"><span class="linenos">85</span></a>  <span class="k">else</span><span class="p">:</span>
</span><span id="Array.item-86"><a href="#Array.item-86"><span class="linenos">86</span></a>    <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Copy an element of an array to a standard Python scalar and return it.</p>
</div>


                            </div>
                            <div id="Array.max" class="classattr">
                                        <input id="Array.max-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">max</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">axis</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">keepdims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">initial</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">where</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.max-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.max"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.max-254"><a href="#Array.max-254"><span class="linenos">254</span></a><span class="nd">@_wraps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">skip_params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">])</span>
</span><span id="Array.max-255"><a href="#Array.max-255"><span class="linenos">255</span></a><span class="k">def</span> <span class="nf">max</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="n">Axis</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Array.max-256"><a href="#Array.max-256"><span class="linenos">256</span></a>        <span class="n">keepdims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">initial</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Array.max-257"><a href="#Array.max-257"><span class="linenos">257</span></a>        <span class="n">where</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.max-258"><a href="#Array.max-258"><span class="linenos">258</span></a>  <span class="k">return</span> <span class="n">_reduce_max</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">_ensure_optional_axes</span><span class="p">(</span><span class="n">axis</span><span class="p">),</span> <span class="n">out</span><span class="o">=</span><span class="n">out</span><span class="p">,</span>
</span><span id="Array.max-259"><a href="#Array.max-259"><span class="linenos">259</span></a>                     <span class="n">keepdims</span><span class="o">=</span><span class="n">keepdims</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="n">initial</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">where</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return the maximum of an array or maximum along an axis.</p>

<p>LAX-backend implementation of <code>numpy.amax()</code>.</p>

<p><em>Original docstring below.</em></p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (array_like):
Input data.</li>
<li><strong>axis</strong> (None or int or tuple of ints, optional):
Axis or axes along which to operate.  By default, flattened input is
used.</li>
<li><p><strong>keepdims</strong> (bool, optional):
If this is set to True, the axes which are reduced are left
in the result as dimensions with size one. With this option,
the result will broadcast correctly against the input array.</p>

<p>If the default value is passed, then <code>keepdims</code> will not be
passed through to the <code>amax</code> method of sub-classes of
<code>ndarray</code>, however any non-default value will be.  If the
sub-class' method does not implement <code>keepdims</code> any
exceptions will be raised.</p></li>
<li><strong>initial</strong> (scalar, optional):
The minimum value of an output element. Must be present to allow
computation on empty slice. See <code>~numpy.ufunc.reduce</code> for details.</li>
<li><strong>where</strong> (array_like of bool, optional):
Elements to compare for the maximum. See <code>~numpy.ufunc.reduce</code>
for details.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>amax</strong> (ndarray or scalar):
Maximum of <code>a</code>. If <code>axis</code> is None, the result is a scalar value.
If <code>axis</code> is an int, the result is an array of dimension
<code>a.ndim - 1</code>. If <code>axis</code> is a tuple, the result is an array of 
dimension <code>a.ndim - len(axis)</code>.</li>
</ul>
</div>


                            </div>
                            <div id="Array.mean" class="classattr">
                                        <input id="Array.mean-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">mean</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">axis</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">dtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">SupportsDType</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">keepdims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">where</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.mean-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.mean"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.mean-314"><a href="#Array.mean-314"><span class="linenos">314</span></a><span class="nd">@_wraps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">,</span> <span class="n">skip_params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">])</span>
</span><span id="Array.mean-315"><a href="#Array.mean-315"><span class="linenos">315</span></a><span class="k">def</span> <span class="nf">mean</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="n">Axis</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DTypeLike</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Array.mean-316"><a href="#Array.mean-316"><span class="linenos">316</span></a>         <span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">keepdims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
</span><span id="Array.mean-317"><a href="#Array.mean-317"><span class="linenos">317</span></a>         <span class="n">where</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.mean-318"><a href="#Array.mean-318"><span class="linenos">318</span></a>  <span class="k">return</span> <span class="n">_mean</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">_ensure_optional_axes</span><span class="p">(</span><span class="n">axis</span><span class="p">),</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">keepdims</span><span class="p">,</span>
</span><span id="Array.mean-319"><a href="#Array.mean-319"><span class="linenos">319</span></a>               <span class="n">where</span><span class="o">=</span><span class="n">where</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Compute the arithmetic mean along the specified axis.</p>

<p>LAX-backend implementation of <code>numpy.mean()</code>.</p>

<p><em>Original docstring below.</em></p>

<p>Returns the average of the array elements.  The average is taken over
the flattened array by default, otherwise over the specified axis.
<code>float64</code> intermediate and return values are used for integer inputs.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (array_like):
Array containing numbers whose mean is desired. If <code>a</code> is not an
array, a conversion is attempted.</li>
<li><strong>axis</strong> (None or int or tuple of ints, optional):
Axis or axes along which the means are computed. The default is to
compute the mean of the flattened array.</li>
<li><strong>dtype</strong> (data-type, optional):
Type to use in computing the mean.  For integer inputs, the default
is <code>float64</code>; for floating point inputs, it is the same as the
input dtype.</li>
<li><p><strong>keepdims</strong> (bool, optional):
If this is set to True, the axes which are reduced are left
in the result as dimensions with size one. With this option,
the result will broadcast correctly against the input array.</p>

<p>If the default value is passed, then <code>keepdims</code> will not be
passed through to the <code><a href="#Array.mean">mean</a></code> method of sub-classes of
<code>ndarray</code>, however any non-default value will be.  If the
sub-class' method does not implement <code>keepdims</code> any
exceptions will be raised.</p></li>
<li><strong>where</strong> (array_like of bool, optional):
Elements to include in the mean. See <code>~numpy.ufunc.reduce</code> for details.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>m</strong> (ndarray, see dtype parameter above):
If <code>out=None</code>, returns a new array containing the mean values,
otherwise a reference to the output array is returned.</li>
</ul>
</div>


                            </div>
                            <div id="Array.min" class="classattr">
                                        <input id="Array.min-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">min</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">axis</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">keepdims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">initial</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">where</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.min-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.min"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.min-269"><a href="#Array.min-269"><span class="linenos">269</span></a><span class="nd">@_wraps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">,</span> <span class="n">skip_params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">])</span>
</span><span id="Array.min-270"><a href="#Array.min-270"><span class="linenos">270</span></a><span class="k">def</span> <span class="nf">min</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="n">Axis</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Array.min-271"><a href="#Array.min-271"><span class="linenos">271</span></a>        <span class="n">keepdims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">initial</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Array.min-272"><a href="#Array.min-272"><span class="linenos">272</span></a>        <span class="n">where</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.min-273"><a href="#Array.min-273"><span class="linenos">273</span></a>  <span class="k">return</span> <span class="n">_reduce_min</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">_ensure_optional_axes</span><span class="p">(</span><span class="n">axis</span><span class="p">),</span> <span class="n">out</span><span class="o">=</span><span class="n">out</span><span class="p">,</span>
</span><span id="Array.min-274"><a href="#Array.min-274"><span class="linenos">274</span></a>                     <span class="n">keepdims</span><span class="o">=</span><span class="n">keepdims</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="n">initial</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">where</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return the minimum of an array or minimum along an axis.</p>

<p>LAX-backend implementation of <code>numpy.amin()</code>.</p>

<p><em>Original docstring below.</em></p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (array_like):
Input data.</li>
<li><strong>axis</strong> (None or int or tuple of ints, optional):
Axis or axes along which to operate.  By default, flattened input is
used.</li>
<li><p><strong>keepdims</strong> (bool, optional):
If this is set to True, the axes which are reduced are left
in the result as dimensions with size one. With this option,
the result will broadcast correctly against the input array.</p>

<p>If the default value is passed, then <code>keepdims</code> will not be
passed through to the <code>amin</code> method of sub-classes of
<code>ndarray</code>, however any non-default value will be.  If the
sub-class' method does not implement <code>keepdims</code> any
exceptions will be raised.</p></li>
<li><strong>initial</strong> (scalar, optional):
The maximum value of an output element. Must be present to allow
computation on empty slice. See <code>~numpy.ufunc.reduce</code> for details.</li>
<li><strong>where</strong> (array_like of bool, optional):
Elements to compare for the minimum. See <code>~numpy.ufunc.reduce</code>
for details.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>amin</strong> (ndarray or scalar):
Minimum of <code>a</code>. If <code>axis</code> is None, the result is a scalar value.
If <code>axis</code> is an int, the result is an array of dimension
<code>a.ndim - 1</code>.  If <code>axis</code> is a tuple, the result is an array of 
dimension <code>a.ndim - len(axis)</code>.</li>
</ul>
</div>


                            </div>
                            <div id="Array.nonzero" class="classattr">
                                        <input id="Array.nonzero-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@util._wraps(np.nonzero, lax_description=_NONZERO_DOC, extra_params=_NONZERO_EXTRA_PARAMS)</div>

        <span class="def">def</span>
        <span class="name">nonzero</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">fill_value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">],</span> <span class="o">...</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="nb">tuple</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="o">...</span><span class="p">]</span>:</span></span>

                <label class="view-source-button" for="Array.nonzero-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.nonzero"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.nonzero-1366"><a href="#Array.nonzero-1366"><span class="linenos">1366</span></a><span class="nd">@util</span><span class="o">.</span><span class="n">_wraps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">,</span> <span class="n">lax_description</span><span class="o">=</span><span class="n">_NONZERO_DOC</span><span class="p">,</span> <span class="n">extra_params</span><span class="o">=</span><span class="n">_NONZERO_EXTRA_PARAMS</span><span class="p">)</span>
</span><span id="Array.nonzero-1367"><a href="#Array.nonzero-1367"><span class="linenos">1367</span></a><span class="k">def</span> <span class="nf">nonzero</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Array.nonzero-1368"><a href="#Array.nonzero-1368"><span class="linenos">1368</span></a>            <span class="n">fill_value</span><span class="p">:</span> <span class="kc">None</span> <span class="o">|</span> <span class="n">ArrayLike</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">,</span> <span class="o">...</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Array.nonzero-1369"><a href="#Array.nonzero-1369"><span class="linenos">1369</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="n">Array</span><span class="p">,</span> <span class="o">...</span><span class="p">]:</span>
</span><span id="Array.nonzero-1370"><a href="#Array.nonzero-1370"><span class="linenos">1370</span></a>  <span class="n">util</span><span class="o">.</span><span class="n">check_arraylike</span><span class="p">(</span><span class="s2">&quot;nonzero&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span><span id="Array.nonzero-1371"><a href="#Array.nonzero-1371"><span class="linenos">1371</span></a>  <span class="n">arr</span> <span class="o">=</span> <span class="n">atleast_1d</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="Array.nonzero-1372"><a href="#Array.nonzero-1372"><span class="linenos">1372</span></a>  <span class="k">del</span> <span class="n">a</span>
</span><span id="Array.nonzero-1373"><a href="#Array.nonzero-1373"><span class="linenos">1373</span></a>  <span class="n">mask</span> <span class="o">=</span> <span class="n">arr</span> <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">bool</span> <span class="k">else</span> <span class="p">(</span><span class="n">arr</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span><span id="Array.nonzero-1374"><a href="#Array.nonzero-1374"><span class="linenos">1374</span></a>  <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Array.nonzero-1375"><a href="#Array.nonzero-1375"><span class="linenos">1375</span></a>    <span class="n">size</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="Array.nonzero-1376"><a href="#Array.nonzero-1376"><span class="linenos">1376</span></a>  <span class="n">size</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">concrete_dim_or_error</span><span class="p">(</span><span class="n">size</span><span class="p">,</span>
</span><span id="Array.nonzero-1377"><a href="#Array.nonzero-1377"><span class="linenos">1377</span></a>    <span class="s2">&quot;The size argument of jnp.nonzero must be statically specified &quot;</span>
</span><span id="Array.nonzero-1378"><a href="#Array.nonzero-1378"><span class="linenos">1378</span></a>    <span class="s2">&quot;to use jnp.nonzero within JAX transformations.&quot;</span><span class="p">)</span>
</span><span id="Array.nonzero-1379"><a href="#Array.nonzero-1379"><span class="linenos">1379</span></a>  <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">or</span> <span class="n">size</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Array.nonzero-1380"><a href="#Array.nonzero-1380"><span class="linenos">1380</span></a>    <span class="k">return</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">zeros</span><span class="p">(</span><span class="n">size</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span> <span class="k">for</span> <span class="n">dim</span> <span class="ow">in</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="Array.nonzero-1381"><a href="#Array.nonzero-1381"><span class="linenos">1381</span></a>  <span class="n">flat_indices</span> <span class="o">=</span> <span class="n">reductions</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">bincount</span><span class="p">(</span><span class="n">reductions</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">mask</span><span class="p">),</span> <span class="n">length</span><span class="o">=</span><span class="n">size</span><span class="p">))</span>
</span><span id="Array.nonzero-1382"><a href="#Array.nonzero-1382"><span class="linenos">1382</span></a>  <span class="n">strides</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">cumprod</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])[::</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">int_</span><span class="p">)</span>
</span><span id="Array.nonzero-1383"><a href="#Array.nonzero-1383"><span class="linenos">1383</span></a>  <span class="n">out</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">((</span><span class="n">flat_indices</span> <span class="o">//</span> <span class="n">stride</span><span class="p">)</span> <span class="o">%</span> <span class="n">size</span> <span class="k">for</span> <span class="n">stride</span><span class="p">,</span> <span class="n">size</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">strides</span><span class="p">,</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
</span><span id="Array.nonzero-1384"><a href="#Array.nonzero-1384"><span class="linenos">1384</span></a>  <span class="k">if</span> <span class="n">size</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">fill_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Array.nonzero-1385"><a href="#Array.nonzero-1385"><span class="linenos">1385</span></a>    <span class="n">fill_value_tup</span> <span class="o">=</span> <span class="n">fill_value</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">fill_value</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">)</span> <span class="k">else</span> <span class="n">arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">*</span> <span class="p">(</span><span class="n">fill_value</span><span class="p">,)</span>
</span><span id="Array.nonzero-1386"><a href="#Array.nonzero-1386"><span class="linenos">1386</span></a>    <span class="k">if</span> <span class="nb">any</span><span class="p">(</span><span class="n">_shape</span><span class="p">(</span><span class="n">val</span><span class="p">)</span> <span class="o">!=</span> <span class="p">()</span> <span class="k">for</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">fill_value_tup</span><span class="p">):</span>
</span><span id="Array.nonzero-1387"><a href="#Array.nonzero-1387"><span class="linenos">1387</span></a>      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;fill_value must be a scalar or a tuple of length </span><span class="si">{</span><span class="n">arr</span><span class="o">.</span><span class="n">ndim</span><span class="si">}</span><span class="s2">; got </span><span class="si">{</span><span class="n">fill_value</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</span><span id="Array.nonzero-1388"><a href="#Array.nonzero-1388"><span class="linenos">1388</span></a>    <span class="n">fill_mask</span> <span class="o">=</span> <span class="n">arange</span><span class="p">(</span><span class="n">size</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="n">mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</span><span id="Array.nonzero-1389"><a href="#Array.nonzero-1389"><span class="linenos">1389</span></a>    <span class="n">out</span> <span class="o">=</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">where</span><span class="p">(</span><span class="n">fill_mask</span><span class="p">,</span> <span class="n">fval</span><span class="p">,</span> <span class="n">entry</span><span class="p">)</span> <span class="k">for</span> <span class="n">fval</span><span class="p">,</span> <span class="n">entry</span> <span class="ow">in</span> <span class="n">safe_zip</span><span class="p">(</span><span class="n">fill_value_tup</span><span class="p">,</span> <span class="n">out</span><span class="p">))</span>
</span><span id="Array.nonzero-1390"><a href="#Array.nonzero-1390"><span class="linenos">1390</span></a>  <span class="k">return</span> <span class="n">out</span>
</span></pre></div>


            <div class="docstring"><p>Return the indices of the elements that are non-zero.</p>

<p>LAX-backend implementation of <code>numpy.nonzero()</code>.</p>

<p>Because the size of the output of <code><a href="#Array.nonzero">nonzero</a></code> is data-dependent, the function is not
typically compatible with JIT. The JAX version adds the optional <code>size</code> argument which
must be specified statically for <code>jnp.nonzero</code> to be used within some of JAX's
transformations.</p>

<p><em>Original docstring below.</em></p>

<p>Returns a tuple of arrays, one for each dimension of <code>a</code>,
containing the indices of the non-zero elements in that
dimension. The values in <code>a</code> are always tested and returned in
row-major, C-style order.</p>

<p>To group the indices by element, rather than dimension, use <code>argwhere</code>,
which returns a row for each non-zero element.</p>

<div class="pdoc-alert pdoc-alert-note">

<p>When called on a zero-d array or scalar, <code>nonzero(a)</code> is treated
as <code>nonzero(atleast_1d(a))</code>.</p>

<p>.. deprecated:: 1.17.0</p>

<p>Use <code>atleast_1d</code> explicitly if this behavior is deliberate.</p>

</div>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (array_like):
Input array.</li>
<li><strong>size</strong> (int, optional):
If specified, the indices of the first <code>size</code> True elements will be returned. If there are
fewer unique elements than <code>size</code> indicates, the return value will be padded with <code>fill_value</code>.</li>
<li><strong>fill_value</strong> (array_like, optional):
When <code>size</code> is specified and there are fewer than the indicated number of elements, the
remaining elements will be filled with <code>fill_value</code>, which defaults to zero.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>tuple_of_arrays</strong> (tuple):
Indices of elements that are non-zero.</li>
</ul>
</div>


                            </div>
                            <div id="Array.prod" class="classattr">
                                        <input id="Array.prod-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">prod</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">axis</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">dtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">SupportsDType</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">keepdims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">initial</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">where</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">promote_integers</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.prod-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.prod"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.prod-236"><a href="#Array.prod-236"><span class="linenos">236</span></a><span class="nd">@_wraps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">prod</span><span class="p">,</span> <span class="n">skip_params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">],</span> <span class="n">extra_params</span><span class="o">=</span><span class="n">_PROMOTE_INTEGERS_DOC</span><span class="p">)</span>
</span><span id="Array.prod-237"><a href="#Array.prod-237"><span class="linenos">237</span></a><span class="k">def</span> <span class="nf">prod</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="n">Axis</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DTypeLike</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Array.prod-238"><a href="#Array.prod-238"><span class="linenos">238</span></a>         <span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">keepdims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Array.prod-239"><a href="#Array.prod-239"><span class="linenos">239</span></a>         <span class="n">initial</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">where</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Array.prod-240"><a href="#Array.prod-240"><span class="linenos">240</span></a>         <span class="n">promote_integers</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.prod-241"><a href="#Array.prod-241"><span class="linenos">241</span></a>  <span class="k">return</span> <span class="n">_reduce_prod</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">_ensure_optional_axes</span><span class="p">(</span><span class="n">axis</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
</span><span id="Array.prod-242"><a href="#Array.prod-242"><span class="linenos">242</span></a>                      <span class="n">out</span><span class="o">=</span><span class="n">out</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="n">keepdims</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="n">initial</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">where</span><span class="p">,</span>
</span><span id="Array.prod-243"><a href="#Array.prod-243"><span class="linenos">243</span></a>                      <span class="n">promote_integers</span><span class="o">=</span><span class="n">promote_integers</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return the product of array elements over a given axis.</p>

<p>LAX-backend implementation of <code>numpy.prod()</code>.</p>

<p><em>Original docstring below.</em></p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (array_like):
Input data.</li>
<li><strong>axis</strong> (None or int or tuple of ints, optional):
Axis or axes along which a product is performed.  The default,
axis=None, will calculate the product of all the elements in the
input array. If axis is negative it counts from the last to the
first axis.</li>
<li><strong>dtype</strong> (dtype, optional):
The type of the returned array, as well as of the accumulator in
which the elements are multiplied.  The dtype of <code>a</code> is used by
default unless <code>a</code> has an integer dtype of less precision than the
default platform integer.  In that case, if <code>a</code> is signed then the
platform integer is used while if <code>a</code> is unsigned then an unsigned
integer of the same precision as the platform integer is used.</li>
<li><p><strong>keepdims</strong> (bool, optional):
If this is set to True, the axes which are reduced are left in the
result as dimensions with size one. With this option, the result
will broadcast correctly against the input array.</p>

<p>If the default value is passed, then <code>keepdims</code> will not be
passed through to the <code><a href="#Array.prod">prod</a></code> method of sub-classes of
<code>ndarray</code>, however any non-default value will be.  If the
sub-class' method does not implement <code>keepdims</code> any
exceptions will be raised.</p></li>
<li><strong>initial</strong> (scalar, optional):
The starting value for this product. See <code>~numpy.ufunc.reduce</code> for details.</li>
<li><strong>where</strong> (array_like of bool, optional):
Elements to include in the product. See <code>~numpy.ufunc.reduce</code> for details.</li>
<li><strong>promote_integers</strong> (bool, default=True):
If True, then integer inputs will be promoted to the widest available integer
dtype, following numpy's behavior. If False, the result will have the same dtype
as the input. <code>promote_integers</code> is ignored if <code>dtype</code> is specified.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>product_along_axis</strong> (ndarray, see <code>dtype</code> parameter above.):
An array shaped as <code>a</code> but with the specified axis removed.
Returns a reference to <code>out</code> if specified.</li>
</ul>
</div>


                            </div>
                            <div id="Array.ptp" class="classattr">
                                        <input id="Array.ptp-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">ptp</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">axis</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">keepdims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.ptp-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.ptp"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.ptp-504"><a href="#Array.ptp-504"><span class="linenos">504</span></a><span class="nd">@_wraps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ptp</span><span class="p">,</span> <span class="n">skip_params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">])</span>
</span><span id="Array.ptp-505"><a href="#Array.ptp-505"><span class="linenos">505</span></a><span class="k">def</span> <span class="nf">ptp</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="n">Axis</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Array.ptp-506"><a href="#Array.ptp-506"><span class="linenos">506</span></a>        <span class="n">keepdims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.ptp-507"><a href="#Array.ptp-507"><span class="linenos">507</span></a>  <span class="k">return</span> <span class="n">_ptp</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">_ensure_optional_axes</span><span class="p">(</span><span class="n">axis</span><span class="p">),</span> <span class="n">out</span><span class="p">,</span> <span class="n">keepdims</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Range of values (maximum - minimum) along an axis.</p>

<p>LAX-backend implementation of <code>numpy.ptp()</code>.</p>

<p><em>Original docstring below.</em></p>

<p>The name of the function comes from the acronym for 'peak to peak'.</p>

<div class="pdoc-alert pdoc-alert-warning">

<p><code><a href="#Array.ptp">ptp</a></code> preserves the data type of the array. This means the
return value for an input of signed integers with n bits
(e.g. <code>np.int8</code>, <code>np.int16</code>, etc) is also a signed integer
with n bits.  In that case, peak-to-peak values greater than
<code>2**(n-1)-1</code> will be returned as negative values. An example
with a work-around is shown below.</p>

</div>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (array_like):
Input values.</li>
<li><strong>axis</strong> (None or int or tuple of ints, optional):
Axis along which to find the peaks.  By default, flatten the
array.  <code>axis</code> may be negative, in
which case it counts from the last to the first axis.</li>
<li><p><strong>keepdims</strong> (bool, optional):
If this is set to True, the axes which are reduced are left
in the result as dimensions with size one. With this option,
the result will broadcast correctly against the input array.</p>

<p>If the default value is passed, then <code>keepdims</code> will not be
passed through to the <code><a href="#Array.ptp">ptp</a></code> method of sub-classes of
<code>ndarray</code>, however any non-default value will be.  If the
sub-class' method does not implement <code>keepdims</code> any
exceptions will be raised.</p></li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>ptp</strong> (ndarray or scalar):
The range of a given array - <code>scalar</code> if array is one-dimensional
or a new array holding the result along the given axis</li>
</ul>
</div>


                            </div>
                            <div id="Array.ravel" class="classattr">
                                        <input id="Array.ravel-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@util._wraps(np.ravel, lax_description=_ARRAY_VIEW_DOC)</div>
        <div class="decorator">@partial(jit, static_argnames=(&#39;order&#39;,), inline=True)</div>

        <span class="def">def</span>
        <span class="name">ravel</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">order</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.ravel-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.ravel"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.ravel-792"><a href="#Array.ravel-792"><span class="linenos">792</span></a><span class="nd">@util</span><span class="o">.</span><span class="n">_wraps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">,</span> <span class="n">lax_description</span><span class="o">=</span><span class="n">_ARRAY_VIEW_DOC</span><span class="p">)</span>
</span><span id="Array.ravel-793"><a href="#Array.ravel-793"><span class="linenos">793</span></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnames</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;order&#39;</span><span class="p">,),</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Array.ravel-794"><a href="#Array.ravel-794"><span class="linenos">794</span></a><span class="k">def</span> <span class="nf">ravel</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">order</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;C&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.ravel-795"><a href="#Array.ravel-795"><span class="linenos">795</span></a>  <span class="n">util</span><span class="o">.</span><span class="n">check_arraylike</span><span class="p">(</span><span class="s2">&quot;ravel&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span><span id="Array.ravel-796"><a href="#Array.ravel-796"><span class="linenos">796</span></a>  <span class="k">if</span> <span class="n">order</span> <span class="o">==</span> <span class="s2">&quot;K&quot;</span><span class="p">:</span>
</span><span id="Array.ravel-797"><a href="#Array.ravel-797"><span class="linenos">797</span></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;Ravel not implemented for order=&#39;K&#39;.&quot;</span><span class="p">)</span>
</span><span id="Array.ravel-798"><a href="#Array.ravel-798"><span class="linenos">798</span></a>  <span class="k">return</span> <span class="n">reshape</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">a</span><span class="p">),),</span> <span class="n">order</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return a contiguous flattened array.</p>

<p>LAX-backend implementation of <code>numpy.ravel()</code>.</p>

<p>The JAX version of this function may in some cases return a copy rather than a
view of the input.</p>

<p><em>Original docstring below.</em></p>

<p>A 1-D array, containing the elements of the input, is returned.  A copy is
made only if needed.</p>

<p>As of NumPy 1.10, the returned array will have the same type as the input
array. (for example, a masked array will be returned for a masked array
input)</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (array_like):
Input array.  The elements in <code>a</code> are read in the order specified by
<code>order</code>, and packed as a 1-D array.</li>
<li><strong>order</strong> ({'C','F', 'A', 'K'}, optional):
The elements of <code>a</code> are read using this index order. 'C' means
to index the elements in row-major, C-style order,
with the last axis index changing fastest, back to the first
axis index changing slowest.  'F' means to index the elements
in column-major, Fortran-style order, with the
first index changing fastest, and the last index changing
slowest. Note that the 'C' and 'F' options take no account of
the memory layout of the underlying array, and only refer to
the order of axis indexing.  'A' means to read the elements in
Fortran-like index order if <code>a</code> is Fortran <em>contiguous</em> in
memory, C-like order otherwise.  'K' means to read the
elements in the order they occur in memory, except for
reversing the data when strides are negative.  By default, 'C'
index order is used.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>y</strong> (array_like):
y is an array of the same subtype as <code>a</code>, with shape <code>(a.size,)</code>.
Note that matrices are special cased for backward compatibility, if <code>a</code>
is a matrix, then y is a 1-D ndarray.</li>
</ul>
</div>


                            </div>
                            <div id="Array.repeat" class="classattr">
                                        <input id="Array.repeat-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@util._wraps(np.repeat, lax_description=_TOTAL_REPEAT_LENGTH_DOC)</div>

        <span class="def">def</span>
        <span class="name">repeat</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">repeats</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">total_repeat_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.repeat-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.repeat"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.repeat-2633"><a href="#Array.repeat-2633"><span class="linenos">2633</span></a><span class="nd">@util</span><span class="o">.</span><span class="n">_wraps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">repeat</span><span class="p">,</span> <span class="n">lax_description</span><span class="o">=</span><span class="n">_TOTAL_REPEAT_LENGTH_DOC</span><span class="p">)</span>
</span><span id="Array.repeat-2634"><a href="#Array.repeat-2634"><span class="linenos">2634</span></a><span class="k">def</span> <span class="nf">repeat</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">repeats</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
</span><span id="Array.repeat-2635"><a href="#Array.repeat-2635"><span class="linenos">2635</span></a>           <span class="n">total_repeat_length</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.repeat-2636"><a href="#Array.repeat-2636"><span class="linenos">2636</span></a>  <span class="n">util</span><span class="o">.</span><span class="n">check_arraylike</span><span class="p">(</span><span class="s2">&quot;repeat&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span><span id="Array.repeat-2637"><a href="#Array.repeat-2637"><span class="linenos">2637</span></a>  <span class="n">core</span><span class="o">.</span><span class="n">is_dim</span><span class="p">(</span><span class="n">repeats</span><span class="p">)</span> <span class="ow">or</span> <span class="n">util</span><span class="o">.</span><span class="n">check_arraylike</span><span class="p">(</span><span class="s2">&quot;repeat&quot;</span><span class="p">,</span> <span class="n">repeats</span><span class="p">)</span>
</span><span id="Array.repeat-2638"><a href="#Array.repeat-2638"><span class="linenos">2638</span></a>
</span><span id="Array.repeat-2639"><a href="#Array.repeat-2639"><span class="linenos">2639</span></a>  <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Array.repeat-2640"><a href="#Array.repeat-2640"><span class="linenos">2640</span></a>    <span class="n">a</span> <span class="o">=</span> <span class="n">ravel</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="Array.repeat-2641"><a href="#Array.repeat-2641"><span class="linenos">2641</span></a>    <span class="n">axis</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Array.repeat-2642"><a href="#Array.repeat-2642"><span class="linenos">2642</span></a>  <span class="k">else</span><span class="p">:</span>
</span><span id="Array.repeat-2643"><a href="#Array.repeat-2643"><span class="linenos">2643</span></a>    <span class="n">a</span> <span class="o">=</span> <span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="Array.repeat-2644"><a href="#Array.repeat-2644"><span class="linenos">2644</span></a>
</span><span id="Array.repeat-2645"><a href="#Array.repeat-2645"><span class="linenos">2645</span></a>  <span class="n">axis</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">concrete_or_error</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">axis</span><span class="p">,</span> <span class="s2">&quot;&#39;axis&#39; argument of jnp.repeat()&quot;</span><span class="p">)</span>
</span><span id="Array.repeat-2646"><a href="#Array.repeat-2646"><span class="linenos">2646</span></a>  <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="nb">int</span><span class="p">)</span>  <span class="c1"># to appease mypy</span>
</span><span id="Array.repeat-2647"><a href="#Array.repeat-2647"><span class="linenos">2647</span></a>
</span><span id="Array.repeat-2648"><a href="#Array.repeat-2648"><span class="linenos">2648</span></a>  <span class="k">if</span> <span class="n">core</span><span class="o">.</span><span class="n">is_symbolic_dim</span><span class="p">(</span><span class="n">repeats</span><span class="p">):</span>
</span><span id="Array.repeat-2649"><a href="#Array.repeat-2649"><span class="linenos">2649</span></a>    <span class="k">if</span> <span class="n">total_repeat_length</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Array.repeat-2650"><a href="#Array.repeat-2650"><span class="linenos">2650</span></a>      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;jnp.repeat with a non-constant `repeats` is supported only &quot;</span>
</span><span id="Array.repeat-2651"><a href="#Array.repeat-2651"><span class="linenos">2651</span></a>                       <span class="sa">f</span><span class="s2">&quot;when `total_repeat_length` is None. (</span><span class="si">{</span><span class="n">repeats</span><span class="si">=}</span><span class="s2"> </span><span class="si">{</span><span class="n">total_repeat_length</span><span class="si">=}</span><span class="s2">)&quot;</span><span class="p">)</span>
</span><span id="Array.repeat-2652"><a href="#Array.repeat-2652"><span class="linenos">2652</span></a>
</span><span id="Array.repeat-2653"><a href="#Array.repeat-2653"><span class="linenos">2653</span></a>  <span class="c1"># If total_repeat_length is not given, use a default.</span>
</span><span id="Array.repeat-2654"><a href="#Array.repeat-2654"><span class="linenos">2654</span></a>  <span class="k">if</span> <span class="n">total_repeat_length</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Array.repeat-2655"><a href="#Array.repeat-2655"><span class="linenos">2655</span></a>    <span class="n">repeats</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">concrete_or_error</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="n">repeats</span><span class="p">,</span>
</span><span id="Array.repeat-2656"><a href="#Array.repeat-2656"><span class="linenos">2656</span></a>      <span class="s2">&quot;When jit-compiling jnp.repeat, the total number of repeats must be static. &quot;</span>
</span><span id="Array.repeat-2657"><a href="#Array.repeat-2657"><span class="linenos">2657</span></a>      <span class="s2">&quot;To fix this, either specify a static value for `repeats`, or pass a static &quot;</span>
</span><span id="Array.repeat-2658"><a href="#Array.repeat-2658"><span class="linenos">2658</span></a>      <span class="s2">&quot;value to `total_repeat_length`.&quot;</span><span class="p">)</span>
</span><span id="Array.repeat-2659"><a href="#Array.repeat-2659"><span class="linenos">2659</span></a>
</span><span id="Array.repeat-2660"><a href="#Array.repeat-2660"><span class="linenos">2660</span></a>    <span class="c1"># Fast path for when repeats is a scalar.</span>
</span><span id="Array.repeat-2661"><a href="#Array.repeat-2661"><span class="linenos">2661</span></a>    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">ndim</span><span class="p">(</span><span class="n">repeats</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">ndim</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Array.repeat-2662"><a href="#Array.repeat-2662"><span class="linenos">2662</span></a>      <span class="n">input_shape</span> <span class="o">=</span> <span class="n">shape</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="Array.repeat-2663"><a href="#Array.repeat-2663"><span class="linenos">2663</span></a>      <span class="n">aux_axis</span> <span class="o">=</span> <span class="n">axis</span> <span class="k">if</span> <span class="n">axis</span> <span class="o">&lt;</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">axis</span> <span class="o">+</span> <span class="mi">1</span>
</span><span id="Array.repeat-2664"><a href="#Array.repeat-2664"><span class="linenos">2664</span></a>      <span class="n">a</span> <span class="o">=</span> <span class="n">expand_dims</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">aux_axis</span><span class="p">)</span>
</span><span id="Array.repeat-2665"><a href="#Array.repeat-2665"><span class="linenos">2665</span></a>      <span class="n">reps</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">DimSize</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">shape</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
</span><span id="Array.repeat-2666"><a href="#Array.repeat-2666"><span class="linenos">2666</span></a>      <span class="n">reps</span><span class="p">[</span><span class="n">aux_axis</span><span class="p">]</span> <span class="o">=</span> <span class="n">repeats</span>
</span><span id="Array.repeat-2667"><a href="#Array.repeat-2667"><span class="linenos">2667</span></a>      <span class="n">a</span> <span class="o">=</span> <span class="n">tile</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">reps</span><span class="p">)</span>
</span><span id="Array.repeat-2668"><a href="#Array.repeat-2668"><span class="linenos">2668</span></a>      <span class="n">result_shape</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">DimSize</span><span class="p">]</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">input_shape</span><span class="p">)</span>
</span><span id="Array.repeat-2669"><a href="#Array.repeat-2669"><span class="linenos">2669</span></a>      <span class="n">result_shape</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">*=</span> <span class="n">repeats</span>
</span><span id="Array.repeat-2670"><a href="#Array.repeat-2670"><span class="linenos">2670</span></a>      <span class="k">return</span> <span class="n">reshape</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">result_shape</span><span class="p">)</span>
</span><span id="Array.repeat-2671"><a href="#Array.repeat-2671"><span class="linenos">2671</span></a>
</span><span id="Array.repeat-2672"><a href="#Array.repeat-2672"><span class="linenos">2672</span></a>    <span class="n">repeats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">repeats</span><span class="p">)</span>
</span><span id="Array.repeat-2673"><a href="#Array.repeat-2673"><span class="linenos">2673</span></a>    <span class="k">if</span> <span class="n">ndim</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Array.repeat-2674"><a href="#Array.repeat-2674"><span class="linenos">2674</span></a>      <span class="n">repeats</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">broadcast_to</span><span class="p">(</span><span class="n">repeats</span><span class="p">,</span> <span class="p">[</span><span class="n">shape</span><span class="p">(</span><span class="n">a</span><span class="p">)[</span><span class="n">axis</span><span class="p">]])</span>
</span><span id="Array.repeat-2675"><a href="#Array.repeat-2675"><span class="linenos">2675</span></a>    <span class="n">total_repeat_length</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">repeats</span><span class="p">)</span>
</span><span id="Array.repeat-2676"><a href="#Array.repeat-2676"><span class="linenos">2676</span></a>  <span class="k">else</span><span class="p">:</span>
</span><span id="Array.repeat-2677"><a href="#Array.repeat-2677"><span class="linenos">2677</span></a>    <span class="n">repeats</span> <span class="o">=</span> <span class="n">ravel</span><span class="p">(</span><span class="n">repeats</span><span class="p">)</span>
</span><span id="Array.repeat-2678"><a href="#Array.repeat-2678"><span class="linenos">2678</span></a>    <span class="k">if</span> <span class="n">ndim</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Array.repeat-2679"><a href="#Array.repeat-2679"><span class="linenos">2679</span></a>      <span class="n">repeats</span> <span class="o">=</span> <span class="n">broadcast_to</span><span class="p">(</span><span class="n">repeats</span><span class="p">,</span> <span class="p">[</span><span class="n">shape</span><span class="p">(</span><span class="n">a</span><span class="p">)[</span><span class="n">axis</span><span class="p">]])</span>
</span><span id="Array.repeat-2680"><a href="#Array.repeat-2680"><span class="linenos">2680</span></a>
</span><span id="Array.repeat-2681"><a href="#Array.repeat-2681"><span class="linenos">2681</span></a>  <span class="c1"># Special case when a is a scalar.</span>
</span><span id="Array.repeat-2682"><a href="#Array.repeat-2682"><span class="linenos">2682</span></a>  <span class="k">if</span> <span class="n">ndim</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Array.repeat-2683"><a href="#Array.repeat-2683"><span class="linenos">2683</span></a>    <span class="k">if</span> <span class="n">shape</span><span class="p">(</span><span class="n">repeats</span><span class="p">)</span> <span class="o">==</span> <span class="p">(</span><span class="mi">1</span><span class="p">,):</span>
</span><span id="Array.repeat-2684"><a href="#Array.repeat-2684"><span class="linenos">2684</span></a>      <span class="k">return</span> <span class="n">full</span><span class="p">([</span><span class="n">total_repeat_length</span><span class="p">],</span> <span class="n">a</span><span class="p">)</span>
</span><span id="Array.repeat-2685"><a href="#Array.repeat-2685"><span class="linenos">2685</span></a>    <span class="k">else</span><span class="p">:</span>
</span><span id="Array.repeat-2686"><a href="#Array.repeat-2686"><span class="linenos">2686</span></a>      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;`repeat` with a scalar parameter `a` is only &#39;</span>
</span><span id="Array.repeat-2687"><a href="#Array.repeat-2687"><span class="linenos">2687</span></a>      <span class="s1">&#39;implemented for scalar values of the parameter `repeats`.&#39;</span><span class="p">)</span>
</span><span id="Array.repeat-2688"><a href="#Array.repeat-2688"><span class="linenos">2688</span></a>
</span><span id="Array.repeat-2689"><a href="#Array.repeat-2689"><span class="linenos">2689</span></a>  <span class="c1"># Special case if total_repeat_length is zero.</span>
</span><span id="Array.repeat-2690"><a href="#Array.repeat-2690"><span class="linenos">2690</span></a>  <span class="k">if</span> <span class="n">total_repeat_length</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Array.repeat-2691"><a href="#Array.repeat-2691"><span class="linenos">2691</span></a>    <span class="n">result_shape</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">shape</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
</span><span id="Array.repeat-2692"><a href="#Array.repeat-2692"><span class="linenos">2692</span></a>    <span class="n">result_shape</span><span class="p">[</span><span class="n">axis</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
</span><span id="Array.repeat-2693"><a href="#Array.repeat-2693"><span class="linenos">2693</span></a>    <span class="k">return</span> <span class="n">reshape</span><span class="p">(</span><span class="n">array</span><span class="p">([],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">_dtype</span><span class="p">(</span><span class="n">a</span><span class="p">)),</span> <span class="n">result_shape</span><span class="p">)</span>
</span><span id="Array.repeat-2694"><a href="#Array.repeat-2694"><span class="linenos">2694</span></a>
</span><span id="Array.repeat-2695"><a href="#Array.repeat-2695"><span class="linenos">2695</span></a>  <span class="c1"># If repeats is on a zero sized axis, then return the array.</span>
</span><span id="Array.repeat-2696"><a href="#Array.repeat-2696"><span class="linenos">2696</span></a>  <span class="k">if</span> <span class="n">shape</span><span class="p">(</span><span class="n">a</span><span class="p">)[</span><span class="n">axis</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Array.repeat-2697"><a href="#Array.repeat-2697"><span class="linenos">2697</span></a>    <span class="k">return</span> <span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="Array.repeat-2698"><a href="#Array.repeat-2698"><span class="linenos">2698</span></a>
</span><span id="Array.repeat-2699"><a href="#Array.repeat-2699"><span class="linenos">2699</span></a>  <span class="c1"># This implementation of repeat avoid having to instantiate a large.</span>
</span><span id="Array.repeat-2700"><a href="#Array.repeat-2700"><span class="linenos">2700</span></a>  <span class="c1">#intermediate tensor.</span>
</span><span id="Array.repeat-2701"><a href="#Array.repeat-2701"><span class="linenos">2701</span></a>
</span><span id="Array.repeat-2702"><a href="#Array.repeat-2702"><span class="linenos">2702</span></a>  <span class="c1"># Modify repeats from e.g. [1,2,0,5] -&gt; [0,1,2,0] for exclusive repeat.</span>
</span><span id="Array.repeat-2703"><a href="#Array.repeat-2703"><span class="linenos">2703</span></a>  <span class="n">exclusive_repeats</span> <span class="o">=</span> <span class="n">roll</span><span class="p">(</span><span class="n">repeats</span><span class="p">,</span> <span class="n">shift</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Array.repeat-2704"><a href="#Array.repeat-2704"><span class="linenos">2704</span></a>  <span class="c1"># Cumsum to get indices of new number in repeated tensor, e.g. [0, 1, 3, 3]</span>
</span><span id="Array.repeat-2705"><a href="#Array.repeat-2705"><span class="linenos">2705</span></a>  <span class="n">scatter_indices</span> <span class="o">=</span> <span class="n">reductions</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">exclusive_repeats</span><span class="p">)</span>
</span><span id="Array.repeat-2706"><a href="#Array.repeat-2706"><span class="linenos">2706</span></a>  <span class="c1"># Scatter these onto a zero buffer, e.g. [1,1,0,2,0,0,0,0]</span>
</span><span id="Array.repeat-2707"><a href="#Array.repeat-2707"><span class="linenos">2707</span></a>  <span class="n">block_split_indicators</span> <span class="o">=</span> <span class="n">zeros</span><span class="p">([</span><span class="n">total_repeat_length</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">int32</span><span class="p">)</span>
</span><span id="Array.repeat-2708"><a href="#Array.repeat-2708"><span class="linenos">2708</span></a>  <span class="n">block_split_indicators</span> <span class="o">=</span> <span class="n">block_split_indicators</span><span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="n">scatter_indices</span><span class="p">]</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
</span><span id="Array.repeat-2709"><a href="#Array.repeat-2709"><span class="linenos">2709</span></a>  <span class="c1"># Cumsum again to get scatter indices for repeat, e.g. [0,1,1,3,3,3,3,3]</span>
</span><span id="Array.repeat-2710"><a href="#Array.repeat-2710"><span class="linenos">2710</span></a>  <span class="n">gather_indices</span> <span class="o">=</span> <span class="n">reductions</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">block_split_indicators</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
</span><span id="Array.repeat-2711"><a href="#Array.repeat-2711"><span class="linenos">2711</span></a>  <span class="k">return</span> <span class="n">take</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">gather_indices</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Repeat elements of an array.</p>

<p>LAX-backend implementation of <code>numpy.repeat()</code>.</p>

<p>JAX adds the optional <code>total_repeat_length</code> parameter which specifies the total
number of repeat, and defaults to sum(repeats). It must be specified for repeat
to be compilable. If <code>sum(repeats)</code> is larger than the specified
<code>total_repeat_length</code> the remaining values will be discarded. In the case of
<code>sum(repeats)</code> being smaller than the specified target length, the final value
will be repeated.</p>

<p><em>Original docstring below.</em></p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (array_like):
Input array.</li>
<li><strong>repeats</strong> (int or array of ints):
The number of repetitions for each element.  <code>repeats</code> is broadcasted
to fit the shape of the given axis.</li>
<li><strong>axis</strong> (int, optional):
The axis along which to repeat values.  By default, use the
flattened input array, and return a flat output array.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>repeated_array</strong> (ndarray):
Output array which has the same shape as <code>a</code>, except along
the given axis.</li>
</ul>
</div>


                            </div>
                            <div id="Array.reshape" class="classattr">
                                        <input id="Array.reshape-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">reshape</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">a</span><span class="p">:</span> <span class="n"><a href="#Array">Array</a></span>, </span><span class="param"><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span>, </span><span class="param"><span class="n">order</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;C&#39;</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.reshape-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.reshape"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.reshape-137"><a href="#Array.reshape-137"><span class="linenos">137</span></a><span class="k">def</span> <span class="nf">_reshape</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">order</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;C&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.reshape-138"><a href="#Array.reshape-138"><span class="linenos">138</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Returns an array containing the same data with a new shape.</span>
</span><span id="Array.reshape-139"><a href="#Array.reshape-139"><span class="linenos">139</span></a>
</span><span id="Array.reshape-140"><a href="#Array.reshape-140"><span class="linenos">140</span></a><span class="sd">  Refer to :func:`jax.numpy.reshape` for full documentation.</span>
</span><span id="Array.reshape-141"><a href="#Array.reshape-141"><span class="linenos">141</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="Array.reshape-142"><a href="#Array.reshape-142"><span class="linenos">142</span></a>  <span class="n">newshape</span> <span class="o">=</span> <span class="n">_compute_newshape</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span> <span class="k">else</span> <span class="n">args</span><span class="p">)</span>
</span><span id="Array.reshape-143"><a href="#Array.reshape-143"><span class="linenos">143</span></a>  <span class="k">if</span> <span class="n">order</span> <span class="o">==</span> <span class="s2">&quot;C&quot;</span><span class="p">:</span>
</span><span id="Array.reshape-144"><a href="#Array.reshape-144"><span class="linenos">144</span></a>    <span class="k">return</span> <span class="n">lax</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">newshape</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
</span><span id="Array.reshape-145"><a href="#Array.reshape-145"><span class="linenos">145</span></a>  <span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="s2">&quot;F&quot;</span><span class="p">:</span>
</span><span id="Array.reshape-146"><a href="#Array.reshape-146"><span class="linenos">146</span></a>    <span class="n">dims</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">ndim</span><span class="p">)[::</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Array.reshape-147"><a href="#Array.reshape-147"><span class="linenos">147</span></a>    <span class="k">return</span> <span class="n">lax</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">newshape</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">dims</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
</span><span id="Array.reshape-148"><a href="#Array.reshape-148"><span class="linenos">148</span></a>  <span class="k">elif</span> <span class="n">order</span> <span class="o">==</span> <span class="s2">&quot;A&quot;</span><span class="p">:</span>
</span><span id="Array.reshape-149"><a href="#Array.reshape-149"><span class="linenos">149</span></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;np.reshape order=A is not implemented.&quot;</span><span class="p">)</span>
</span><span id="Array.reshape-150"><a href="#Array.reshape-150"><span class="linenos">150</span></a>  <span class="k">else</span><span class="p">:</span>
</span><span id="Array.reshape-151"><a href="#Array.reshape-151"><span class="linenos">151</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Unexpected value for &#39;order&#39; argument: </span><span class="si">{</span><span class="n">order</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns an array containing the same data with a new shape.</p>

<p>Refer to <code>jax.numpy.reshape()</code> for full documentation.</p>
</div>


                            </div>
                            <div id="Array.round" class="classattr">
                                        <input id="Array.round-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@util._wraps(np.around, skip_params=[&#39;out&#39;])</div>
        <div class="decorator">@partial(jit, static_argnames=(&#39;decimals&#39;,))</div>

        <span class="def">def</span>
        <span class="name">round</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">decimals</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.round-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.round"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.round-1274"><a href="#Array.round-1274"><span class="linenos">1274</span></a><span class="nd">@util</span><span class="o">.</span><span class="n">_wraps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">around</span><span class="p">,</span> <span class="n">skip_params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">])</span>
</span><span id="Array.round-1275"><a href="#Array.round-1275"><span class="linenos">1275</span></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnames</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;decimals&#39;</span><span class="p">,))</span>
</span><span id="Array.round-1276"><a href="#Array.round-1276"><span class="linenos">1276</span></a><span class="k">def</span> <span class="nf">round</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">decimals</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.round-1277"><a href="#Array.round-1277"><span class="linenos">1277</span></a>  <span class="n">util</span><span class="o">.</span><span class="n">check_arraylike</span><span class="p">(</span><span class="s2">&quot;round&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span><span id="Array.round-1278"><a href="#Array.round-1278"><span class="linenos">1278</span></a>  <span class="n">decimals</span> <span class="o">=</span> <span class="n">core</span><span class="o">.</span><span class="n">concrete_or_error</span><span class="p">(</span><span class="n">operator</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">decimals</span><span class="p">,</span> <span class="s2">&quot;&#39;decimals&#39; argument of jnp.round&quot;</span><span class="p">)</span>
</span><span id="Array.round-1279"><a href="#Array.round-1279"><span class="linenos">1279</span></a>  <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Array.round-1280"><a href="#Array.round-1280"><span class="linenos">1280</span></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;The &#39;out&#39; argument to jnp.round is not supported.&quot;</span><span class="p">)</span>
</span><span id="Array.round-1281"><a href="#Array.round-1281"><span class="linenos">1281</span></a>  <span class="n">dtype</span> <span class="o">=</span> <span class="n">_dtype</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="Array.round-1282"><a href="#Array.round-1282"><span class="linenos">1282</span></a>  <span class="k">if</span> <span class="n">issubdtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">integer</span><span class="p">):</span>
</span><span id="Array.round-1283"><a href="#Array.round-1283"><span class="linenos">1283</span></a>    <span class="k">if</span> <span class="n">decimals</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Array.round-1284"><a href="#Array.round-1284"><span class="linenos">1284</span></a>      <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span>
</span><span id="Array.round-1285"><a href="#Array.round-1285"><span class="linenos">1285</span></a>        <span class="s2">&quot;integer np.round not implemented for decimals &lt; 0&quot;</span><span class="p">)</span>
</span><span id="Array.round-1286"><a href="#Array.round-1286"><span class="linenos">1286</span></a>    <span class="k">return</span> <span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>  <span class="c1"># no-op on integer types</span>
</span><span id="Array.round-1287"><a href="#Array.round-1287"><span class="linenos">1287</span></a>
</span><span id="Array.round-1288"><a href="#Array.round-1288"><span class="linenos">1288</span></a>  <span class="k">def</span> <span class="nf">_round_float</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.round-1289"><a href="#Array.round-1289"><span class="linenos">1289</span></a>    <span class="k">if</span> <span class="n">decimals</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Array.round-1290"><a href="#Array.round-1290"><span class="linenos">1290</span></a>      <span class="k">return</span> <span class="n">lax</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">lax</span><span class="o">.</span><span class="n">RoundingMethod</span><span class="o">.</span><span class="n">TO_NEAREST_EVEN</span><span class="p">)</span>
</span><span id="Array.round-1291"><a href="#Array.round-1291"><span class="linenos">1291</span></a>
</span><span id="Array.round-1292"><a href="#Array.round-1292"><span class="linenos">1292</span></a>    <span class="c1"># TODO(phawkins): the strategy of rescaling the value isn&#39;t necessarily a</span>
</span><span id="Array.round-1293"><a href="#Array.round-1293"><span class="linenos">1293</span></a>    <span class="c1"># good one since we may be left with an incorrectly rounded value at the</span>
</span><span id="Array.round-1294"><a href="#Array.round-1294"><span class="linenos">1294</span></a>    <span class="c1"># end due to precision problems. As a workaround for float16, convert to</span>
</span><span id="Array.round-1295"><a href="#Array.round-1295"><span class="linenos">1295</span></a>    <span class="c1"># float32,</span>
</span><span id="Array.round-1296"><a href="#Array.round-1296"><span class="linenos">1296</span></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">lax</span><span class="o">.</span><span class="n">convert_element_type</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span> <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float16</span> <span class="k">else</span> <span class="n">x</span>
</span><span id="Array.round-1297"><a href="#Array.round-1297"><span class="linenos">1297</span></a>    <span class="n">factor</span> <span class="o">=</span> <span class="n">_lax_const</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="mi">10</span> <span class="o">**</span> <span class="n">decimals</span><span class="p">)</span>
</span><span id="Array.round-1298"><a href="#Array.round-1298"><span class="linenos">1298</span></a>    <span class="n">out</span> <span class="o">=</span> <span class="n">lax</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">lax</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">lax</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">factor</span><span class="p">),</span>
</span><span id="Array.round-1299"><a href="#Array.round-1299"><span class="linenos">1299</span></a>                            <span class="n">lax</span><span class="o">.</span><span class="n">RoundingMethod</span><span class="o">.</span><span class="n">TO_NEAREST_EVEN</span><span class="p">),</span> <span class="n">factor</span><span class="p">)</span>
</span><span id="Array.round-1300"><a href="#Array.round-1300"><span class="linenos">1300</span></a>    <span class="k">return</span> <span class="n">lax</span><span class="o">.</span><span class="n">convert_element_type</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span> <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">float16</span> <span class="k">else</span> <span class="n">out</span>
</span><span id="Array.round-1301"><a href="#Array.round-1301"><span class="linenos">1301</span></a>
</span><span id="Array.round-1302"><a href="#Array.round-1302"><span class="linenos">1302</span></a>  <span class="k">if</span> <span class="n">issubdtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">complexfloating</span><span class="p">):</span>
</span><span id="Array.round-1303"><a href="#Array.round-1303"><span class="linenos">1303</span></a>    <span class="k">return</span> <span class="n">lax</span><span class="o">.</span><span class="n">complex</span><span class="p">(</span><span class="n">_round_float</span><span class="p">(</span><span class="n">lax</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">a</span><span class="p">)),</span> <span class="n">_round_float</span><span class="p">(</span><span class="n">lax</span><span class="o">.</span><span class="n">imag</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span>
</span><span id="Array.round-1304"><a href="#Array.round-1304"><span class="linenos">1304</span></a>  <span class="k">else</span><span class="p">:</span>
</span><span id="Array.round-1305"><a href="#Array.round-1305"><span class="linenos">1305</span></a>    <span class="k">return</span> <span class="n">_round_float</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Evenly round to the given number of decimals.</p>

<p>LAX-backend implementation of <code>numpy.around()</code>.</p>

<p><em>Original docstring below.</em></p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (array_like):
Input data.</li>
<li><strong>decimals</strong> (int, optional):
Number of decimal places to round to (default: 0).  If
decimals is negative, it specifies the number of positions to
the left of the decimal point.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><p><strong>rounded_array</strong> (ndarray):
An array of the same type as <code>a</code>, containing the rounded values.
Unless <code>out</code> was specified, a new array is created.  A reference to
the result is returned.</p>

<p>The real and imaginary parts of complex numbers are rounded
separately.  The result of rounding a float is a float.</p></li>
</ul>

<h6 id="references">References</h6>

<div class="footnotes">
<hr />
<ol>
</ol>
</div>
</div>


                            </div>
                            <div id="Array.searchsorted" class="classattr">
                                        <input id="Array.searchsorted-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@util._wraps(np.searchsorted, skip_params=[&#39;sorter&#39;], extra_params=_dedent(&#34;\n    method : str\n        One of &#39;scan&#39; (default), &#39;scan_unrolled&#39;, &#39;sort&#39; or &#39;compare_all&#39;. Controls the method used by the\n        implementation: &#39;scan&#39; tends to be more performant on CPU (particularly when ``a`` is\n        very large), &#39;scan_unrolled&#39; is more performant on GPU at the expense of additional compile time,\n        &#39;sort&#39; is often more performant on accelerator backends like GPU and TPU\n        (particularly when ``v`` is very large), and &#39;compare_all&#39; can be most performant\n        when ``a`` is very small.&#34;))</div>
        <div class="decorator">@partial(jit, static_argnames=(&#39;side&#39;, &#39;sorter&#39;, &#39;method&#39;))</div>

        <span class="def">def</span>
        <span class="name">searchsorted</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">v</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">side</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span>,</span><span class="param">	<span class="n">sorter</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;scan&#39;</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.searchsorted-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.searchsorted"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.searchsorted-5075"><a href="#Array.searchsorted-5075"><span class="linenos">5075</span></a><span class="nd">@util</span><span class="o">.</span><span class="n">_wraps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">searchsorted</span><span class="p">,</span> <span class="n">skip_params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;sorter&#39;</span><span class="p">],</span>
</span><span id="Array.searchsorted-5076"><a href="#Array.searchsorted-5076"><span class="linenos">5076</span></a>  <span class="n">extra_params</span><span class="o">=</span><span class="n">_dedent</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="Array.searchsorted-5077"><a href="#Array.searchsorted-5077"><span class="linenos">5077</span></a><span class="s2">    method : str</span>
</span><span id="Array.searchsorted-5078"><a href="#Array.searchsorted-5078"><span class="linenos">5078</span></a><span class="s2">        One of &#39;scan&#39; (default), &#39;scan_unrolled&#39;, &#39;sort&#39; or &#39;compare_all&#39;. Controls the method used by the</span>
</span><span id="Array.searchsorted-5079"><a href="#Array.searchsorted-5079"><span class="linenos">5079</span></a><span class="s2">        implementation: &#39;scan&#39; tends to be more performant on CPU (particularly when ``a`` is</span>
</span><span id="Array.searchsorted-5080"><a href="#Array.searchsorted-5080"><span class="linenos">5080</span></a><span class="s2">        very large), &#39;scan_unrolled&#39; is more performant on GPU at the expense of additional compile time,</span>
</span><span id="Array.searchsorted-5081"><a href="#Array.searchsorted-5081"><span class="linenos">5081</span></a><span class="s2">        &#39;sort&#39; is often more performant on accelerator backends like GPU and TPU</span>
</span><span id="Array.searchsorted-5082"><a href="#Array.searchsorted-5082"><span class="linenos">5082</span></a><span class="s2">        (particularly when ``v`` is very large), and &#39;compare_all&#39; can be most performant</span>
</span><span id="Array.searchsorted-5083"><a href="#Array.searchsorted-5083"><span class="linenos">5083</span></a><span class="s2">        when ``a`` is very small.&quot;&quot;&quot;</span><span class="p">))</span>
</span><span id="Array.searchsorted-5084"><a href="#Array.searchsorted-5084"><span class="linenos">5084</span></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnames</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;side&#39;</span><span class="p">,</span> <span class="s1">&#39;sorter&#39;</span><span class="p">,</span> <span class="s1">&#39;method&#39;</span><span class="p">))</span>
</span><span id="Array.searchsorted-5085"><a href="#Array.searchsorted-5085"><span class="linenos">5085</span></a><span class="k">def</span> <span class="nf">searchsorted</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">v</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">side</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">,</span>
</span><span id="Array.searchsorted-5086"><a href="#Array.searchsorted-5086"><span class="linenos">5086</span></a>                 <span class="n">sorter</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;scan&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.searchsorted-5087"><a href="#Array.searchsorted-5087"><span class="linenos">5087</span></a>  <span class="n">util</span><span class="o">.</span><span class="n">check_arraylike</span><span class="p">(</span><span class="s2">&quot;searchsorted&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span id="Array.searchsorted-5088"><a href="#Array.searchsorted-5088"><span class="linenos">5088</span></a>  <span class="k">if</span> <span class="n">side</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">]:</span>
</span><span id="Array.searchsorted-5089"><a href="#Array.searchsorted-5089"><span class="linenos">5089</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">side</span><span class="si">!r}</span><span class="s2"> is an invalid value for keyword &#39;side&#39;. &quot;</span>
</span><span id="Array.searchsorted-5090"><a href="#Array.searchsorted-5090"><span class="linenos">5090</span></a>                     <span class="s2">&quot;Expected one of [&#39;left&#39;, &#39;right&#39;].&quot;</span><span class="p">)</span>
</span><span id="Array.searchsorted-5091"><a href="#Array.searchsorted-5091"><span class="linenos">5091</span></a>  <span class="k">if</span> <span class="n">method</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;scan&#39;</span><span class="p">,</span> <span class="s1">&#39;scan_unrolled&#39;</span><span class="p">,</span> <span class="s1">&#39;sort&#39;</span><span class="p">,</span> <span class="s1">&#39;compare_all&#39;</span><span class="p">]:</span>
</span><span id="Array.searchsorted-5092"><a href="#Array.searchsorted-5092"><span class="linenos">5092</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="Array.searchsorted-5093"><a href="#Array.searchsorted-5093"><span class="linenos">5093</span></a>        <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">method</span><span class="si">!r}</span><span class="s2"> is an invalid value for keyword &#39;method&#39;. &quot;</span>
</span><span id="Array.searchsorted-5094"><a href="#Array.searchsorted-5094"><span class="linenos">5094</span></a>        <span class="s2">&quot;Expected one of [&#39;sort&#39;, &#39;scan&#39;, &#39;scan_unrolled&#39;, &#39;compare_all&#39;].&quot;</span><span class="p">)</span>
</span><span id="Array.searchsorted-5095"><a href="#Array.searchsorted-5095"><span class="linenos">5095</span></a>  <span class="k">if</span> <span class="n">sorter</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Array.searchsorted-5096"><a href="#Array.searchsorted-5096"><span class="linenos">5096</span></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;sorter is not implemented&quot;</span><span class="p">)</span>
</span><span id="Array.searchsorted-5097"><a href="#Array.searchsorted-5097"><span class="linenos">5097</span></a>  <span class="k">if</span> <span class="n">ndim</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Array.searchsorted-5098"><a href="#Array.searchsorted-5098"><span class="linenos">5098</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;a should be 1-dimensional&quot;</span><span class="p">)</span>
</span><span id="Array.searchsorted-5099"><a href="#Array.searchsorted-5099"><span class="linenos">5099</span></a>  <span class="n">a</span><span class="p">,</span> <span class="n">v</span> <span class="o">=</span> <span class="n">util</span><span class="o">.</span><span class="n">promote_dtypes</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">v</span><span class="p">)</span>
</span><span id="Array.searchsorted-5100"><a href="#Array.searchsorted-5100"><span class="linenos">5100</span></a>  <span class="n">dtype</span> <span class="o">=</span> <span class="n">int32</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">int32</span><span class="p">)</span><span class="o">.</span><span class="n">max</span> <span class="k">else</span> <span class="n">int64</span>
</span><span id="Array.searchsorted-5101"><a href="#Array.searchsorted-5101"><span class="linenos">5101</span></a>  <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Array.searchsorted-5102"><a href="#Array.searchsorted-5102"><span class="linenos">5102</span></a>    <span class="k">return</span> <span class="n">zeros_like</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="Array.searchsorted-5103"><a href="#Array.searchsorted-5103"><span class="linenos">5103</span></a>  <span class="n">impl</span> <span class="o">=</span> <span class="p">{</span>
</span><span id="Array.searchsorted-5104"><a href="#Array.searchsorted-5104"><span class="linenos">5104</span></a>      <span class="s1">&#39;scan&#39;</span><span class="p">:</span> <span class="n">partial</span><span class="p">(</span><span class="n">_searchsorted_via_scan</span><span class="p">,</span> <span class="kc">False</span><span class="p">),</span>
</span><span id="Array.searchsorted-5105"><a href="#Array.searchsorted-5105"><span class="linenos">5105</span></a>      <span class="s1">&#39;scan_unrolled&#39;</span><span class="p">:</span> <span class="n">partial</span><span class="p">(</span><span class="n">_searchsorted_via_scan</span><span class="p">,</span> <span class="kc">True</span><span class="p">),</span>
</span><span id="Array.searchsorted-5106"><a href="#Array.searchsorted-5106"><span class="linenos">5106</span></a>      <span class="s1">&#39;sort&#39;</span><span class="p">:</span> <span class="n">_searchsorted_via_sort</span><span class="p">,</span>
</span><span id="Array.searchsorted-5107"><a href="#Array.searchsorted-5107"><span class="linenos">5107</span></a>      <span class="s1">&#39;compare_all&#39;</span><span class="p">:</span> <span class="n">_searchsorted_via_compare_all</span><span class="p">,</span>
</span><span id="Array.searchsorted-5108"><a href="#Array.searchsorted-5108"><span class="linenos">5108</span></a>  <span class="p">}[</span><span class="n">method</span><span class="p">]</span>
</span><span id="Array.searchsorted-5109"><a href="#Array.searchsorted-5109"><span class="linenos">5109</span></a>  <span class="k">return</span> <span class="n">impl</span><span class="p">(</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">asarray</span><span class="p">(</span><span class="n">v</span><span class="p">),</span> <span class="n">side</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>  <span class="c1"># type: ignore</span>
</span></pre></div>


            <div class="docstring"><p>Find indices where elements should be inserted to maintain order.</p>

<p>LAX-backend implementation of <code>numpy.searchsorted()</code>.</p>

<p><em>Original docstring below.</em></p>

<p>Find the indices into a sorted array <code>a</code> such that, if the
corresponding elements in <code>v</code> were inserted before the indices, the
order of <code>a</code> would be preserved.</p>

<p>Assuming that <code>a</code> is sorted:</p>

<p>======  ============================
<code>side</code>  returned index <code>i</code> satisfies
======  ============================
left    <code>a[i-1] &lt; v &lt;= a[i]</code>
right   <code>a[i-1] &lt;= v &lt; a[i]</code>
======  ============================</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (1-D array_like):
Input array. If <code>sorter</code> is None, then it must be sorted in
ascending order, otherwise <code>sorter</code> must be an array of indices
that sort it.</li>
<li><strong>v</strong> (array_like):
Values to insert into <code>a</code>.</li>
<li><strong>side</strong> ({'left', 'right'}, optional):
If 'left', the index of the first suitable location found is given.
If 'right', return the last such index.  If there is no suitable
index, return either 0 or N (where N is the length of <code>a</code>).</li>
<li><strong>method</strong> (str):
One of 'scan' (default), 'scan_unrolled', 'sort' or 'compare_all'. Controls the method used by the
implementation: 'scan' tends to be more performant on CPU (particularly when <code>a</code> is
very large), 'scan_unrolled' is more performant on GPU at the expense of additional compile time,
'sort' is often more performant on accelerator backends like GPU and TPU
(particularly when <code>v</code> is very large), and 'compare_all' can be most performant
when <code>a</code> is very small.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>indices</strong> (int or array of ints):
Array of insertion points with the same shape as <code>v</code>,
or an integer if <code>v</code> is a scalar.</li>
</ul>
</div>


                            </div>
                            <div id="Array.sort" class="classattr">
                                        <input id="Array.sort-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@util._wraps(np.sort)</div>
        <div class="decorator">@partial(jit, static_argnames=(&#39;axis&#39;, &#39;kind&#39;, &#39;order&#39;))</div>

        <span class="def">def</span>
        <span class="name">sort</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>,</span><span class="param">	<span class="n">kind</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;quicksort&#39;</span>,</span><span class="param">	<span class="n">order</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.sort-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.sort"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.sort-3773"><a href="#Array.sort-3773"><span class="linenos">3773</span></a><span class="nd">@util</span><span class="o">.</span><span class="n">_wraps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">)</span>
</span><span id="Array.sort-3774"><a href="#Array.sort-3774"><span class="linenos">3774</span></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnames</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;axis&#39;</span><span class="p">,</span> <span class="s1">&#39;kind&#39;</span><span class="p">,</span> <span class="s1">&#39;order&#39;</span><span class="p">))</span>
</span><span id="Array.sort-3775"><a href="#Array.sort-3775"><span class="linenos">3775</span></a><span class="k">def</span> <span class="nf">sort</span><span class="p">(</span>
</span><span id="Array.sort-3776"><a href="#Array.sort-3776"><span class="linenos">3776</span></a>    <span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="Array.sort-3777"><a href="#Array.sort-3777"><span class="linenos">3777</span></a>    <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
</span><span id="Array.sort-3778"><a href="#Array.sort-3778"><span class="linenos">3778</span></a>    <span class="n">kind</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;quicksort&quot;</span><span class="p">,</span>
</span><span id="Array.sort-3779"><a href="#Array.sort-3779"><span class="linenos">3779</span></a>    <span class="n">order</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Array.sort-3780"><a href="#Array.sort-3780"><span class="linenos">3780</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.sort-3781"><a href="#Array.sort-3781"><span class="linenos">3781</span></a>  <span class="n">util</span><span class="o">.</span><span class="n">check_arraylike</span><span class="p">(</span><span class="s2">&quot;sort&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span><span id="Array.sort-3782"><a href="#Array.sort-3782"><span class="linenos">3782</span></a>  <span class="k">if</span> <span class="n">kind</span> <span class="o">!=</span> <span class="s1">&#39;quicksort&#39;</span><span class="p">:</span>
</span><span id="Array.sort-3783"><a href="#Array.sort-3783"><span class="linenos">3783</span></a>    <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;&#39;kind&#39; argument to sort is ignored.&quot;</span><span class="p">)</span>
</span><span id="Array.sort-3784"><a href="#Array.sort-3784"><span class="linenos">3784</span></a>  <span class="k">if</span> <span class="n">order</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Array.sort-3785"><a href="#Array.sort-3785"><span class="linenos">3785</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;&#39;order&#39; argument to sort is not supported.&quot;</span><span class="p">)</span>
</span><span id="Array.sort-3786"><a href="#Array.sort-3786"><span class="linenos">3786</span></a>
</span><span id="Array.sort-3787"><a href="#Array.sort-3787"><span class="linenos">3787</span></a>  <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Array.sort-3788"><a href="#Array.sort-3788"><span class="linenos">3788</span></a>    <span class="k">return</span> <span class="n">lax</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">ravel</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">dimension</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
</span><span id="Array.sort-3789"><a href="#Array.sort-3789"><span class="linenos">3789</span></a>  <span class="k">else</span><span class="p">:</span>
</span><span id="Array.sort-3790"><a href="#Array.sort-3790"><span class="linenos">3790</span></a>    <span class="k">return</span> <span class="n">lax</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">dimension</span><span class="o">=</span><span class="n">_canonicalize_axis</span><span class="p">(</span><span class="n">axis</span><span class="p">,</span> <span class="n">ndim</span><span class="p">(</span><span class="n">a</span><span class="p">)))</span>
</span></pre></div>


            <div class="docstring"><p>Return a sorted copy of an array.</p>

<p>LAX-backend implementation of <code>numpy.sort()</code>.</p>

<p><em>Original docstring below.</em></p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (array_like):
Array to be sorted.</li>
<li><strong>axis</strong> (int or None, optional):
Axis along which to sort. If None, the array is flattened before
sorting. The default is -1, which sorts along the last axis.</li>
<li><p><strong>kind</strong> ({'quicksort', 'mergesort', 'heapsort', 'stable'}, optional):
Sorting algorithm. The default is 'quicksort'. Note that both 'stable'
and 'mergesort' use timsort or radix sort under the covers and, in general,
the actual implementation will vary with data type. The 'mergesort' option
is retained for backwards compatibility.</p>

<p><em>Changed in version 1.15.0.:</em>
The 'stable' option was added.</p></li>
<li><strong>order</strong> (str or list of str, optional):
When <code>a</code> is an array with fields defined, this argument specifies
which fields to compare first, second, etc.  A single field can
be specified as a string, and not all fields need be specified,
but unspecified fields will still be used, in the order in which
they come up in the dtype, to break ties.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>sorted_array</strong> (ndarray):
Array of the same type and shape as <code>a</code>.</li>
</ul>
</div>


                            </div>
                            <div id="Array.squeeze" class="classattr">
                                        <input id="Array.squeeze-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@util._wraps(np.squeeze, lax_description=_ARRAY_VIEW_DOC)</div>

        <span class="def">def</span>
        <span class="name">squeeze</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.squeeze-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.squeeze"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.squeeze-884"><a href="#Array.squeeze-884"><span class="linenos">884</span></a><span class="nd">@util</span><span class="o">.</span><span class="n">_wraps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">squeeze</span><span class="p">,</span> <span class="n">lax_description</span><span class="o">=</span><span class="n">_ARRAY_VIEW_DOC</span><span class="p">)</span>
</span><span id="Array.squeeze-885"><a href="#Array.squeeze-885"><span class="linenos">885</span></a><span class="k">def</span> <span class="nf">squeeze</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.squeeze-886"><a href="#Array.squeeze-886"><span class="linenos">886</span></a>  <span class="n">util</span><span class="o">.</span><span class="n">check_arraylike</span><span class="p">(</span><span class="s2">&quot;squeeze&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span><span id="Array.squeeze-887"><a href="#Array.squeeze-887"><span class="linenos">887</span></a>  <span class="k">return</span> <span class="n">_squeeze</span><span class="p">(</span><span class="n">asarray</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="n">_ensure_index_tuple</span><span class="p">(</span><span class="n">axis</span><span class="p">)</span> <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="k">else</span> <span class="kc">None</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Remove axes of length one from <code>a</code>.</p>

<p>LAX-backend implementation of <code>numpy.squeeze()</code>.</p>

<p>The JAX version of this function may in some cases return a copy rather than a
view of the input.</p>

<p><em>Original docstring below.</em></p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (array_like):
Input data.</li>
<li><strong>axis</strong> (None or int or tuple of ints, optional):</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>squeezed</strong> (ndarray):
The input array, but with all or a subset of the
dimensions of length 1 removed. This is always <code>a</code> itself
or a view into <code>a</code>. Note that if all axes are squeezed,
the result is a 0d array and not a scalar.</li>
</ul>
</div>


                            </div>
                            <div id="Array.std" class="classattr">
                                        <input id="Array.std-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">std</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">axis</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">dtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">SupportsDType</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">ddof</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">keepdims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">where</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.std-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.std"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.std-484"><a href="#Array.std-484"><span class="linenos">484</span></a><span class="nd">@_wraps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">,</span> <span class="n">skip_params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">])</span>
</span><span id="Array.std-485"><a href="#Array.std-485"><span class="linenos">485</span></a><span class="k">def</span> <span class="nf">std</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="n">Axis</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DTypeLike</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Array.std-486"><a href="#Array.std-486"><span class="linenos">486</span></a>        <span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ddof</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">keepdims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
</span><span id="Array.std-487"><a href="#Array.std-487"><span class="linenos">487</span></a>        <span class="n">where</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.std-488"><a href="#Array.std-488"><span class="linenos">488</span></a>  <span class="k">return</span> <span class="n">_std</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">_ensure_optional_axes</span><span class="p">(</span><span class="n">axis</span><span class="p">),</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">ddof</span><span class="p">,</span> <span class="n">keepdims</span><span class="p">,</span>
</span><span id="Array.std-489"><a href="#Array.std-489"><span class="linenos">489</span></a>              <span class="n">where</span><span class="o">=</span><span class="n">where</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Compute the standard deviation along the specified axis.</p>

<p>LAX-backend implementation of <code>numpy.std()</code>.</p>

<p><em>Original docstring below.</em></p>

<p>Returns the standard deviation, a measure of the spread of a distribution,
of the array elements. The standard deviation is computed for the
flattened array by default, otherwise over the specified axis.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (array_like):
Calculate the standard deviation of these values.</li>
<li><strong>axis</strong> (None or int or tuple of ints, optional):
Axis or axes along which the standard deviation is computed. The
default is to compute the standard deviation of the flattened array.</li>
<li><strong>dtype</strong> (dtype, optional):
Type to use in computing the standard deviation. For arrays of
integer type the default is float64, for arrays of float types it is
the same as the array type.</li>
<li><strong>ddof</strong> (int, optional):
Means Delta Degrees of Freedom.  The divisor used in calculations
is <code>N - ddof</code>, where <code>N</code> represents the number of elements.
By default <code>ddof</code> is zero.</li>
<li><p><strong>keepdims</strong> (bool, optional):
If this is set to True, the axes which are reduced are left
in the result as dimensions with size one. With this option,
the result will broadcast correctly against the input array.</p>

<p>If the default value is passed, then <code>keepdims</code> will not be
passed through to the <code><a href="#Array.std">std</a></code> method of sub-classes of
<code>ndarray</code>, however any non-default value will be.  If the
sub-class' method does not implement <code>keepdims</code> any
exceptions will be raised.</p></li>
<li><strong>where</strong> (array_like of bool, optional):
Elements to include in the standard deviation.
See <code>~numpy.ufunc.reduce</code> for details.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>standard_deviation</strong> (ndarray, see dtype parameter above.):
If <code>out</code> is None, return a new array containing the standard deviation,
otherwise return a reference to the output array.</li>
</ul>
</div>


                            </div>
                            <div id="Array.sum" class="classattr">
                                        <input id="Array.sum-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">sum</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">axis</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">dtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">SupportsDType</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">keepdims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">initial</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">where</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">promote_integers</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.sum-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.sum"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.sum-217"><a href="#Array.sum-217"><span class="linenos">217</span></a><span class="nd">@_wraps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">,</span> <span class="n">skip_params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">],</span> <span class="n">extra_params</span><span class="o">=</span><span class="n">_PROMOTE_INTEGERS_DOC</span><span class="p">)</span>
</span><span id="Array.sum-218"><a href="#Array.sum-218"><span class="linenos">218</span></a><span class="k">def</span> <span class="nf">sum</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="n">Axis</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DTypeLike</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Array.sum-219"><a href="#Array.sum-219"><span class="linenos">219</span></a>        <span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">keepdims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">initial</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Array.sum-220"><a href="#Array.sum-220"><span class="linenos">220</span></a>        <span class="n">where</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">promote_integers</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.sum-221"><a href="#Array.sum-221"><span class="linenos">221</span></a>  <span class="k">return</span> <span class="n">_reduce_sum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="n">_ensure_optional_axes</span><span class="p">(</span><span class="n">axis</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span> <span class="n">out</span><span class="o">=</span><span class="n">out</span><span class="p">,</span>
</span><span id="Array.sum-222"><a href="#Array.sum-222"><span class="linenos">222</span></a>                     <span class="n">keepdims</span><span class="o">=</span><span class="n">keepdims</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="n">initial</span><span class="p">,</span> <span class="n">where</span><span class="o">=</span><span class="n">where</span><span class="p">,</span>
</span><span id="Array.sum-223"><a href="#Array.sum-223"><span class="linenos">223</span></a>                     <span class="n">promote_integers</span><span class="o">=</span><span class="n">promote_integers</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Sum of array elements over a given axis.</p>

<p>LAX-backend implementation of <code>numpy.sum()</code>.</p>

<p><em>Original docstring below.</em></p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (array_like):
Elements to sum.</li>
<li><strong>axis</strong> (None or int or tuple of ints, optional):
Axis or axes along which a sum is performed.  The default,
axis=None, will sum all of the elements of the input array.  If
axis is negative it counts from the last to the first axis.</li>
<li><strong>dtype</strong> (dtype, optional):
The type of the returned array and of the accumulator in which the
elements are summed.  The dtype of <code>a</code> is used by default unless <code>a</code>
has an integer dtype of less precision than the default platform
integer.  In that case, if <code>a</code> is signed then the platform integer
is used while if <code>a</code> is unsigned then an unsigned integer of the
same precision as the platform integer is used.</li>
<li><p><strong>keepdims</strong> (bool, optional):
If this is set to True, the axes which are reduced are left
in the result as dimensions with size one. With this option,
the result will broadcast correctly against the input array.</p>

<p>If the default value is passed, then <code>keepdims</code> will not be
passed through to the <code><a href="#Array.sum">sum</a></code> method of sub-classes of
<code>ndarray</code>, however any non-default value will be.  If the
sub-class' method does not implement <code>keepdims</code> any
exceptions will be raised.</p></li>
<li><strong>initial</strong> (scalar, optional):
Starting value for the sum. See <code>~numpy.ufunc.reduce</code> for details.</li>
<li><strong>where</strong> (array_like of bool, optional):
Elements to include in the sum. See <code>~numpy.ufunc.reduce</code> for details.</li>
<li><strong>promote_integers</strong> (bool, default=True):
If True, then integer inputs will be promoted to the widest available integer
dtype, following numpy's behavior. If False, the result will have the same dtype
as the input. <code>promote_integers</code> is ignored if <code>dtype</code> is specified.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>sum_along_axis</strong> (ndarray):
An array with the same shape as <code>a</code>, with the specified
axis removed.   If <code>a</code> is a 0-d array, or if <code>axis</code> is None, a scalar
is returned.  If an output array is specified, a reference to
<code>out</code> is returned.</li>
</ul>
</div>


                            </div>
                            <div id="Array.swapaxes" class="classattr">
                                        <input id="Array.swapaxes-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@util._wraps(np.swapaxes, lax_description=_ARRAY_VIEW_DOC)</div>
        <div class="decorator">@partial(jit, static_argnames=(&#39;axis1&#39;, &#39;axis2&#39;), inline=True)</div>

        <span class="def">def</span>
        <span class="name">swapaxes</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">axis1</span><span class="p">:</span> <span class="nb">int</span>,</span><span class="param">	<span class="n">axis2</span><span class="p">:</span> <span class="nb">int</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.swapaxes-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.swapaxes"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.swapaxes-907"><a href="#Array.swapaxes-907"><span class="linenos">907</span></a><span class="nd">@util</span><span class="o">.</span><span class="n">_wraps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">swapaxes</span><span class="p">,</span> <span class="n">lax_description</span><span class="o">=</span><span class="n">_ARRAY_VIEW_DOC</span><span class="p">)</span>
</span><span id="Array.swapaxes-908"><a href="#Array.swapaxes-908"><span class="linenos">908</span></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnames</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;axis1&#39;</span><span class="p">,</span> <span class="s1">&#39;axis2&#39;</span><span class="p">),</span> <span class="n">inline</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</span><span id="Array.swapaxes-909"><a href="#Array.swapaxes-909"><span class="linenos">909</span></a><span class="k">def</span> <span class="nf">swapaxes</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">axis1</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">axis2</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.swapaxes-910"><a href="#Array.swapaxes-910"><span class="linenos">910</span></a>  <span class="n">util</span><span class="o">.</span><span class="n">check_arraylike</span><span class="p">(</span><span class="s2">&quot;swapaxes&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span><span id="Array.swapaxes-911"><a href="#Array.swapaxes-911"><span class="linenos">911</span></a>  <span class="n">perm</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">ndim</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
</span><span id="Array.swapaxes-912"><a href="#Array.swapaxes-912"><span class="linenos">912</span></a>  <span class="n">perm</span><span class="p">[</span><span class="n">axis1</span><span class="p">],</span> <span class="n">perm</span><span class="p">[</span><span class="n">axis2</span><span class="p">]</span> <span class="o">=</span> <span class="n">perm</span><span class="p">[</span><span class="n">axis2</span><span class="p">],</span> <span class="n">perm</span><span class="p">[</span><span class="n">axis1</span><span class="p">]</span>
</span><span id="Array.swapaxes-913"><a href="#Array.swapaxes-913"><span class="linenos">913</span></a>  <span class="k">return</span> <span class="n">lax</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="nb">list</span><span class="p">(</span><span class="n">perm</span><span class="p">))</span>
</span></pre></div>


            <div class="docstring"><p>Interchange two axes of an array.</p>

<p>LAX-backend implementation of <code>numpy.swapaxes()</code>.</p>

<p>The JAX version of this function may in some cases return a copy rather than a
view of the input.</p>

<p><em>Original docstring below.</em></p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (array_like):
Input array.</li>
<li><strong>axis1</strong> (int):
First axis.</li>
<li><strong>axis2</strong> (int):
Second axis.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>a_swapped</strong> (ndarray):
For NumPy &gt;= 1.10.0, if <code>a</code> is an ndarray, then a view of <code>a</code> is
returned; otherwise a new array is created. For earlier NumPy
versions a view of <code>a</code> is returned only if the order of the
axes is changed, otherwise the input array is returned.</li>
</ul>
</div>


                            </div>
                            <div id="Array.take" class="classattr">
                                        <input id="Array.take-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@util._wraps(np.take, skip_params=[&#39;out&#39;], lax_description=&#39;\nBy default, JAX assumes that all indices are in-bounds. Alternative out-of-bound\nindex semantics can be specified via the ``mode`` parameter (see below).\n&#39;, extra_params=&#39;\nmode : string, default=&#34;fill&#34;\n    Out-of-bounds indexing mode. The default mode=&#34;fill&#34; returns invalid values\n    (e.g. NaN) for out-of bounds indices (see also ``fill_value`` below).\n    For more discussion of mode options, see :attr:`jax.numpy.ndarray.at`.\nfill_value : optional\n    The fill value to return for out-of-bounds slices when mode is \&#39;fill\&#39;. Ignored\n    otherwise. Defaults to NaN for inexact types, the largest negative value for\n    signed types, the largest positive value for unsigned types, and True for booleans.\nunique_indices : bool, default=False\n    If True, the implementation will assume that the indices are unique,\n    which can result in more efficient execution on some backends.\nindices_are_sorted : bool, default=False\n    If True, the implementation will assume that the indices are sorted in\n    ascending order, which can lead to more efficient execution on some backends.\n&#39;)</div>

        <span class="def">def</span>
        <span class="name">take</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">indices</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">unique_indices</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">indices_are_sorted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">fill_value</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.take-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.take"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.take-4031"><a href="#Array.take-4031"><span class="linenos">4031</span></a><span class="nd">@util</span><span class="o">.</span><span class="n">_wraps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">take</span><span class="p">,</span> <span class="n">skip_params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">],</span>
</span><span id="Array.take-4032"><a href="#Array.take-4032"><span class="linenos">4032</span></a>        <span class="n">lax_description</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="Array.take-4033"><a href="#Array.take-4033"><span class="linenos">4033</span></a><span class="s2">By default, JAX assumes that all indices are in-bounds. Alternative out-of-bound</span>
</span><span id="Array.take-4034"><a href="#Array.take-4034"><span class="linenos">4034</span></a><span class="s2">index semantics can be specified via the ``mode`` parameter (see below).</span>
</span><span id="Array.take-4035"><a href="#Array.take-4035"><span class="linenos">4035</span></a><span class="s2">&quot;&quot;&quot;</span><span class="p">,</span>
</span><span id="Array.take-4036"><a href="#Array.take-4036"><span class="linenos">4036</span></a>        <span class="n">extra_params</span><span class="o">=</span><span class="s2">&quot;&quot;&quot;</span>
</span><span id="Array.take-4037"><a href="#Array.take-4037"><span class="linenos">4037</span></a><span class="s2">mode : string, default=&quot;fill&quot;</span>
</span><span id="Array.take-4038"><a href="#Array.take-4038"><span class="linenos">4038</span></a><span class="s2">    Out-of-bounds indexing mode. The default mode=&quot;fill&quot; returns invalid values</span>
</span><span id="Array.take-4039"><a href="#Array.take-4039"><span class="linenos">4039</span></a><span class="s2">    (e.g. NaN) for out-of bounds indices (see also ``fill_value`` below).</span>
</span><span id="Array.take-4040"><a href="#Array.take-4040"><span class="linenos">4040</span></a><span class="s2">    For more discussion of mode options, see :attr:`jax.numpy.ndarray.at`.</span>
</span><span id="Array.take-4041"><a href="#Array.take-4041"><span class="linenos">4041</span></a><span class="s2">fill_value : optional</span>
</span><span id="Array.take-4042"><a href="#Array.take-4042"><span class="linenos">4042</span></a><span class="s2">    The fill value to return for out-of-bounds slices when mode is &#39;fill&#39;. Ignored</span>
</span><span id="Array.take-4043"><a href="#Array.take-4043"><span class="linenos">4043</span></a><span class="s2">    otherwise. Defaults to NaN for inexact types, the largest negative value for</span>
</span><span id="Array.take-4044"><a href="#Array.take-4044"><span class="linenos">4044</span></a><span class="s2">    signed types, the largest positive value for unsigned types, and True for booleans.</span>
</span><span id="Array.take-4045"><a href="#Array.take-4045"><span class="linenos">4045</span></a><span class="s2">unique_indices : bool, default=False</span>
</span><span id="Array.take-4046"><a href="#Array.take-4046"><span class="linenos">4046</span></a><span class="s2">    If True, the implementation will assume that the indices are unique,</span>
</span><span id="Array.take-4047"><a href="#Array.take-4047"><span class="linenos">4047</span></a><span class="s2">    which can result in more efficient execution on some backends.</span>
</span><span id="Array.take-4048"><a href="#Array.take-4048"><span class="linenos">4048</span></a><span class="s2">indices_are_sorted : bool, default=False</span>
</span><span id="Array.take-4049"><a href="#Array.take-4049"><span class="linenos">4049</span></a><span class="s2">    If True, the implementation will assume that the indices are sorted in</span>
</span><span id="Array.take-4050"><a href="#Array.take-4050"><span class="linenos">4050</span></a><span class="s2">    ascending order, which can lead to more efficient execution on some backends.</span>
</span><span id="Array.take-4051"><a href="#Array.take-4051"><span class="linenos">4051</span></a><span class="s2">&quot;&quot;&quot;</span><span class="p">)</span>
</span><span id="Array.take-4052"><a href="#Array.take-4052"><span class="linenos">4052</span></a><span class="k">def</span> <span class="nf">take</span><span class="p">(</span>
</span><span id="Array.take-4053"><a href="#Array.take-4053"><span class="linenos">4053</span></a>    <span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="Array.take-4054"><a href="#Array.take-4054"><span class="linenos">4054</span></a>    <span class="n">indices</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span>
</span><span id="Array.take-4055"><a href="#Array.take-4055"><span class="linenos">4055</span></a>    <span class="n">axis</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Array.take-4056"><a href="#Array.take-4056"><span class="linenos">4056</span></a>    <span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Array.take-4057"><a href="#Array.take-4057"><span class="linenos">4057</span></a>    <span class="n">mode</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Array.take-4058"><a href="#Array.take-4058"><span class="linenos">4058</span></a>    <span class="n">unique_indices</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Array.take-4059"><a href="#Array.take-4059"><span class="linenos">4059</span></a>    <span class="n">indices_are_sorted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="Array.take-4060"><a href="#Array.take-4060"><span class="linenos">4060</span></a>    <span class="n">fill_value</span><span class="p">:</span> <span class="n">ArrayLike</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Array.take-4061"><a href="#Array.take-4061"><span class="linenos">4061</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.take-4062"><a href="#Array.take-4062"><span class="linenos">4062</span></a>  <span class="k">return</span> <span class="n">_take</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">indices</span><span class="p">,</span> <span class="kc">None</span> <span class="k">if</span> <span class="n">axis</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">operator</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">axis</span><span class="p">),</span> <span class="n">out</span><span class="p">,</span>
</span><span id="Array.take-4063"><a href="#Array.take-4063"><span class="linenos">4063</span></a>               <span class="n">mode</span><span class="p">,</span> <span class="n">unique_indices</span><span class="o">=</span><span class="n">unique_indices</span><span class="p">,</span> <span class="n">indices_are_sorted</span><span class="o">=</span><span class="n">indices_are_sorted</span><span class="p">,</span>
</span><span id="Array.take-4064"><a href="#Array.take-4064"><span class="linenos">4064</span></a>               <span class="n">fill_value</span><span class="o">=</span><span class="n">fill_value</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Take elements from an array along an axis.</p>

<p>LAX-backend implementation of <code>numpy.take()</code>.</p>

<p>By default, JAX assumes that all indices are in-bounds. Alternative out-of-bound
index semantics can be specified via the <code>mode</code> parameter (see below).</p>

<p><em>Original docstring below.</em></p>

<p>When axis is not None, this function does the same thing as "fancy"
indexing (indexing arrays using arrays); however, it can be easier to use
if you need elements along a given axis. A call such as
<code>np.take(arr, indices, axis=3)</code> is equivalent to
<code>arr[:,:,:,indices,...]</code>.</p>

<p>Explained without fancy indexing, this is equivalent to the following use
of <code>ndindex</code>, which sets each of <code>ii</code>, <code>jj</code>, and <code>kk</code> to a tuple of
indices::</p>

<pre><code>Ni, Nk = a.shape[:axis], a.shape[axis+1:]
Nj = indices.shape
for ii in ndindex(Ni):
    for jj in ndindex(Nj):
        for kk in ndindex(Nk):
            out[ii + jj + kk] = a[ii + (indices[jj],) + kk]
</code></pre>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (array_like (Ni..., M, Nk...)):
The source array.</li>
<li><strong>indices</strong> (array_like (Nj...)):
The indices of the values to extract.</li>
<li><strong>axis</strong> (int, optional):
The axis over which to select values. By default, the flattened
input array is used.</li>
<li><strong>mode</strong> (string, default="fill"):
Out-of-bounds indexing mode. The default mode="fill" returns invalid values
(e.g. NaN) for out-of bounds indices (see also <code>fill_value</code> below).
For more discussion of mode options, see <code>jax.numpy.ndarray.at</code>.</li>
<li><strong>fill_value</strong> (optional):
The fill value to return for out-of-bounds slices when mode is 'fill'. Ignored
otherwise. Defaults to NaN for inexact types, the largest negative value for
signed types, the largest positive value for unsigned types, and True for booleans.</li>
<li><strong>unique_indices</strong> (bool, default=False):
If True, the implementation will assume that the indices are unique,
which can result in more efficient execution on some backends.</li>
<li><strong>indices_are_sorted</strong> (bool, default=False):
If True, the implementation will assume that the indices are sorted in
ascending order, which can lead to more efficient execution on some backends.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>out</strong> (ndarray (Ni..., Nj..., Nk...)):
The returned array has the same type as <code>a</code>.</li>
</ul>
</div>


                            </div>
                            <div id="Array.trace" class="classattr">
                                        <input id="Array.trace-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
                    <div class="decorator">@util._wraps(np.trace, skip_params=[&#39;out&#39;])</div>
        <div class="decorator">@partial(jit, static_argnames=(&#39;offset&#39;, &#39;axis1&#39;, &#39;axis2&#39;, &#39;dtype&#39;))</div>

        <span class="def">def</span>
        <span class="name">trace</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">axis1</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">axis2</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span>,</span><span class="param">	<span class="n">dtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">SupportsDType</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.trace-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.trace"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.trace-2746"><a href="#Array.trace-2746"><span class="linenos">2746</span></a><span class="nd">@util</span><span class="o">.</span><span class="n">_wraps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">trace</span><span class="p">,</span> <span class="n">skip_params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">])</span>
</span><span id="Array.trace-2747"><a href="#Array.trace-2747"><span class="linenos">2747</span></a><span class="nd">@partial</span><span class="p">(</span><span class="n">jit</span><span class="p">,</span> <span class="n">static_argnames</span><span class="o">=</span><span class="p">(</span><span class="s1">&#39;offset&#39;</span><span class="p">,</span> <span class="s1">&#39;axis1&#39;</span><span class="p">,</span> <span class="s1">&#39;axis2&#39;</span><span class="p">,</span> <span class="s1">&#39;dtype&#39;</span><span class="p">))</span>
</span><span id="Array.trace-2748"><a href="#Array.trace-2748"><span class="linenos">2748</span></a><span class="k">def</span> <span class="nf">trace</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">offset</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis1</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">axis2</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span>
</span><span id="Array.trace-2749"><a href="#Array.trace-2749"><span class="linenos">2749</span></a>          <span class="n">dtype</span><span class="p">:</span> <span class="n">DTypeLike</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.trace-2750"><a href="#Array.trace-2750"><span class="linenos">2750</span></a>  <span class="n">util</span><span class="o">.</span><span class="n">check_arraylike</span><span class="p">(</span><span class="s2">&quot;trace&quot;</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
</span><span id="Array.trace-2751"><a href="#Array.trace-2751"><span class="linenos">2751</span></a>  <span class="k">if</span> <span class="n">out</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Array.trace-2752"><a href="#Array.trace-2752"><span class="linenos">2752</span></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;The &#39;out&#39; argument to jnp.trace is not supported.&quot;</span><span class="p">)</span>
</span><span id="Array.trace-2753"><a href="#Array.trace-2753"><span class="linenos">2753</span></a>  <span class="n">dtypes</span><span class="o">.</span><span class="n">check_user_dtype_supported</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;trace&quot;</span><span class="p">)</span>
</span><span id="Array.trace-2754"><a href="#Array.trace-2754"><span class="linenos">2754</span></a>
</span><span id="Array.trace-2755"><a href="#Array.trace-2755"><span class="linenos">2755</span></a>  <span class="n">a_shape</span> <span class="o">=</span> <span class="n">shape</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="Array.trace-2756"><a href="#Array.trace-2756"><span class="linenos">2756</span></a>  <span class="k">if</span> <span class="n">dtype</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Array.trace-2757"><a href="#Array.trace-2757"><span class="linenos">2757</span></a>    <span class="n">dtype</span> <span class="o">=</span> <span class="n">_dtype</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
</span><span id="Array.trace-2758"><a href="#Array.trace-2758"><span class="linenos">2758</span></a>    <span class="k">if</span> <span class="n">issubdtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">integer</span><span class="p">):</span>
</span><span id="Array.trace-2759"><a href="#Array.trace-2759"><span class="linenos">2759</span></a>      <span class="n">default_int</span> <span class="o">=</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">canonicalize_dtype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
</span><span id="Array.trace-2760"><a href="#Array.trace-2760"><span class="linenos">2760</span></a>      <span class="k">if</span> <span class="n">iinfo</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">bits</span> <span class="o">&lt;</span> <span class="n">iinfo</span><span class="p">(</span><span class="n">default_int</span><span class="p">)</span><span class="o">.</span><span class="n">bits</span><span class="p">:</span>
</span><span id="Array.trace-2761"><a href="#Array.trace-2761"><span class="linenos">2761</span></a>        <span class="n">dtype</span> <span class="o">=</span> <span class="n">default_int</span>
</span><span id="Array.trace-2762"><a href="#Array.trace-2762"><span class="linenos">2762</span></a>
</span><span id="Array.trace-2763"><a href="#Array.trace-2763"><span class="linenos">2763</span></a>  <span class="n">a</span> <span class="o">=</span> <span class="n">moveaxis</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="p">(</span><span class="n">axis1</span><span class="p">,</span> <span class="n">axis2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">))</span>
</span><span id="Array.trace-2764"><a href="#Array.trace-2764"><span class="linenos">2764</span></a>
</span><span id="Array.trace-2765"><a href="#Array.trace-2765"><span class="linenos">2765</span></a>  <span class="c1"># Mask out the diagonal and reduce.</span>
</span><span id="Array.trace-2766"><a href="#Array.trace-2766"><span class="linenos">2766</span></a>  <span class="n">a</span> <span class="o">=</span> <span class="n">where</span><span class="p">(</span><span class="n">eye</span><span class="p">(</span><span class="n">a_shape</span><span class="p">[</span><span class="n">axis1</span><span class="p">],</span> <span class="n">a_shape</span><span class="p">[</span><span class="n">axis2</span><span class="p">],</span> <span class="n">k</span><span class="o">=</span><span class="n">offset</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">bool</span><span class="p">),</span>
</span><span id="Array.trace-2767"><a href="#Array.trace-2767"><span class="linenos">2767</span></a>            <span class="n">a</span><span class="p">,</span> <span class="n">zeros_like</span><span class="p">(</span><span class="n">a</span><span class="p">))</span>
</span><span id="Array.trace-2768"><a href="#Array.trace-2768"><span class="linenos">2768</span></a>  <span class="k">return</span> <span class="n">reductions</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return the sum along diagonals of the array.</p>

<p>LAX-backend implementation of <code>numpy.trace()</code>.</p>

<p><em>Original docstring below.</em></p>

<p>If <code>a</code> is 2-D, the sum along its diagonal with the given offset
is returned, i.e., the sum of elements <code>a[i,i+offset]</code> for all i.</p>

<p>If <code>a</code> has more than two dimensions, then the axes specified by axis1 and
axis2 are used to determine the 2-D sub-arrays whose traces are returned.
The shape of the resulting array is the same as that of <code>a</code> with <code>axis1</code>
and <code>axis2</code> removed.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (array_like):
Input array, from which the diagonals are taken.</li>
<li><strong>offset</strong> (int, optional):
Offset of the diagonal from the main diagonal. Can be both positive
and negative. Defaults to 0.</li>
<li><strong>axis1, axis2</strong> (int, optional):
Axes to be used as the first and second axis of the 2-D sub-arrays
from which the diagonals should be taken. Defaults are the first two
axes of <code>a</code>.</li>
<li><strong>dtype</strong> (dtype, optional):
Determines the data-type of the returned array and of the accumulator
where the elements are summed. If dtype has the value None and <code>a</code> is
of integer type of precision less than the default integer
precision, then the default integer precision is used. Otherwise,
the precision is the same as that of <code>a</code>.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>sum_along_diagonals</strong> (ndarray):
If <code>a</code> is 2-D, the sum along the diagonal is returned.  If <code>a</code> has
larger dimensions, then an array of sums along diagonals is returned.</li>
</ul>
</div>


                            </div>
                            <div id="Array.transpose" class="classattr">
                                        <input id="Array.transpose-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">transpose</span><span class="signature pdoc-code condensed">(<span class="param"><span class="n">a</span><span class="p">:</span> <span class="n"><a href="#Array">Array</a></span>, </span><span class="param"><span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.transpose-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.transpose"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.transpose-103"><a href="#Array.transpose-103"><span class="linenos">103</span></a><span class="k">def</span> <span class="nf">_transpose</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">:</span> <span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.transpose-104"><a href="#Array.transpose-104"><span class="linenos">104</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Returns a view of the array with axes transposed.</span>
</span><span id="Array.transpose-105"><a href="#Array.transpose-105"><span class="linenos">105</span></a>
</span><span id="Array.transpose-106"><a href="#Array.transpose-106"><span class="linenos">106</span></a><span class="sd">  Refer to :func:`jax.numpy.transpose` for full documentation.</span>
</span><span id="Array.transpose-107"><a href="#Array.transpose-107"><span class="linenos">107</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="Array.transpose-108"><a href="#Array.transpose-108"><span class="linenos">108</span></a>  <span class="k">if</span> <span class="ow">not</span> <span class="n">args</span><span class="p">:</span>
</span><span id="Array.transpose-109"><a href="#Array.transpose-109"><span class="linenos">109</span></a>    <span class="n">axis</span> <span class="o">=</span> <span class="kc">None</span>
</span><span id="Array.transpose-110"><a href="#Array.transpose-110"><span class="linenos">110</span></a>  <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">args</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
</span><span id="Array.transpose-111"><a href="#Array.transpose-111"><span class="linenos">111</span></a>    <span class="n">axis</span> <span class="o">=</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">_ensure_index_tuple</span><span class="p">(</span><span class="n">args</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</span><span id="Array.transpose-112"><a href="#Array.transpose-112"><span class="linenos">112</span></a>  <span class="k">else</span><span class="p">:</span>
</span><span id="Array.transpose-113"><a href="#Array.transpose-113"><span class="linenos">113</span></a>    <span class="n">axis</span> <span class="o">=</span> <span class="n">_ensure_index_tuple</span><span class="p">(</span><span class="n">args</span><span class="p">)</span>
</span><span id="Array.transpose-114"><a href="#Array.transpose-114"><span class="linenos">114</span></a>  <span class="k">return</span> <span class="n">lax_numpy</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">axis</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Returns a view of the array with axes transposed.</p>

<p>Refer to <code>jax.numpy.transpose()</code> for full documentation.</p>
</div>


                            </div>
                            <div id="Array.var" class="classattr">
                                        <input id="Array.var-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">var</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">a</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">]</span>,</span><span class="param">	<span class="n">axis</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">NoneType</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="n">collections</span><span class="o">.</span><span class="n">abc</span><span class="o">.</span><span class="n">Sequence</span><span class="p">[</span><span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">dtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">SupportsDType</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">ddof</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span>,</span><span class="param">	<span class="n">keepdims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="o">*</span>,</span><span class="param">	<span class="n">where</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">bool_</span><span class="p">,</span> <span class="n">numpy</span><span class="o">.</span><span class="n">number</span><span class="p">,</span> <span class="nb">bool</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">complex</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.var-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.var"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.var-423"><a href="#Array.var-423"><span class="linenos">423</span></a><span class="nd">@_wraps</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">,</span> <span class="n">skip_params</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;out&#39;</span><span class="p">])</span>
</span><span id="Array.var-424"><a href="#Array.var-424"><span class="linenos">424</span></a><span class="k">def</span> <span class="nf">var</span><span class="p">(</span><span class="n">a</span><span class="p">:</span> <span class="n">ArrayLike</span><span class="p">,</span> <span class="n">axis</span><span class="p">:</span> <span class="n">Axis</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DTypeLike</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="Array.var-425"><a href="#Array.var-425"><span class="linenos">425</span></a>        <span class="n">out</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">ddof</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">keepdims</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span>
</span><span id="Array.var-426"><a href="#Array.var-426"><span class="linenos">426</span></a>        <span class="n">where</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.var-427"><a href="#Array.var-427"><span class="linenos">427</span></a>  <span class="k">return</span> <span class="n">_var</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">_ensure_optional_axes</span><span class="p">(</span><span class="n">axis</span><span class="p">),</span> <span class="n">dtype</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">ddof</span><span class="p">,</span> <span class="n">keepdims</span><span class="p">,</span>
</span><span id="Array.var-428"><a href="#Array.var-428"><span class="linenos">428</span></a>              <span class="n">where</span><span class="o">=</span><span class="n">where</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Compute the variance along the specified axis.</p>

<p>LAX-backend implementation of <code>numpy.var()</code>.</p>

<p><em>Original docstring below.</em></p>

<p>Returns the variance of the array elements, a measure of the spread of a
distribution.  The variance is computed for the flattened array by
default, otherwise over the specified axis.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (array_like):
Array containing numbers whose variance is desired.  If <code>a</code> is not an
array, a conversion is attempted.</li>
<li><strong>axis</strong> (None or int or tuple of ints, optional):
Axis or axes along which the variance is computed.  The default is to
compute the variance of the flattened array.</li>
<li><strong>dtype</strong> (data-type, optional):
Type to use in computing the variance.  For arrays of integer type
the default is <code>float64</code>; for arrays of float types it is the same as
the array type.</li>
<li><strong>ddof</strong> (int, optional):
"Delta Degrees of Freedom": the divisor used in the calculation is
<code>N - ddof</code>, where <code>N</code> represents the number of elements. By
default <code>ddof</code> is zero.</li>
<li><p><strong>keepdims</strong> (bool, optional):
If this is set to True, the axes which are reduced are left
in the result as dimensions with size one. With this option,
the result will broadcast correctly against the input array.</p>

<p>If the default value is passed, then <code>keepdims</code> will not be
passed through to the <code><a href="#Array.var">var</a></code> method of sub-classes of
<code>ndarray</code>, however any non-default value will be.  If the
sub-class' method does not implement <code>keepdims</code> any
exceptions will be raised.</p></li>
<li><strong>where</strong> (array_like of bool, optional):
Elements to include in the variance. See <code>~numpy.ufunc.reduce</code> for
details.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>variance</strong> (ndarray, see dtype parameter above):
If <code>out=None</code>, returns a new array containing the variance;
otherwise, a reference to the output array is returned.</li>
</ul>
</div>


                            </div>
                            <div id="Array.view" class="classattr">
                                        <input id="Array.view-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">view</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">arr</span><span class="p">:</span> <span class="n"><a href="#Array">Array</a></span>,</span><span class="param">	<span class="n">dtype</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">type</span><span class="p">[</span><span class="n">Any</span><span class="p">],</span> <span class="n">numpy</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">typing</span><span class="o">.</span><span class="n">SupportsDType</span><span class="p">,</span> <span class="n">NoneType</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="nb">type</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="Array.view-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#Array.view"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="Array.view-154"><a href="#Array.view-154"><span class="linenos">154</span></a><span class="k">def</span> <span class="nf">_view</span><span class="p">(</span><span class="n">arr</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">DTypeLike</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="nb">type</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="Array.view-155"><a href="#Array.view-155"><span class="linenos">155</span></a><span class="w">  </span><span class="sd">&quot;&quot;&quot;Return a bitwise copy of the array, viewed as a new dtype.</span>
</span><span id="Array.view-156"><a href="#Array.view-156"><span class="linenos">156</span></a>
</span><span id="Array.view-157"><a href="#Array.view-157"><span class="linenos">157</span></a><span class="sd">  This is fuller-featured wrapper around :func:`jax.lax.bitcast_convert_type`.</span>
</span><span id="Array.view-158"><a href="#Array.view-158"><span class="linenos">158</span></a>
</span><span id="Array.view-159"><a href="#Array.view-159"><span class="linenos">159</span></a><span class="sd">  If the source and target dtype have the same bitwidth, the result has the same</span>
</span><span id="Array.view-160"><a href="#Array.view-160"><span class="linenos">160</span></a><span class="sd">  shape as the input array. If the bitwidth of the target dtype is different</span>
</span><span id="Array.view-161"><a href="#Array.view-161"><span class="linenos">161</span></a><span class="sd">  from the source, the size of the last axis of the result is adjusted</span>
</span><span id="Array.view-162"><a href="#Array.view-162"><span class="linenos">162</span></a><span class="sd">  accordingly.</span>
</span><span id="Array.view-163"><a href="#Array.view-163"><span class="linenos">163</span></a>
</span><span id="Array.view-164"><a href="#Array.view-164"><span class="linenos">164</span></a><span class="sd">  &gt;&gt;&gt; jnp.zeros([1,2,3], dtype=jnp.int16).view(jnp.int8).shape</span>
</span><span id="Array.view-165"><a href="#Array.view-165"><span class="linenos">165</span></a><span class="sd">  (1, 2, 6)</span>
</span><span id="Array.view-166"><a href="#Array.view-166"><span class="linenos">166</span></a><span class="sd">  &gt;&gt;&gt; jnp.zeros([1,2,4], dtype=jnp.int8).view(jnp.int16).shape</span>
</span><span id="Array.view-167"><a href="#Array.view-167"><span class="linenos">167</span></a><span class="sd">  (1, 2, 2)</span>
</span><span id="Array.view-168"><a href="#Array.view-168"><span class="linenos">168</span></a>
</span><span id="Array.view-169"><a href="#Array.view-169"><span class="linenos">169</span></a><span class="sd">  Conversions involving booleans are not well-defined in all situations. With</span>
</span><span id="Array.view-170"><a href="#Array.view-170"><span class="linenos">170</span></a><span class="sd">  regards to the shape of result as explained above, booleans are treated as</span>
</span><span id="Array.view-171"><a href="#Array.view-171"><span class="linenos">171</span></a><span class="sd">  having a bitwidth of 8. However, when converting to a boolean array, the input</span>
</span><span id="Array.view-172"><a href="#Array.view-172"><span class="linenos">172</span></a><span class="sd">  should only contain 0 or 1 bytes. Otherwise, results may be unpredictable or</span>
</span><span id="Array.view-173"><a href="#Array.view-173"><span class="linenos">173</span></a><span class="sd">  may change depending on how the result is used.</span>
</span><span id="Array.view-174"><a href="#Array.view-174"><span class="linenos">174</span></a>
</span><span id="Array.view-175"><a href="#Array.view-175"><span class="linenos">175</span></a><span class="sd">  This conversion is guaranteed and safe:</span>
</span><span id="Array.view-176"><a href="#Array.view-176"><span class="linenos">176</span></a><span class="sd">  &gt;&gt;&gt; jnp.array([1, 0, 1], dtype=jnp.int8).view(jnp.bool_)</span>
</span><span id="Array.view-177"><a href="#Array.view-177"><span class="linenos">177</span></a><span class="sd">  Array([ True, False,  True], dtype=bool)</span>
</span><span id="Array.view-178"><a href="#Array.view-178"><span class="linenos">178</span></a>
</span><span id="Array.view-179"><a href="#Array.view-179"><span class="linenos">179</span></a><span class="sd">  However, there are no guarantees about the results of any expression involving</span>
</span><span id="Array.view-180"><a href="#Array.view-180"><span class="linenos">180</span></a><span class="sd">  a view such as this: `jnp.array([1, 2, 3], dtype=jnp.int8).view(jnp.bool_)`.</span>
</span><span id="Array.view-181"><a href="#Array.view-181"><span class="linenos">181</span></a><span class="sd">  In particular, the results may change between JAX releases and depending on</span>
</span><span id="Array.view-182"><a href="#Array.view-182"><span class="linenos">182</span></a><span class="sd">  the platform. To safely convert such an array to a boolean array, compare it</span>
</span><span id="Array.view-183"><a href="#Array.view-183"><span class="linenos">183</span></a><span class="sd">  with `0`:</span>
</span><span id="Array.view-184"><a href="#Array.view-184"><span class="linenos">184</span></a>
</span><span id="Array.view-185"><a href="#Array.view-185"><span class="linenos">185</span></a><span class="sd">  &gt;&gt;&gt; jnp.array([1, 2, 0], dtype=jnp.int8) != 0</span>
</span><span id="Array.view-186"><a href="#Array.view-186"><span class="linenos">186</span></a><span class="sd">  Array([ True,  True, False], dtype=bool)</span>
</span><span id="Array.view-187"><a href="#Array.view-187"><span class="linenos">187</span></a><span class="sd">  &quot;&quot;&quot;</span>
</span><span id="Array.view-188"><a href="#Array.view-188"><span class="linenos">188</span></a>  <span class="k">if</span> <span class="nb">type</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="Array.view-189"><a href="#Array.view-189"><span class="linenos">189</span></a>    <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="s2">&quot;`type` argument of array.view() is not supported.&quot;</span><span class="p">)</span>
</span><span id="Array.view-190"><a href="#Array.view-190"><span class="linenos">190</span></a>
</span><span id="Array.view-191"><a href="#Array.view-191"><span class="linenos">191</span></a>  <span class="n">util</span><span class="o">.</span><span class="n">check_arraylike</span><span class="p">(</span><span class="s2">&quot;view&quot;</span><span class="p">,</span> <span class="n">arr</span><span class="p">)</span>
</span><span id="Array.view-192"><a href="#Array.view-192"><span class="linenos">192</span></a>  <span class="n">arr</span> <span class="o">=</span> <span class="n">lax_numpy</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
</span><span id="Array.view-193"><a href="#Array.view-193"><span class="linenos">193</span></a>
</span><span id="Array.view-194"><a href="#Array.view-194"><span class="linenos">194</span></a>  <span class="n">dtypes</span><span class="o">.</span><span class="n">check_user_dtype_supported</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="s2">&quot;view&quot;</span><span class="p">)</span>
</span><span id="Array.view-195"><a href="#Array.view-195"><span class="linenos">195</span></a>  <span class="n">dtype</span> <span class="o">=</span> <span class="n">dtypes</span><span class="o">.</span><span class="n">canonicalize_dtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="Array.view-196"><a href="#Array.view-196"><span class="linenos">196</span></a>
</span><span id="Array.view-197"><a href="#Array.view-197"><span class="linenos">197</span></a>  <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Array.view-198"><a href="#Array.view-198"><span class="linenos">198</span></a>    <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">itemsize</span> <span class="o">!=</span> <span class="n">dtype</span><span class="o">.</span><span class="n">itemsize</span><span class="p">:</span>
</span><span id="Array.view-199"><a href="#Array.view-199"><span class="linenos">199</span></a>      <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;view() of a 0d array is only supported if the itemsize is unchanged.&quot;</span><span class="p">)</span>
</span><span id="Array.view-200"><a href="#Array.view-200"><span class="linenos">200</span></a>    <span class="k">return</span> <span class="n">_view</span><span class="p">(</span><span class="n">lax</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,)),</span> <span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span>
</span><span id="Array.view-201"><a href="#Array.view-201"><span class="linenos">201</span></a>
</span><span id="Array.view-202"><a href="#Array.view-202"><span class="linenos">202</span></a>  <span class="k">if</span> <span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">itemsize</span><span class="p">)</span> <span class="o">%</span> <span class="n">dtype</span><span class="o">.</span><span class="n">itemsize</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
</span><span id="Array.view-203"><a href="#Array.view-203"><span class="linenos">203</span></a>    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;When changing to a larger dtype, its size must be a divisor &quot;</span>
</span><span id="Array.view-204"><a href="#Array.view-204"><span class="linenos">204</span></a>                     <span class="s2">&quot;of the total size in bytes of the last axis of the array.&quot;</span><span class="p">)</span>
</span><span id="Array.view-205"><a href="#Array.view-205"><span class="linenos">205</span></a>
</span><span id="Array.view-206"><a href="#Array.view-206"><span class="linenos">206</span></a>  <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="n">dtype</span><span class="p">:</span>
</span><span id="Array.view-207"><a href="#Array.view-207"><span class="linenos">207</span></a>    <span class="k">return</span> <span class="n">arr</span>
</span><span id="Array.view-208"><a href="#Array.view-208"><span class="linenos">208</span></a>
</span><span id="Array.view-209"><a href="#Array.view-209"><span class="linenos">209</span></a>  <span class="c1"># lax.bitcast_convert_type does not support bool or complex; in these cases we</span>
</span><span id="Array.view-210"><a href="#Array.view-210"><span class="linenos">210</span></a>  <span class="c1"># cast to a compatible type and recursively call _view for simplicity.</span>
</span><span id="Array.view-211"><a href="#Array.view-211"><span class="linenos">211</span></a>  <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span> <span class="o">==</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Array.view-212"><a href="#Array.view-212"><span class="linenos">212</span></a>    <span class="k">return</span> <span class="n">_view</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;uint8&#39;</span><span class="p">),</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="Array.view-213"><a href="#Array.view-213"><span class="linenos">213</span></a>
</span><span id="Array.view-214"><a href="#Array.view-214"><span class="linenos">214</span></a>  <span class="k">if</span> <span class="n">lax_numpy</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">complexfloating</span><span class="p">):</span>
</span><span id="Array.view-215"><a href="#Array.view-215"><span class="linenos">215</span></a>    <span class="n">new_shape</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="mi">2</span><span class="p">)</span>
</span><span id="Array.view-216"><a href="#Array.view-216"><span class="linenos">216</span></a>    <span class="n">new_dtype</span> <span class="o">=</span> <span class="n">lax_numpy</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">dtype</span>
</span><span id="Array.view-217"><a href="#Array.view-217"><span class="linenos">217</span></a>    <span class="n">arr</span> <span class="o">=</span> <span class="p">(</span><span class="n">lax_numpy</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">new_shape</span><span class="p">,</span> <span class="n">new_dtype</span><span class="p">)</span>
</span><span id="Array.view-218"><a href="#Array.view-218"><span class="linenos">218</span></a>             <span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">real</span><span class="p">)</span>
</span><span id="Array.view-219"><a href="#Array.view-219"><span class="linenos">219</span></a>             <span class="o">.</span><span class="n">at</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set</span><span class="p">(</span><span class="n">arr</span><span class="o">.</span><span class="n">imag</span><span class="p">))</span>
</span><span id="Array.view-220"><a href="#Array.view-220"><span class="linenos">220</span></a>    <span class="k">return</span> <span class="n">_view</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="Array.view-221"><a href="#Array.view-221"><span class="linenos">221</span></a>
</span><span id="Array.view-222"><a href="#Array.view-222"><span class="linenos">222</span></a>  <span class="k">if</span> <span class="n">dtype</span> <span class="o">==</span> <span class="nb">bool</span><span class="p">:</span>
</span><span id="Array.view-223"><a href="#Array.view-223"><span class="linenos">223</span></a>    <span class="k">return</span> <span class="n">_view</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
</span><span id="Array.view-224"><a href="#Array.view-224"><span class="linenos">224</span></a>
</span><span id="Array.view-225"><a href="#Array.view-225"><span class="linenos">225</span></a>  <span class="k">if</span> <span class="n">lax_numpy</span><span class="o">.</span><span class="n">issubdtype</span><span class="p">(</span><span class="n">dtype</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">complexfloating</span><span class="p">):</span>
</span><span id="Array.view-226"><a href="#Array.view-226"><span class="linenos">226</span></a>    <span class="n">out</span> <span class="o">=</span> <span class="n">_view</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">lax_numpy</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">dtype</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="Array.view-227"><a href="#Array.view-227"><span class="linenos">227</span></a>    <span class="k">return</span> <span class="n">out</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="mi">1</span><span class="n">j</span> <span class="o">*</span> <span class="n">out</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span>
</span><span id="Array.view-228"><a href="#Array.view-228"><span class="linenos">228</span></a>
</span><span id="Array.view-229"><a href="#Array.view-229"><span class="linenos">229</span></a>  <span class="c1"># lax.bitcast_convert_type adds or subtracts dimensions depending on the</span>
</span><span id="Array.view-230"><a href="#Array.view-230"><span class="linenos">230</span></a>  <span class="c1"># relative bitwidths of the dtypes; we account for that with reshapes.</span>
</span><span id="Array.view-231"><a href="#Array.view-231"><span class="linenos">231</span></a>  <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">itemsize</span> <span class="o">&lt;</span> <span class="n">dtype</span><span class="o">.</span><span class="n">itemsize</span><span class="p">:</span>
</span><span id="Array.view-232"><a href="#Array.view-232"><span class="linenos">232</span></a>    <span class="n">factor</span> <span class="o">=</span> <span class="n">dtype</span><span class="o">.</span><span class="n">itemsize</span> <span class="o">//</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">itemsize</span>
</span><span id="Array.view-233"><a href="#Array.view-233"><span class="linenos">233</span></a>    <span class="n">arr</span> <span class="o">=</span> <span class="n">arr</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">*</span><span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">//</span> <span class="n">factor</span><span class="p">,</span> <span class="n">factor</span><span class="p">)</span>
</span><span id="Array.view-234"><a href="#Array.view-234"><span class="linenos">234</span></a>    <span class="k">return</span> <span class="n">lax</span><span class="o">.</span><span class="n">bitcast_convert_type</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="Array.view-235"><a href="#Array.view-235"><span class="linenos">235</span></a>
</span><span id="Array.view-236"><a href="#Array.view-236"><span class="linenos">236</span></a>  <span class="k">if</span> <span class="n">arr</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">itemsize</span> <span class="o">&gt;</span> <span class="n">dtype</span><span class="o">.</span><span class="n">itemsize</span><span class="p">:</span>
</span><span id="Array.view-237"><a href="#Array.view-237"><span class="linenos">237</span></a>    <span class="n">out</span> <span class="o">=</span> <span class="n">lax</span><span class="o">.</span><span class="n">bitcast_convert_type</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</span><span id="Array.view-238"><a href="#Array.view-238"><span class="linenos">238</span></a>    <span class="k">return</span> <span class="n">out</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">*</span><span class="n">out</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">out</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">*</span> <span class="n">out</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
</span><span id="Array.view-239"><a href="#Array.view-239"><span class="linenos">239</span></a>
</span><span id="Array.view-240"><a href="#Array.view-240"><span class="linenos">240</span></a>  <span class="k">return</span> <span class="n">lax</span><span class="o">.</span><span class="n">bitcast_convert_type</span><span class="p">(</span><span class="n">arr</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
</span></pre></div>


            <div class="docstring"><p>Return a bitwise copy of the array, viewed as a new dtype.</p>

<p>This is fuller-featured wrapper around <code>jax.lax.bitcast_convert_type()</code>.</p>

<p>If the source and target dtype have the same bitwidth, the result has the same
shape as the input array. If the bitwidth of the target dtype is different
from the source, the size of the last axis of the result is adjusted
accordingly.</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">3</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(1, 2, 6)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">int16</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
<span class="go">(1, 2, 2)</span>
</code></pre>
</div>

<p>Conversions involving booleans are not well-defined in all situations. With
regards to the shape of result as explained above, booleans are treated as
having a bitwidth of 8. However, when converting to a boolean array, the input
should only contain 0 or 1 bytes. Otherwise, results may be unpredictable or
may change depending on how the result is used.</p>

<p>This conversion is guaranteed and safe:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span><span class="o">.</span><span class="n">view</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">bool_</span><span class="p">)</span>
<span class="go">Array([ True, False,  True], dtype=bool)</span>
</code></pre>
</div>

<p>However, there are no guarantees about the results of any expression involving
a view such as this: <code>jnp.array([1, 2, 3], dtype=jnp.int8).view(jnp.bool_)</code>.
In particular, the results may change between JAX releases and depending on
the platform. To safely convert such an array to a boolean array, compare it
with <code>0</code>:</p>

<div class="pdoc-code codehilite">
<pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">jnp</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">],</span> <span class="n">dtype</span><span class="o">=</span><span class="n">jnp</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span>
<span class="go">Array([ True,  True, False], dtype=bool)</span>
</code></pre>
</div>
</div>


                            </div>
                            <div id="Array.flat" class="classattr">
                                <div class="attr variable">
            <span class="name">flat</span>

        
    </div>
    <a class="headerlink" href="#Array.flat"></a>
    
    

                            </div>
                            <div id="Array.T" class="classattr">
                                <div class="attr variable">
            <span class="name">T</span><span class="annotation">: <a href="#Array">Array</a></span>

        
    </div>
    <a class="headerlink" href="#Array.T"></a>
    
            <div class="docstring"><p>Returns an array with axes transposed.</p>

<p>LAX-backend implementation of <code>numpy.transpose()</code>.</p>

<p>The JAX version of this function may in some cases return a copy rather than a
view of the input.</p>

<p><em>Original docstring below.</em></p>

<p>For a 1-D array, this returns an unchanged view of the original array, as a
transposed vector is simply the same vector.
To convert a 1-D array into a 2-D column vector, an additional dimension
must be added, e.g., <code>np.atleast2d(a).T</code> achieves this, as does
<code>a[:, np.newaxis]</code>.
For a 2-D array, this is the standard matrix transpose.
For an n-D array, if axes are given, their order indicates how the
axes are permuted (see Examples). If axes are not provided, then
<code>transpose(a).shape == a.shape[::-1]</code>.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>a</strong> (array_like):
Input array.</li>
<li><strong>axes</strong> (tuple or list of ints, optional):
If specified, it must be a tuple or list which contains a permutation
of [0,1,...,N-1] where N is the number of axes of <code>a</code>. The <code>i</code>'th axis
of the returned array will correspond to the axis numbered <code>axes[i]</code>
of the input. If not specified, defaults to <code>range(a.ndim)[::-1]</code>,
which reverses the order of the axes.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>p</strong> (ndarray):
<code>a</code> with its axes permuted. A view is returned whenever possible.</li>
</ul>
</div>


                            </div>
                            <div id="Array.mT" class="classattr">
                                <div class="attr variable">
            <span class="name">mT</span><span class="annotation">: <a href="#Array">Array</a></span>

        
    </div>
    <a class="headerlink" href="#Array.mT"></a>
    
            <div class="docstring"><p>Transposes the last two dimensions of x.</p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>x</strong> (array_like):
Input array. Must have <code>x.ndim &gt;= 2</code>.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>xT</strong> (Array):
Transposed array.</li>
</ul>
</div>


                            </div>
                            <div id="Array.real" class="classattr">
                                <div class="attr variable">
            <span class="name">real</span><span class="annotation">: <a href="#Array">Array</a></span>

        
    </div>
    <a class="headerlink" href="#Array.real"></a>
    
            <div class="docstring"><p>Return the real part of the complex argument.</p>

<p>LAX-backend implementation of <code>numpy.real()</code>.</p>

<p><em>Original docstring below.</em></p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>val</strong> (array_like):
Input array.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>out</strong> (ndarray or scalar):
The real component of the complex argument. If <code>val</code> is real, the type
of <code>val</code> is used for the output.  If <code>val</code> has complex elements, the
returned type is float.</li>
</ul>
</div>


                            </div>
                            <div id="Array.imag" class="classattr">
                                <div class="attr variable">
            <span class="name">imag</span><span class="annotation">: <a href="#Array">Array</a></span>

        
    </div>
    <a class="headerlink" href="#Array.imag"></a>
    
            <div class="docstring"><p>Return the imaginary part of the complex argument.</p>

<p>LAX-backend implementation of <code>numpy.imag()</code>.</p>

<p><em>Original docstring below.</em></p>

<h6 id="parameters">Parameters</h6>

<ul>
<li><strong>val</strong> (array_like):
Input array.</li>
</ul>

<h6 id="returns">Returns</h6>

<ul>
<li><strong>out</strong> (ndarray or scalar):
The imaginary component of the complex argument. If <code>val</code> is real,
the type of <code>val</code> is used for the output.  If <code>val</code> has complex
elements, the returned type is float.</li>
</ul>
</div>


                            </div>
                            <div id="Array.nbytes" class="classattr">
                                <div class="attr variable">
            <span class="name">nbytes</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#Array.nbytes"></a>
    
            <div class="docstring"><p>Total bytes consumed by the elements of the array.</p>
</div>


                            </div>
                            <div id="Array.itemsize" class="classattr">
                                <div class="attr variable">
            <span class="name">itemsize</span><span class="annotation">: int</span>

        
    </div>
    <a class="headerlink" href="#Array.itemsize"></a>
    
            <div class="docstring"><p>Length of one array element in bytes.</p>
</div>


                            </div>
                </section>
                <section id="PRNGKey">
                    <div class="attr variable">
            <span class="name">PRNGKey</span>        =
<span class="default_value">typing.Any</span>

        
    </div>
    <a class="headerlink" href="#PRNGKey"></a>
    
    

                </section>
                <section id="DType">
                    <div class="attr variable">
            <span class="name">DType</span>        =
<span class="default_value">typing.Any</span>

        
    </div>
    <a class="headerlink" href="#DType"></a>
    
    

                </section>
                <section id="dot_product_attention_queries_per_head">
                            <input id="dot_product_attention_queries_per_head-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">dot_product_attention_queries_per_head</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">query</span><span class="p">:</span> <span class="n"><a href="#Array">Array</a></span>,</span><span class="param">	<span class="n">key</span><span class="p">:</span> <span class="n"><a href="#Array">Array</a></span>,</span><span class="param">	<span class="n">value</span><span class="p">:</span> <span class="n"><a href="#Array">Array</a></span>,</span><span class="param">	<span class="n">bias</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">broadcast_dropout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">rescale_logits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">dropout_rng</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">dropout_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>,</span><span class="param">	<span class="n">enable_dropout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	dtype: Any = &lt;class &#x27;jax.numpy.float32&#x27;&gt;,</span><span class="param">	<span class="n">precision</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">Precision</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">use_extra_logit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">float32_logits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">causal_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">query_chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1024</span>,</span><span class="param">	<span class="n">key_chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2048</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="dot_product_attention_queries_per_head-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#dot_product_attention_queries_per_head"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="dot_product_attention_queries_per_head-274"><a href="#dot_product_attention_queries_per_head-274"><span class="linenos">274</span></a><span class="k">def</span> <span class="nf">dot_product_attention_queries_per_head</span><span class="p">(</span>
</span><span id="dot_product_attention_queries_per_head-275"><a href="#dot_product_attention_queries_per_head-275"><span class="linenos">275</span></a>        <span class="n">query</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-276"><a href="#dot_product_attention_queries_per_head-276"><span class="linenos">276</span></a>        <span class="n">key</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-277"><a href="#dot_product_attention_queries_per_head-277"><span class="linenos">277</span></a>        <span class="n">value</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-278"><a href="#dot_product_attention_queries_per_head-278"><span class="linenos">278</span></a>        <span class="n">bias</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-279"><a href="#dot_product_attention_queries_per_head-279"><span class="linenos">279</span></a>        <span class="n">broadcast_dropout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-280"><a href="#dot_product_attention_queries_per_head-280"><span class="linenos">280</span></a>        <span class="n">rescale_logits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-281"><a href="#dot_product_attention_queries_per_head-281"><span class="linenos">281</span></a>        <span class="n">dropout_rng</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PRNGKey</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-282"><a href="#dot_product_attention_queries_per_head-282"><span class="linenos">282</span></a>        <span class="n">dropout_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-283"><a href="#dot_product_attention_queries_per_head-283"><span class="linenos">283</span></a>        <span class="n">enable_dropout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-284"><a href="#dot_product_attention_queries_per_head-284"><span class="linenos">284</span></a>        <span class="n">dtype</span><span class="p">:</span> <span class="n">DType</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-285"><a href="#dot_product_attention_queries_per_head-285"><span class="linenos">285</span></a>        <span class="n">precision</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lax</span><span class="o">.</span><span class="n">Precision</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-286"><a href="#dot_product_attention_queries_per_head-286"><span class="linenos">286</span></a>        <span class="n">use_extra_logit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-287"><a href="#dot_product_attention_queries_per_head-287"><span class="linenos">287</span></a>        <span class="n">float32_logits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-288"><a href="#dot_product_attention_queries_per_head-288"><span class="linenos">288</span></a>        <span class="n">causal_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-289"><a href="#dot_product_attention_queries_per_head-289"><span class="linenos">289</span></a>        <span class="n">query_chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-290"><a href="#dot_product_attention_queries_per_head-290"><span class="linenos">290</span></a>        <span class="n">key_chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2048</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-291"><a href="#dot_product_attention_queries_per_head-291"><span class="linenos">291</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="dot_product_attention_queries_per_head-292"><a href="#dot_product_attention_queries_per_head-292"><span class="linenos">292</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes dot-product attention given query, key, and value.</span>
</span><span id="dot_product_attention_queries_per_head-293"><a href="#dot_product_attention_queries_per_head-293"><span class="linenos">293</span></a>
</span><span id="dot_product_attention_queries_per_head-294"><a href="#dot_product_attention_queries_per_head-294"><span class="linenos">294</span></a><span class="sd">    This is a variant of attention that generalizes both multi-head and</span>
</span><span id="dot_product_attention_queries_per_head-295"><a href="#dot_product_attention_queries_per_head-295"><span class="linenos">295</span></a><span class="sd">    multi-query attention. It features an extra dimension for the query array,</span>
</span><span id="dot_product_attention_queries_per_head-296"><a href="#dot_product_attention_queries_per_head-296"><span class="linenos">296</span></a><span class="sd">    that specifies the number of queries per head.</span>
</span><span id="dot_product_attention_queries_per_head-297"><a href="#dot_product_attention_queries_per_head-297"><span class="linenos">297</span></a>
</span><span id="dot_product_attention_queries_per_head-298"><a href="#dot_product_attention_queries_per_head-298"><span class="linenos">298</span></a><span class="sd">    This function is improved by the memory-efficient attention algorithm</span>
</span><span id="dot_product_attention_queries_per_head-299"><a href="#dot_product_attention_queries_per_head-299"><span class="linenos">299</span></a><span class="sd">    (https://arxiv.org/abs/2112.05682), which is also called FlashAttention</span>
</span><span id="dot_product_attention_queries_per_head-300"><a href="#dot_product_attention_queries_per_head-300"><span class="linenos">300</span></a><span class="sd">    (https://arxiv.org/abs/2205.14135).</span>
</span><span id="dot_product_attention_queries_per_head-301"><a href="#dot_product_attention_queries_per_head-301"><span class="linenos">301</span></a>
</span><span id="dot_product_attention_queries_per_head-302"><a href="#dot_product_attention_queries_per_head-302"><span class="linenos">302</span></a><span class="sd">    Note: query, key, value needn&#39;t have any batch dimensions.</span>
</span><span id="dot_product_attention_queries_per_head-303"><a href="#dot_product_attention_queries_per_head-303"><span class="linenos">303</span></a>
</span><span id="dot_product_attention_queries_per_head-304"><a href="#dot_product_attention_queries_per_head-304"><span class="linenos">304</span></a><span class="sd">    Args:</span>
</span><span id="dot_product_attention_queries_per_head-305"><a href="#dot_product_attention_queries_per_head-305"><span class="linenos">305</span></a><span class="sd">        query: queries for calculating attention with shape of `[batch..., q_length,</span>
</span><span id="dot_product_attention_queries_per_head-306"><a href="#dot_product_attention_queries_per_head-306"><span class="linenos">306</span></a><span class="sd">            num_heads, queries_per_head, qk_depth_per_head]`.</span>
</span><span id="dot_product_attention_queries_per_head-307"><a href="#dot_product_attention_queries_per_head-307"><span class="linenos">307</span></a><span class="sd">        key: keys for calculating attention with shape of `[batch..., kv_length,</span>
</span><span id="dot_product_attention_queries_per_head-308"><a href="#dot_product_attention_queries_per_head-308"><span class="linenos">308</span></a><span class="sd">            num_heads, qk_depth_per_head]`.</span>
</span><span id="dot_product_attention_queries_per_head-309"><a href="#dot_product_attention_queries_per_head-309"><span class="linenos">309</span></a><span class="sd">        value: values to be used in attention with shape of `[batch..., kv_length,</span>
</span><span id="dot_product_attention_queries_per_head-310"><a href="#dot_product_attention_queries_per_head-310"><span class="linenos">310</span></a><span class="sd">            num_heads, v_depth_per_head]`.</span>
</span><span id="dot_product_attention_queries_per_head-311"><a href="#dot_product_attention_queries_per_head-311"><span class="linenos">311</span></a><span class="sd">        bias: bias for the attention weights. This should be broadcastable to the</span>
</span><span id="dot_product_attention_queries_per_head-312"><a href="#dot_product_attention_queries_per_head-312"><span class="linenos">312</span></a><span class="sd">            shape `[batch..., num_heads, queries_per_head, q_length, kv_length]` This</span>
</span><span id="dot_product_attention_queries_per_head-313"><a href="#dot_product_attention_queries_per_head-313"><span class="linenos">313</span></a><span class="sd">            can be used for incorporating causal masks, padding masks, proximity bias,</span>
</span><span id="dot_product_attention_queries_per_head-314"><a href="#dot_product_attention_queries_per_head-314"><span class="linenos">314</span></a><span class="sd">            etc.</span>
</span><span id="dot_product_attention_queries_per_head-315"><a href="#dot_product_attention_queries_per_head-315"><span class="linenos">315</span></a><span class="sd">        broadcast_dropout: bool: use a broadcasted dropout along batch dims.</span>
</span><span id="dot_product_attention_queries_per_head-316"><a href="#dot_product_attention_queries_per_head-316"><span class="linenos">316</span></a><span class="sd">        rescale_logits: bool. Whether to rescale `query` logits by 1/sqrt(depth_kq).</span>
</span><span id="dot_product_attention_queries_per_head-317"><a href="#dot_product_attention_queries_per_head-317"><span class="linenos">317</span></a><span class="sd">        dropout_rng: JAX PRNGKey: to be used for dropout</span>
</span><span id="dot_product_attention_queries_per_head-318"><a href="#dot_product_attention_queries_per_head-318"><span class="linenos">318</span></a><span class="sd">        dropout_rate: dropout rate</span>
</span><span id="dot_product_attention_queries_per_head-319"><a href="#dot_product_attention_queries_per_head-319"><span class="linenos">319</span></a><span class="sd">        enable_dropout: bool, whether to apply dropout</span>
</span><span id="dot_product_attention_queries_per_head-320"><a href="#dot_product_attention_queries_per_head-320"><span class="linenos">320</span></a><span class="sd">        dtype: the dtype of the computation (default: float32)</span>
</span><span id="dot_product_attention_queries_per_head-321"><a href="#dot_product_attention_queries_per_head-321"><span class="linenos">321</span></a><span class="sd">        precision: numerical precision of the computation see `jax.lax.Precision`</span>
</span><span id="dot_product_attention_queries_per_head-322"><a href="#dot_product_attention_queries_per_head-322"><span class="linenos">322</span></a><span class="sd">            for details.</span>
</span><span id="dot_product_attention_queries_per_head-323"><a href="#dot_product_attention_queries_per_head-323"><span class="linenos">323</span></a><span class="sd">        use_extra_logit: whether to include a virtual extra logit equal to zero.</span>
</span><span id="dot_product_attention_queries_per_head-324"><a href="#dot_product_attention_queries_per_head-324"><span class="linenos">324</span></a><span class="sd">        float32_logits: bool, if True then compute logits in float32 to avoid</span>
</span><span id="dot_product_attention_queries_per_head-325"><a href="#dot_product_attention_queries_per_head-325"><span class="linenos">325</span></a><span class="sd">            numerical issues with bfloat16.</span>
</span><span id="dot_product_attention_queries_per_head-326"><a href="#dot_product_attention_queries_per_head-326"><span class="linenos">326</span></a><span class="sd">        causal_mask: Apply a causal mask. This can be used alternatively or in</span>
</span><span id="dot_product_attention_queries_per_head-327"><a href="#dot_product_attention_queries_per_head-327"><span class="linenos">327</span></a><span class="sd">            addition to the given bias.</span>
</span><span id="dot_product_attention_queries_per_head-328"><a href="#dot_product_attention_queries_per_head-328"><span class="linenos">328</span></a><span class="sd">        query_chunk_size: Positive integer to control the size of the query chunks.</span>
</span><span id="dot_product_attention_queries_per_head-329"><a href="#dot_product_attention_queries_per_head-329"><span class="linenos">329</span></a><span class="sd">        key_chunk_size: Positive integer to control the size of the key chunks.</span>
</span><span id="dot_product_attention_queries_per_head-330"><a href="#dot_product_attention_queries_per_head-330"><span class="linenos">330</span></a>
</span><span id="dot_product_attention_queries_per_head-331"><a href="#dot_product_attention_queries_per_head-331"><span class="linenos">331</span></a><span class="sd">    Returns:</span>
</span><span id="dot_product_attention_queries_per_head-332"><a href="#dot_product_attention_queries_per_head-332"><span class="linenos">332</span></a><span class="sd">        Output of shape `[batch..., length, num_heads, queries_per_head,</span>
</span><span id="dot_product_attention_queries_per_head-333"><a href="#dot_product_attention_queries_per_head-333"><span class="linenos">333</span></a><span class="sd">        v_depth_per_head]`.</span>
</span><span id="dot_product_attention_queries_per_head-334"><a href="#dot_product_attention_queries_per_head-334"><span class="linenos">334</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="dot_product_attention_queries_per_head-335"><a href="#dot_product_attention_queries_per_head-335"><span class="linenos">335</span></a>    <span class="k">assert</span> <span class="p">(</span>
</span><span id="dot_product_attention_queries_per_head-336"><a href="#dot_product_attention_queries_per_head-336"><span class="linenos">336</span></a>            <span class="n">key</span><span class="o">.</span><span class="n">ndim</span> <span class="o">==</span> <span class="n">value</span><span class="o">.</span><span class="n">ndim</span>
</span><span id="dot_product_attention_queries_per_head-337"><a href="#dot_product_attention_queries_per_head-337"><span class="linenos">337</span></a>    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;k, v must have same rank. key: </span><span class="si">{</span><span class="n">key</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">, value: </span><span class="si">{</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="dot_product_attention_queries_per_head-338"><a href="#dot_product_attention_queries_per_head-338"><span class="linenos">338</span></a>    <span class="k">assert</span> <span class="p">(</span>
</span><span id="dot_product_attention_queries_per_head-339"><a href="#dot_product_attention_queries_per_head-339"><span class="linenos">339</span></a>            <span class="n">query</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">==</span> <span class="n">key</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
</span><span id="dot_product_attention_queries_per_head-340"><a href="#dot_product_attention_queries_per_head-340"><span class="linenos">340</span></a>    <span class="p">),</span> <span class="sa">f</span><span class="s1">&#39;q, k, v batch dim must match. query: </span><span class="si">{</span><span class="n">query</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1">&#39;</span>
</span><span id="dot_product_attention_queries_per_head-341"><a href="#dot_product_attention_queries_per_head-341"><span class="linenos">341</span></a>
</span><span id="dot_product_attention_queries_per_head-342"><a href="#dot_product_attention_queries_per_head-342"><span class="linenos">342</span></a>    <span class="k">assert</span> <span class="n">key</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;k, v lengths must match.&#39;</span>
</span><span id="dot_product_attention_queries_per_head-343"><a href="#dot_product_attention_queries_per_head-343"><span class="linenos">343</span></a>    <span class="k">assert</span> <span class="n">query</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="n">key</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="s1">&#39;q, k depths must match.&#39;</span>
</span><span id="dot_product_attention_queries_per_head-344"><a href="#dot_product_attention_queries_per_head-344"><span class="linenos">344</span></a>
</span><span id="dot_product_attention_queries_per_head-345"><a href="#dot_product_attention_queries_per_head-345"><span class="linenos">345</span></a>    <span class="c1"># Ensure that we have exactly one batch dimension</span>
</span><span id="dot_product_attention_queries_per_head-346"><a href="#dot_product_attention_queries_per_head-346"><span class="linenos">346</span></a>    <span class="n">orig_batch_dims</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span>
</span><span id="dot_product_attention_queries_per_head-347"><a href="#dot_product_attention_queries_per_head-347"><span class="linenos">347</span></a>    <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">query</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span>
</span><span id="dot_product_attention_queries_per_head-348"><a href="#dot_product_attention_queries_per_head-348"><span class="linenos">348</span></a>    <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">key</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:])</span>
</span><span id="dot_product_attention_queries_per_head-349"><a href="#dot_product_attention_queries_per_head-349"><span class="linenos">349</span></a>    <span class="n">value</span> <span class="o">=</span> <span class="n">value</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">value</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:])</span>
</span><span id="dot_product_attention_queries_per_head-350"><a href="#dot_product_attention_queries_per_head-350"><span class="linenos">350</span></a>    <span class="k">if</span> <span class="n">bias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="dot_product_attention_queries_per_head-351"><a href="#dot_product_attention_queries_per_head-351"><span class="linenos">351</span></a>        <span class="n">bias</span> <span class="o">=</span> <span class="n">bias</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">bias</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">4</span><span class="p">:])</span>
</span><span id="dot_product_attention_queries_per_head-352"><a href="#dot_product_attention_queries_per_head-352"><span class="linenos">352</span></a>
</span><span id="dot_product_attention_queries_per_head-353"><a href="#dot_product_attention_queries_per_head-353"><span class="linenos">353</span></a>    <span class="n">batch_size</span><span class="p">,</span> <span class="n">query_length</span><span class="p">,</span> <span class="n">heads</span><span class="p">,</span> <span class="n">queries_per_head</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">shape</span>
</span><span id="dot_product_attention_queries_per_head-354"><a href="#dot_product_attention_queries_per_head-354"><span class="linenos">354</span></a>    <span class="n">_</span><span class="p">,</span> <span class="n">key_length</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">shape</span>
</span><span id="dot_product_attention_queries_per_head-355"><a href="#dot_product_attention_queries_per_head-355"><span class="linenos">355</span></a>
</span><span id="dot_product_attention_queries_per_head-356"><a href="#dot_product_attention_queries_per_head-356"><span class="linenos">356</span></a>    <span class="c1"># TODO: Consider automatic padding to remove this constraint.</span>
</span><span id="dot_product_attention_queries_per_head-357"><a href="#dot_product_attention_queries_per_head-357"><span class="linenos">357</span></a>    <span class="k">if</span> <span class="n">query_length</span> <span class="o">%</span> <span class="n">query_chunk_size</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">query_length</span> <span class="o">&gt;</span> <span class="n">query_chunk_size</span><span class="p">:</span>
</span><span id="dot_product_attention_queries_per_head-358"><a href="#dot_product_attention_queries_per_head-358"><span class="linenos">358</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="dot_product_attention_queries_per_head-359"><a href="#dot_product_attention_queries_per_head-359"><span class="linenos">359</span></a>            <span class="s1">&#39;Sequence length of the query vector </span><span class="si">%d</span><span class="s1"> needs to be less &#39;</span>
</span><span id="dot_product_attention_queries_per_head-360"><a href="#dot_product_attention_queries_per_head-360"><span class="linenos">360</span></a>            <span class="s1">&#39;than, or a multiple of the query_chunk_size </span><span class="si">%d</span><span class="s1">.&#39;</span>
</span><span id="dot_product_attention_queries_per_head-361"><a href="#dot_product_attention_queries_per_head-361"><span class="linenos">361</span></a>            <span class="o">%</span> <span class="p">(</span><span class="n">query_length</span><span class="p">,</span> <span class="n">query_chunk_size</span><span class="p">)</span>
</span><span id="dot_product_attention_queries_per_head-362"><a href="#dot_product_attention_queries_per_head-362"><span class="linenos">362</span></a>        <span class="p">)</span>
</span><span id="dot_product_attention_queries_per_head-363"><a href="#dot_product_attention_queries_per_head-363"><span class="linenos">363</span></a>    <span class="k">if</span> <span class="n">key_length</span> <span class="o">%</span> <span class="n">key_chunk_size</span> <span class="o">!=</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">key_length</span> <span class="o">&gt;</span> <span class="n">key_chunk_size</span><span class="p">:</span>
</span><span id="dot_product_attention_queries_per_head-364"><a href="#dot_product_attention_queries_per_head-364"><span class="linenos">364</span></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="dot_product_attention_queries_per_head-365"><a href="#dot_product_attention_queries_per_head-365"><span class="linenos">365</span></a>            <span class="s1">&#39;Sequence length of the key/value vector </span><span class="si">%d</span><span class="s1"> needs to be less &#39;</span>
</span><span id="dot_product_attention_queries_per_head-366"><a href="#dot_product_attention_queries_per_head-366"><span class="linenos">366</span></a>            <span class="s1">&#39;than, or a multiple of the key_chunk_size </span><span class="si">%d</span><span class="s1">.&#39;</span>
</span><span id="dot_product_attention_queries_per_head-367"><a href="#dot_product_attention_queries_per_head-367"><span class="linenos">367</span></a>            <span class="o">%</span> <span class="p">(</span><span class="n">key_length</span><span class="p">,</span> <span class="n">key_chunk_size</span><span class="p">)</span>
</span><span id="dot_product_attention_queries_per_head-368"><a href="#dot_product_attention_queries_per_head-368"><span class="linenos">368</span></a>        <span class="p">)</span>
</span><span id="dot_product_attention_queries_per_head-369"><a href="#dot_product_attention_queries_per_head-369"><span class="linenos">369</span></a>
</span><span id="dot_product_attention_queries_per_head-370"><a href="#dot_product_attention_queries_per_head-370"><span class="linenos">370</span></a>    <span class="n">query_chunk_size</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">query_chunk_size</span><span class="p">,</span> <span class="n">query_length</span><span class="p">)</span>
</span><span id="dot_product_attention_queries_per_head-371"><a href="#dot_product_attention_queries_per_head-371"><span class="linenos">371</span></a>    <span class="n">key_chunk_size</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">key_chunk_size</span><span class="p">,</span> <span class="n">key_length</span><span class="p">)</span>
</span><span id="dot_product_attention_queries_per_head-372"><a href="#dot_product_attention_queries_per_head-372"><span class="linenos">372</span></a>
</span><span id="dot_product_attention_queries_per_head-373"><a href="#dot_product_attention_queries_per_head-373"><span class="linenos">373</span></a>    <span class="k">if</span> <span class="n">bias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="dot_product_attention_queries_per_head-374"><a href="#dot_product_attention_queries_per_head-374"><span class="linenos">374</span></a>        <span class="n">broadcastable_to</span> <span class="o">=</span> <span class="p">(</span>
</span><span id="dot_product_attention_queries_per_head-375"><a href="#dot_product_attention_queries_per_head-375"><span class="linenos">375</span></a>            <span class="n">batch_size</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-376"><a href="#dot_product_attention_queries_per_head-376"><span class="linenos">376</span></a>            <span class="n">heads</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-377"><a href="#dot_product_attention_queries_per_head-377"><span class="linenos">377</span></a>            <span class="n">queries_per_head</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-378"><a href="#dot_product_attention_queries_per_head-378"><span class="linenos">378</span></a>            <span class="n">query_length</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-379"><a href="#dot_product_attention_queries_per_head-379"><span class="linenos">379</span></a>            <span class="n">key_length</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-380"><a href="#dot_product_attention_queries_per_head-380"><span class="linenos">380</span></a>        <span class="p">)</span>
</span><span id="dot_product_attention_queries_per_head-381"><a href="#dot_product_attention_queries_per_head-381"><span class="linenos">381</span></a>        <span class="c1"># Check that bias is broadcastable as expected:</span>
</span><span id="dot_product_attention_queries_per_head-382"><a href="#dot_product_attention_queries_per_head-382"><span class="linenos">382</span></a>        <span class="k">for</span> <span class="n">bias_dim</span><span class="p">,</span> <span class="n">broadcast_dim</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">bias</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">broadcastable_to</span><span class="p">):</span>
</span><span id="dot_product_attention_queries_per_head-383"><a href="#dot_product_attention_queries_per_head-383"><span class="linenos">383</span></a>            <span class="k">if</span> <span class="n">bias_dim</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="n">broadcast_dim</span><span class="p">]:</span>
</span><span id="dot_product_attention_queries_per_head-384"><a href="#dot_product_attention_queries_per_head-384"><span class="linenos">384</span></a>                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
</span><span id="dot_product_attention_queries_per_head-385"><a href="#dot_product_attention_queries_per_head-385"><span class="linenos">385</span></a>                    <span class="sa">f</span><span class="s1">&#39;Expected bias dimensions </span><span class="si">{</span><span class="n">bias</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1"> to be broadcastable to&#39;</span>
</span><span id="dot_product_attention_queries_per_head-386"><a href="#dot_product_attention_queries_per_head-386"><span class="linenos">386</span></a>                    <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">broadcastable_to</span><span class="si">}</span><span class="s1">.&#39;</span>
</span><span id="dot_product_attention_queries_per_head-387"><a href="#dot_product_attention_queries_per_head-387"><span class="linenos">387</span></a>                <span class="p">)</span>
</span><span id="dot_product_attention_queries_per_head-388"><a href="#dot_product_attention_queries_per_head-388"><span class="linenos">388</span></a>
</span><span id="dot_product_attention_queries_per_head-389"><a href="#dot_product_attention_queries_per_head-389"><span class="linenos">389</span></a>    <span class="k">if</span> <span class="n">enable_dropout</span> <span class="ow">and</span> <span class="n">dropout_rate</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="dot_product_attention_queries_per_head-390"><a href="#dot_product_attention_queries_per_head-390"><span class="linenos">390</span></a>        <span class="c1"># Precompute dropout</span>
</span><span id="dot_product_attention_queries_per_head-391"><a href="#dot_product_attention_queries_per_head-391"><span class="linenos">391</span></a>        <span class="n">drop_shape</span> <span class="o">=</span> <span class="p">[</span><span class="n">batch_size</span><span class="p">,</span> <span class="n">heads</span><span class="p">,</span> <span class="n">queries_per_head</span><span class="p">,</span> <span class="n">query_length</span><span class="p">,</span> <span class="n">key_length</span><span class="p">]</span>
</span><span id="dot_product_attention_queries_per_head-392"><a href="#dot_product_attention_queries_per_head-392"><span class="linenos">392</span></a>        <span class="k">if</span> <span class="n">broadcast_dropout</span><span class="p">:</span>
</span><span id="dot_product_attention_queries_per_head-393"><a href="#dot_product_attention_queries_per_head-393"><span class="linenos">393</span></a>            <span class="c1"># We mimick the semantics of T5 and broadcast along the &quot;length&quot; dim.</span>
</span><span id="dot_product_attention_queries_per_head-394"><a href="#dot_product_attention_queries_per_head-394"><span class="linenos">394</span></a>            <span class="n">drop_shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># query_length dim</span>
</span><span id="dot_product_attention_queries_per_head-395"><a href="#dot_product_attention_queries_per_head-395"><span class="linenos">395</span></a>        <span class="n">precomputed_dropout</span> <span class="o">=</span> <span class="n">random</span><span class="o">.</span><span class="n">bernoulli</span><span class="p">(</span>
</span><span id="dot_product_attention_queries_per_head-396"><a href="#dot_product_attention_queries_per_head-396"><span class="linenos">396</span></a>            <span class="n">dropout_rng</span><span class="p">,</span> <span class="n">dropout_rate</span><span class="p">,</span> <span class="n">drop_shape</span>
</span><span id="dot_product_attention_queries_per_head-397"><a href="#dot_product_attention_queries_per_head-397"><span class="linenos">397</span></a>        <span class="p">)</span>
</span><span id="dot_product_attention_queries_per_head-398"><a href="#dot_product_attention_queries_per_head-398"><span class="linenos">398</span></a>
</span><span id="dot_product_attention_queries_per_head-399"><a href="#dot_product_attention_queries_per_head-399"><span class="linenos">399</span></a>    <span class="k">def</span> <span class="nf">bias_fn</span><span class="p">(</span>
</span><span id="dot_product_attention_queries_per_head-400"><a href="#dot_product_attention_queries_per_head-400"><span class="linenos">400</span></a>            <span class="n">query_chunk_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-401"><a href="#dot_product_attention_queries_per_head-401"><span class="linenos">401</span></a>            <span class="n">key_chunk_idx</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-402"><a href="#dot_product_attention_queries_per_head-402"><span class="linenos">402</span></a>    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="dot_product_attention_queries_per_head-403"><a href="#dot_product_attention_queries_per_head-403"><span class="linenos">403</span></a>        <span class="n">query_offset</span> <span class="o">=</span> <span class="n">query_chunk_idx</span> <span class="o">*</span> <span class="n">query_chunk_size</span>
</span><span id="dot_product_attention_queries_per_head-404"><a href="#dot_product_attention_queries_per_head-404"><span class="linenos">404</span></a>        <span class="n">key_offset</span> <span class="o">=</span> <span class="n">key_chunk_idx</span> <span class="o">*</span> <span class="n">key_chunk_size</span>
</span><span id="dot_product_attention_queries_per_head-405"><a href="#dot_product_attention_queries_per_head-405"><span class="linenos">405</span></a>
</span><span id="dot_product_attention_queries_per_head-406"><a href="#dot_product_attention_queries_per_head-406"><span class="linenos">406</span></a>        <span class="n">local_bias</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
</span><span id="dot_product_attention_queries_per_head-407"><a href="#dot_product_attention_queries_per_head-407"><span class="linenos">407</span></a>        <span class="k">if</span> <span class="n">bias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="dot_product_attention_queries_per_head-408"><a href="#dot_product_attention_queries_per_head-408"><span class="linenos">408</span></a>            <span class="c1"># If bias is not broadcasted yet, dynamic slice would fail with full slice</span>
</span><span id="dot_product_attention_queries_per_head-409"><a href="#dot_product_attention_queries_per_head-409"><span class="linenos">409</span></a>            <span class="c1"># size. In this case we keep the bias unbroadcasted.</span>
</span><span id="dot_product_attention_queries_per_head-410"><a href="#dot_product_attention_queries_per_head-410"><span class="linenos">410</span></a>            <span class="n">slice_q_len</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">bias</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">query_chunk_size</span><span class="p">)</span>
</span><span id="dot_product_attention_queries_per_head-411"><a href="#dot_product_attention_queries_per_head-411"><span class="linenos">411</span></a>            <span class="n">slice_k_len</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">bias</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">key_chunk_size</span><span class="p">)</span>
</span><span id="dot_product_attention_queries_per_head-412"><a href="#dot_product_attention_queries_per_head-412"><span class="linenos">412</span></a>            <span class="n">local_bias</span> <span class="o">=</span> <span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span>
</span><span id="dot_product_attention_queries_per_head-413"><a href="#dot_product_attention_queries_per_head-413"><span class="linenos">413</span></a>                <span class="n">bias</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-414"><a href="#dot_product_attention_queries_per_head-414"><span class="linenos">414</span></a>                <span class="c1"># query_offset and key_offset might be &gt; 1 but bias dims might</span>
</span><span id="dot_product_attention_queries_per_head-415"><a href="#dot_product_attention_queries_per_head-415"><span class="linenos">415</span></a>                <span class="c1"># not yet be broadcasted. We rely on the protection against</span>
</span><span id="dot_product_attention_queries_per_head-416"><a href="#dot_product_attention_queries_per_head-416"><span class="linenos">416</span></a>                <span class="c1"># out-of-bounds array accesses built into dynamic_slice.</span>
</span><span id="dot_product_attention_queries_per_head-417"><a href="#dot_product_attention_queries_per_head-417"><span class="linenos">417</span></a>                <span class="n">start_indices</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">query_offset</span><span class="p">,</span> <span class="n">key_offset</span><span class="p">),</span>
</span><span id="dot_product_attention_queries_per_head-418"><a href="#dot_product_attention_queries_per_head-418"><span class="linenos">418</span></a>                <span class="n">slice_sizes</span><span class="o">=</span><span class="p">(</span><span class="o">*</span><span class="n">bias</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span> <span class="n">slice_q_len</span><span class="p">,</span> <span class="n">slice_k_len</span><span class="p">),</span>
</span><span id="dot_product_attention_queries_per_head-419"><a href="#dot_product_attention_queries_per_head-419"><span class="linenos">419</span></a>            <span class="p">)</span>
</span><span id="dot_product_attention_queries_per_head-420"><a href="#dot_product_attention_queries_per_head-420"><span class="linenos">420</span></a>        <span class="k">if</span> <span class="n">causal_mask</span><span class="p">:</span>
</span><span id="dot_product_attention_queries_per_head-421"><a href="#dot_product_attention_queries_per_head-421"><span class="linenos">421</span></a>            <span class="n">causal</span> <span class="o">=</span> <span class="n">_local_causal_bias</span><span class="p">(</span>
</span><span id="dot_product_attention_queries_per_head-422"><a href="#dot_product_attention_queries_per_head-422"><span class="linenos">422</span></a>                <span class="n">query_chunk_size</span><span class="p">,</span> <span class="n">key_chunk_size</span><span class="p">,</span> <span class="n">query_offset</span><span class="p">,</span> <span class="n">key_offset</span>
</span><span id="dot_product_attention_queries_per_head-423"><a href="#dot_product_attention_queries_per_head-423"><span class="linenos">423</span></a>            <span class="p">)</span>
</span><span id="dot_product_attention_queries_per_head-424"><a href="#dot_product_attention_queries_per_head-424"><span class="linenos">424</span></a>            <span class="c1"># add batch, head, and queries_per_head dims</span>
</span><span id="dot_product_attention_queries_per_head-425"><a href="#dot_product_attention_queries_per_head-425"><span class="linenos">425</span></a>            <span class="n">local_bias</span> <span class="o">+=</span> <span class="n">causal</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="o">*</span><span class="n">causal</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
</span><span id="dot_product_attention_queries_per_head-426"><a href="#dot_product_attention_queries_per_head-426"><span class="linenos">426</span></a>        <span class="c1"># We implement dropout as part of the bias, which is additive to the</span>
</span><span id="dot_product_attention_queries_per_head-427"><a href="#dot_product_attention_queries_per_head-427"><span class="linenos">427</span></a>        <span class="c1"># attention scores. In some other implementations it is treated as a</span>
</span><span id="dot_product_attention_queries_per_head-428"><a href="#dot_product_attention_queries_per_head-428"><span class="linenos">428</span></a>        <span class="c1"># multiplicative factor applied to the probabilities after softmax.</span>
</span><span id="dot_product_attention_queries_per_head-429"><a href="#dot_product_attention_queries_per_head-429"><span class="linenos">429</span></a>        <span class="k">if</span> <span class="n">enable_dropout</span> <span class="ow">and</span> <span class="n">dropout_rate</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">:</span>
</span><span id="dot_product_attention_queries_per_head-430"><a href="#dot_product_attention_queries_per_head-430"><span class="linenos">430</span></a>            <span class="k">with</span> <span class="n">jax</span><span class="o">.</span><span class="n">named_scope</span><span class="p">(</span><span class="s1">&#39;dropout&#39;</span><span class="p">):</span>
</span><span id="dot_product_attention_queries_per_head-431"><a href="#dot_product_attention_queries_per_head-431"><span class="linenos">431</span></a>                <span class="c1"># If dropout is not broadcasted yet, we need the collapsed dims.</span>
</span><span id="dot_product_attention_queries_per_head-432"><a href="#dot_product_attention_queries_per_head-432"><span class="linenos">432</span></a>                <span class="n">slice_q_len</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">precomputed_dropout</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span> <span class="n">query_chunk_size</span><span class="p">)</span>
</span><span id="dot_product_attention_queries_per_head-433"><a href="#dot_product_attention_queries_per_head-433"><span class="linenos">433</span></a>                <span class="n">slice_k_len</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">precomputed_dropout</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">key_chunk_size</span><span class="p">)</span>
</span><span id="dot_product_attention_queries_per_head-434"><a href="#dot_product_attention_queries_per_head-434"><span class="linenos">434</span></a>                <span class="n">dropout_slice</span> <span class="o">=</span> <span class="n">lax</span><span class="o">.</span><span class="n">dynamic_slice</span><span class="p">(</span>
</span><span id="dot_product_attention_queries_per_head-435"><a href="#dot_product_attention_queries_per_head-435"><span class="linenos">435</span></a>                    <span class="n">precomputed_dropout</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-436"><a href="#dot_product_attention_queries_per_head-436"><span class="linenos">436</span></a>                    <span class="c1"># query_offset and key_offset might be &gt; 1 but dropout dims might</span>
</span><span id="dot_product_attention_queries_per_head-437"><a href="#dot_product_attention_queries_per_head-437"><span class="linenos">437</span></a>                    <span class="c1"># not yet be broadcasted. We rely on the protection against</span>
</span><span id="dot_product_attention_queries_per_head-438"><a href="#dot_product_attention_queries_per_head-438"><span class="linenos">438</span></a>                    <span class="c1"># out-of-bounds array accesses built into dynamic_slice.</span>
</span><span id="dot_product_attention_queries_per_head-439"><a href="#dot_product_attention_queries_per_head-439"><span class="linenos">439</span></a>                    <span class="n">start_indices</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">query_offset</span><span class="p">,</span> <span class="n">key_offset</span><span class="p">),</span>
</span><span id="dot_product_attention_queries_per_head-440"><a href="#dot_product_attention_queries_per_head-440"><span class="linenos">440</span></a>                    <span class="n">slice_sizes</span><span class="o">=</span><span class="p">(</span>
</span><span id="dot_product_attention_queries_per_head-441"><a href="#dot_product_attention_queries_per_head-441"><span class="linenos">441</span></a>                        <span class="o">*</span><span class="n">precomputed_dropout</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="mi">3</span><span class="p">],</span>
</span><span id="dot_product_attention_queries_per_head-442"><a href="#dot_product_attention_queries_per_head-442"><span class="linenos">442</span></a>                        <span class="n">slice_q_len</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-443"><a href="#dot_product_attention_queries_per_head-443"><span class="linenos">443</span></a>                        <span class="n">slice_k_len</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-444"><a href="#dot_product_attention_queries_per_head-444"><span class="linenos">444</span></a>                    <span class="p">),</span>
</span><span id="dot_product_attention_queries_per_head-445"><a href="#dot_product_attention_queries_per_head-445"><span class="linenos">445</span></a>                <span class="p">)</span>
</span><span id="dot_product_attention_queries_per_head-446"><a href="#dot_product_attention_queries_per_head-446"><span class="linenos">446</span></a>                <span class="n">local_bias</span> <span class="o">-=</span> <span class="n">dropout_slice</span> <span class="o">*</span> <span class="mf">1e6</span>
</span><span id="dot_product_attention_queries_per_head-447"><a href="#dot_product_attention_queries_per_head-447"><span class="linenos">447</span></a>        <span class="k">return</span> <span class="n">local_bias</span>
</span><span id="dot_product_attention_queries_per_head-448"><a href="#dot_product_attention_queries_per_head-448"><span class="linenos">448</span></a>
</span><span id="dot_product_attention_queries_per_head-449"><a href="#dot_product_attention_queries_per_head-449"><span class="linenos">449</span></a>    <span class="c1"># NOTE: T5 does not explicitly rescale the attention logits by</span>
</span><span id="dot_product_attention_queries_per_head-450"><a href="#dot_product_attention_queries_per_head-450"><span class="linenos">450</span></a>    <span class="c1">#       1/sqrt(depth_kq)!  This is folded into the initializers of the</span>
</span><span id="dot_product_attention_queries_per_head-451"><a href="#dot_product_attention_queries_per_head-451"><span class="linenos">451</span></a>    <span class="c1">#       linear transformations, which is equivalent under Adafactor.</span>
</span><span id="dot_product_attention_queries_per_head-452"><a href="#dot_product_attention_queries_per_head-452"><span class="linenos">452</span></a>    <span class="k">if</span> <span class="n">rescale_logits</span><span class="p">:</span>
</span><span id="dot_product_attention_queries_per_head-453"><a href="#dot_product_attention_queries_per_head-453"><span class="linenos">453</span></a>        <span class="n">depth</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
</span><span id="dot_product_attention_queries_per_head-454"><a href="#dot_product_attention_queries_per_head-454"><span class="linenos">454</span></a>        <span class="n">query</span> <span class="o">=</span> <span class="n">query</span> <span class="o">/</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">depth</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">dtype</span><span class="p">)</span>
</span><span id="dot_product_attention_queries_per_head-455"><a href="#dot_product_attention_queries_per_head-455"><span class="linenos">455</span></a>
</span><span id="dot_product_attention_queries_per_head-456"><a href="#dot_product_attention_queries_per_head-456"><span class="linenos">456</span></a>    <span class="c1"># Casting logits and softmax computation for float32 for model stability.</span>
</span><span id="dot_product_attention_queries_per_head-457"><a href="#dot_product_attention_queries_per_head-457"><span class="linenos">457</span></a>    <span class="k">if</span> <span class="n">float32_logits</span><span class="p">:</span>
</span><span id="dot_product_attention_queries_per_head-458"><a href="#dot_product_attention_queries_per_head-458"><span class="linenos">458</span></a>        <span class="n">query</span> <span class="o">=</span> <span class="n">query</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="dot_product_attention_queries_per_head-459"><a href="#dot_product_attention_queries_per_head-459"><span class="linenos">459</span></a>        <span class="n">key</span> <span class="o">=</span> <span class="n">key</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">float32</span><span class="p">)</span>
</span><span id="dot_product_attention_queries_per_head-460"><a href="#dot_product_attention_queries_per_head-460"><span class="linenos">460</span></a>
</span><span id="dot_product_attention_queries_per_head-461"><a href="#dot_product_attention_queries_per_head-461"><span class="linenos">461</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">_memory_efficient_attention</span><span class="p">(</span>
</span><span id="dot_product_attention_queries_per_head-462"><a href="#dot_product_attention_queries_per_head-462"><span class="linenos">462</span></a>        <span class="n">query</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-463"><a href="#dot_product_attention_queries_per_head-463"><span class="linenos">463</span></a>        <span class="n">key</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-464"><a href="#dot_product_attention_queries_per_head-464"><span class="linenos">464</span></a>        <span class="n">value</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-465"><a href="#dot_product_attention_queries_per_head-465"><span class="linenos">465</span></a>        <span class="n">bias_fn</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-466"><a href="#dot_product_attention_queries_per_head-466"><span class="linenos">466</span></a>        <span class="n">query_chunk_size</span><span class="o">=</span><span class="n">query_chunk_size</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-467"><a href="#dot_product_attention_queries_per_head-467"><span class="linenos">467</span></a>        <span class="n">key_chunk_size</span><span class="o">=</span><span class="n">key_chunk_size</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-468"><a href="#dot_product_attention_queries_per_head-468"><span class="linenos">468</span></a>        <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-469"><a href="#dot_product_attention_queries_per_head-469"><span class="linenos">469</span></a>        <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-470"><a href="#dot_product_attention_queries_per_head-470"><span class="linenos">470</span></a>        <span class="n">use_extra_logit</span><span class="o">=</span><span class="n">use_extra_logit</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-471"><a href="#dot_product_attention_queries_per_head-471"><span class="linenos">471</span></a>        <span class="n">causal_mask</span><span class="o">=</span><span class="n">causal_mask</span><span class="p">,</span>
</span><span id="dot_product_attention_queries_per_head-472"><a href="#dot_product_attention_queries_per_head-472"><span class="linenos">472</span></a>    <span class="p">)</span>
</span><span id="dot_product_attention_queries_per_head-473"><a href="#dot_product_attention_queries_per_head-473"><span class="linenos">473</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="o">*</span><span class="n">orig_batch_dims</span><span class="p">,</span> <span class="o">*</span><span class="n">result</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span>
</span><span id="dot_product_attention_queries_per_head-474"><a href="#dot_product_attention_queries_per_head-474"><span class="linenos">474</span></a>    <span class="k">return</span> <span class="n">result</span>
</span></pre></div>


            <div class="docstring"><p>Computes dot-product attention given query, key, and value.</p>

<p>This is a variant of attention that generalizes both multi-head and
multi-query attention. It features an extra dimension for the query array,
that specifies the number of queries per head.</p>

<p>This function is improved by the memory-efficient attention algorithm
(https://arxiv.org/abs/2112.05682), which is also called FlashAttention
(https://arxiv.org/abs/2205.14135).</p>

<p>Note: query, key, value needn't have any batch dimensions.</p>

<p>Args:
    query: queries for calculating attention with shape of <code>[batch..., q_length,
        num_heads, queries_per_head, qk_depth_per_head]</code>.
    key: keys for calculating attention with shape of <code>[batch..., kv_length,
        num_heads, qk_depth_per_head]</code>.
    value: values to be used in attention with shape of <code>[batch..., kv_length,
        num_heads, v_depth_per_head]</code>.
    bias: bias for the attention weights. This should be broadcastable to the
        shape <code>[batch..., num_heads, queries_per_head, q_length, kv_length]</code> This
        can be used for incorporating causal masks, padding masks, proximity bias,
        etc.
    broadcast_dropout: bool: use a broadcasted dropout along batch dims.
    rescale_logits: bool. Whether to rescale <code>query</code> logits by 1/sqrt(depth_kq).
    dropout_rng: JAX PRNGKey: to be used for dropout
    dropout_rate: dropout rate
    enable_dropout: bool, whether to apply dropout
    dtype: the dtype of the computation (default: float32)
    precision: numerical precision of the computation see <code>jax.lax.Precision</code>
        for details.
    use_extra_logit: whether to include a virtual extra logit equal to zero.
    float32_logits: bool, if True then compute logits in float32 to avoid
        numerical issues with bfloat16.
    causal_mask: Apply a causal mask. This can be used alternatively or in
        addition to the given bias.
    query_chunk_size: Positive integer to control the size of the query chunks.
    key_chunk_size: Positive integer to control the size of the key chunks.</p>

<p>Returns:
    Output of shape <code>[batch..., length, num_heads, queries_per_head,
    v_depth_per_head]</code>.</p>
</div>


                </section>
                <section id="dot_product_attention_multiquery">
                            <input id="dot_product_attention_multiquery-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">dot_product_attention_multiquery</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">query</span><span class="p">:</span> <span class="n"><a href="#Array">Array</a></span>,</span><span class="param">	<span class="n">key</span><span class="p">:</span> <span class="n"><a href="#Array">Array</a></span>,</span><span class="param">	<span class="n">value</span><span class="p">:</span> <span class="n"><a href="#Array">Array</a></span>,</span><span class="param">	<span class="n">bias</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">broadcast_dropout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">rescale_logits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">dropout_rng</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">dropout_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>,</span><span class="param">	<span class="n">enable_dropout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	dtype: Any = &lt;class &#x27;jax.numpy.float32&#x27;&gt;,</span><span class="param">	<span class="n">precision</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">Precision</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">use_extra_logit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">float32_logits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">causal_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">query_chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1024</span>,</span><span class="param">	<span class="n">key_chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2048</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="dot_product_attention_multiquery-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#dot_product_attention_multiquery"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="dot_product_attention_multiquery-477"><a href="#dot_product_attention_multiquery-477"><span class="linenos">477</span></a><span class="k">def</span> <span class="nf">dot_product_attention_multiquery</span><span class="p">(</span>
</span><span id="dot_product_attention_multiquery-478"><a href="#dot_product_attention_multiquery-478"><span class="linenos">478</span></a>        <span class="n">query</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-479"><a href="#dot_product_attention_multiquery-479"><span class="linenos">479</span></a>        <span class="n">key</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-480"><a href="#dot_product_attention_multiquery-480"><span class="linenos">480</span></a>        <span class="n">value</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-481"><a href="#dot_product_attention_multiquery-481"><span class="linenos">481</span></a>        <span class="n">bias</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-482"><a href="#dot_product_attention_multiquery-482"><span class="linenos">482</span></a>        <span class="n">broadcast_dropout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-483"><a href="#dot_product_attention_multiquery-483"><span class="linenos">483</span></a>        <span class="n">rescale_logits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-484"><a href="#dot_product_attention_multiquery-484"><span class="linenos">484</span></a>        <span class="n">dropout_rng</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PRNGKey</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-485"><a href="#dot_product_attention_multiquery-485"><span class="linenos">485</span></a>        <span class="n">dropout_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-486"><a href="#dot_product_attention_multiquery-486"><span class="linenos">486</span></a>        <span class="n">enable_dropout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-487"><a href="#dot_product_attention_multiquery-487"><span class="linenos">487</span></a>        <span class="n">dtype</span><span class="p">:</span> <span class="n">DType</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-488"><a href="#dot_product_attention_multiquery-488"><span class="linenos">488</span></a>        <span class="n">precision</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lax</span><span class="o">.</span><span class="n">Precision</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-489"><a href="#dot_product_attention_multiquery-489"><span class="linenos">489</span></a>        <span class="n">use_extra_logit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-490"><a href="#dot_product_attention_multiquery-490"><span class="linenos">490</span></a>        <span class="n">float32_logits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-491"><a href="#dot_product_attention_multiquery-491"><span class="linenos">491</span></a>        <span class="n">causal_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-492"><a href="#dot_product_attention_multiquery-492"><span class="linenos">492</span></a>        <span class="n">query_chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-493"><a href="#dot_product_attention_multiquery-493"><span class="linenos">493</span></a>        <span class="n">key_chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2048</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-494"><a href="#dot_product_attention_multiquery-494"><span class="linenos">494</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="dot_product_attention_multiquery-495"><a href="#dot_product_attention_multiquery-495"><span class="linenos">495</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes dot-product multiquery-attention given query, key, and value.</span>
</span><span id="dot_product_attention_multiquery-496"><a href="#dot_product_attention_multiquery-496"><span class="linenos">496</span></a>
</span><span id="dot_product_attention_multiquery-497"><a href="#dot_product_attention_multiquery-497"><span class="linenos">497</span></a><span class="sd">    This is a variant of the multi-head dot product attention introduced in</span>
</span><span id="dot_product_attention_multiquery-498"><a href="#dot_product_attention_multiquery-498"><span class="linenos">498</span></a><span class="sd">    https://arxiv.org/abs/1706.03762 and implemented in `dot_product_attention`.</span>
</span><span id="dot_product_attention_multiquery-499"><a href="#dot_product_attention_multiquery-499"><span class="linenos">499</span></a><span class="sd">    In this function, the key and the value have 1 head whereas query has 1 or</span>
</span><span id="dot_product_attention_multiquery-500"><a href="#dot_product_attention_multiquery-500"><span class="linenos">500</span></a><span class="sd">    more heads. This variant is called &quot;multi-query&quot; attention.</span>
</span><span id="dot_product_attention_multiquery-501"><a href="#dot_product_attention_multiquery-501"><span class="linenos">501</span></a>
</span><span id="dot_product_attention_multiquery-502"><a href="#dot_product_attention_multiquery-502"><span class="linenos">502</span></a><span class="sd">    This implementation is equivalent to</span>
</span><span id="dot_product_attention_multiquery-503"><a href="#dot_product_attention_multiquery-503"><span class="linenos">503</span></a><span class="sd">    `dense_attention.dot_product_attention_multiquery`, but is improved by the</span>
</span><span id="dot_product_attention_multiquery-504"><a href="#dot_product_attention_multiquery-504"><span class="linenos">504</span></a><span class="sd">    memory-efficient attention algorithm (https://arxiv.org/abs/2112.05682),</span>
</span><span id="dot_product_attention_multiquery-505"><a href="#dot_product_attention_multiquery-505"><span class="linenos">505</span></a><span class="sd">    which is also called FlashAttention (https://arxiv.org/abs/2205.14135).</span>
</span><span id="dot_product_attention_multiquery-506"><a href="#dot_product_attention_multiquery-506"><span class="linenos">506</span></a>
</span><span id="dot_product_attention_multiquery-507"><a href="#dot_product_attention_multiquery-507"><span class="linenos">507</span></a><span class="sd">    Note: query, key, value needn&#39;t have any batch dimensions.</span>
</span><span id="dot_product_attention_multiquery-508"><a href="#dot_product_attention_multiquery-508"><span class="linenos">508</span></a>
</span><span id="dot_product_attention_multiquery-509"><a href="#dot_product_attention_multiquery-509"><span class="linenos">509</span></a><span class="sd">    Args:</span>
</span><span id="dot_product_attention_multiquery-510"><a href="#dot_product_attention_multiquery-510"><span class="linenos">510</span></a><span class="sd">        query: queries for calculating attention with shape of `[batch..., q_length,</span>
</span><span id="dot_product_attention_multiquery-511"><a href="#dot_product_attention_multiquery-511"><span class="linenos">511</span></a><span class="sd">            num_heads, qk_depth_per_head]`.</span>
</span><span id="dot_product_attention_multiquery-512"><a href="#dot_product_attention_multiquery-512"><span class="linenos">512</span></a><span class="sd">        key: keys for calculating attention with shape of `[batch..., kv_length,</span>
</span><span id="dot_product_attention_multiquery-513"><a href="#dot_product_attention_multiquery-513"><span class="linenos">513</span></a><span class="sd">            qk_depth_per_head]`.</span>
</span><span id="dot_product_attention_multiquery-514"><a href="#dot_product_attention_multiquery-514"><span class="linenos">514</span></a><span class="sd">        value: values to be used in attention with shape of `[batch..., kv_length,</span>
</span><span id="dot_product_attention_multiquery-515"><a href="#dot_product_attention_multiquery-515"><span class="linenos">515</span></a><span class="sd">            v_depth_per_head]`.</span>
</span><span id="dot_product_attention_multiquery-516"><a href="#dot_product_attention_multiquery-516"><span class="linenos">516</span></a><span class="sd">        bias: bias for the attention weights. This should be broadcastable to the</span>
</span><span id="dot_product_attention_multiquery-517"><a href="#dot_product_attention_multiquery-517"><span class="linenos">517</span></a><span class="sd">            shape `[batch..., num_heads, q_length, kv_length]` This can be used for</span>
</span><span id="dot_product_attention_multiquery-518"><a href="#dot_product_attention_multiquery-518"><span class="linenos">518</span></a><span class="sd">            incorporating causal masks, padding masks, proximity bias, etc.</span>
</span><span id="dot_product_attention_multiquery-519"><a href="#dot_product_attention_multiquery-519"><span class="linenos">519</span></a><span class="sd">        broadcast_dropout: bool: use a broadcasted dropout along batch dims.</span>
</span><span id="dot_product_attention_multiquery-520"><a href="#dot_product_attention_multiquery-520"><span class="linenos">520</span></a><span class="sd">        rescale_logits: bool. Whether to rescale `query` logits by 1/sqrt(depth_kq).</span>
</span><span id="dot_product_attention_multiquery-521"><a href="#dot_product_attention_multiquery-521"><span class="linenos">521</span></a><span class="sd">        dropout_rng: JAX PRNGKey: to be used for dropout</span>
</span><span id="dot_product_attention_multiquery-522"><a href="#dot_product_attention_multiquery-522"><span class="linenos">522</span></a><span class="sd">        dropout_rate: dropout rate</span>
</span><span id="dot_product_attention_multiquery-523"><a href="#dot_product_attention_multiquery-523"><span class="linenos">523</span></a><span class="sd">        enable_dropout: bool, whether to apply dropout</span>
</span><span id="dot_product_attention_multiquery-524"><a href="#dot_product_attention_multiquery-524"><span class="linenos">524</span></a><span class="sd">        dtype: the dtype of the computation (default: float32)</span>
</span><span id="dot_product_attention_multiquery-525"><a href="#dot_product_attention_multiquery-525"><span class="linenos">525</span></a><span class="sd">        precision: numerical precision of the computation see `jax.lax.Precision`</span>
</span><span id="dot_product_attention_multiquery-526"><a href="#dot_product_attention_multiquery-526"><span class="linenos">526</span></a><span class="sd">            for details.</span>
</span><span id="dot_product_attention_multiquery-527"><a href="#dot_product_attention_multiquery-527"><span class="linenos">527</span></a><span class="sd">        use_extra_logit: whether to include a virtual extra logit equal to zero.</span>
</span><span id="dot_product_attention_multiquery-528"><a href="#dot_product_attention_multiquery-528"><span class="linenos">528</span></a><span class="sd">        float32_logits: bool, if True then compute logits in float32 to avoid</span>
</span><span id="dot_product_attention_multiquery-529"><a href="#dot_product_attention_multiquery-529"><span class="linenos">529</span></a><span class="sd">            numerical issues with bfloat16.</span>
</span><span id="dot_product_attention_multiquery-530"><a href="#dot_product_attention_multiquery-530"><span class="linenos">530</span></a><span class="sd">        causal_mask: Apply a causal mask. This can be used alternatively or in</span>
</span><span id="dot_product_attention_multiquery-531"><a href="#dot_product_attention_multiquery-531"><span class="linenos">531</span></a><span class="sd">            addition to the given bias.</span>
</span><span id="dot_product_attention_multiquery-532"><a href="#dot_product_attention_multiquery-532"><span class="linenos">532</span></a><span class="sd">        query_chunk_size: Positive integer to control the size of the query chunks.</span>
</span><span id="dot_product_attention_multiquery-533"><a href="#dot_product_attention_multiquery-533"><span class="linenos">533</span></a><span class="sd">        key_chunk_size: Positive integer to control the size of the key chunks.</span>
</span><span id="dot_product_attention_multiquery-534"><a href="#dot_product_attention_multiquery-534"><span class="linenos">534</span></a>
</span><span id="dot_product_attention_multiquery-535"><a href="#dot_product_attention_multiquery-535"><span class="linenos">535</span></a><span class="sd">    Returns:</span>
</span><span id="dot_product_attention_multiquery-536"><a href="#dot_product_attention_multiquery-536"><span class="linenos">536</span></a><span class="sd">        Output of shape `[batch..., length, num_heads, v_depth_per_head]`.</span>
</span><span id="dot_product_attention_multiquery-537"><a href="#dot_product_attention_multiquery-537"><span class="linenos">537</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="dot_product_attention_multiquery-538"><a href="#dot_product_attention_multiquery-538"><span class="linenos">538</span></a>    <span class="c1"># num_heads, treat current num_heads as queries_per_head</span>
</span><span id="dot_product_attention_multiquery-539"><a href="#dot_product_attention_multiquery-539"><span class="linenos">539</span></a>    <span class="n">query</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">3</span><span class="p">)</span>
</span><span id="dot_product_attention_multiquery-540"><a href="#dot_product_attention_multiquery-540"><span class="linenos">540</span></a>    <span class="c1"># add num_heads dim</span>
</span><span id="dot_product_attention_multiquery-541"><a href="#dot_product_attention_multiquery-541"><span class="linenos">541</span></a>    <span class="n">key</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
</span><span id="dot_product_attention_multiquery-542"><a href="#dot_product_attention_multiquery-542"><span class="linenos">542</span></a>    <span class="c1"># add num_heads dim</span>
</span><span id="dot_product_attention_multiquery-543"><a href="#dot_product_attention_multiquery-543"><span class="linenos">543</span></a>    <span class="n">value</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
</span><span id="dot_product_attention_multiquery-544"><a href="#dot_product_attention_multiquery-544"><span class="linenos">544</span></a>    <span class="k">if</span> <span class="n">bias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="dot_product_attention_multiquery-545"><a href="#dot_product_attention_multiquery-545"><span class="linenos">545</span></a>        <span class="c1"># add num_heads, treat current num_heads dim as queries_per_head</span>
</span><span id="dot_product_attention_multiquery-546"><a href="#dot_product_attention_multiquery-546"><span class="linenos">546</span></a>        <span class="n">bias</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">bias</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">4</span><span class="p">)</span>
</span><span id="dot_product_attention_multiquery-547"><a href="#dot_product_attention_multiquery-547"><span class="linenos">547</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">dot_product_attention_queries_per_head</span><span class="p">(</span>
</span><span id="dot_product_attention_multiquery-548"><a href="#dot_product_attention_multiquery-548"><span class="linenos">548</span></a>        <span class="n">query</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-549"><a href="#dot_product_attention_multiquery-549"><span class="linenos">549</span></a>        <span class="n">key</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-550"><a href="#dot_product_attention_multiquery-550"><span class="linenos">550</span></a>        <span class="n">value</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-551"><a href="#dot_product_attention_multiquery-551"><span class="linenos">551</span></a>        <span class="n">bias</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-552"><a href="#dot_product_attention_multiquery-552"><span class="linenos">552</span></a>        <span class="n">broadcast_dropout</span><span class="o">=</span><span class="n">broadcast_dropout</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-553"><a href="#dot_product_attention_multiquery-553"><span class="linenos">553</span></a>        <span class="n">rescale_logits</span><span class="o">=</span><span class="n">rescale_logits</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-554"><a href="#dot_product_attention_multiquery-554"><span class="linenos">554</span></a>        <span class="n">dropout_rng</span><span class="o">=</span><span class="n">dropout_rng</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-555"><a href="#dot_product_attention_multiquery-555"><span class="linenos">555</span></a>        <span class="n">dropout_rate</span><span class="o">=</span><span class="n">dropout_rate</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-556"><a href="#dot_product_attention_multiquery-556"><span class="linenos">556</span></a>        <span class="n">enable_dropout</span><span class="o">=</span><span class="n">enable_dropout</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-557"><a href="#dot_product_attention_multiquery-557"><span class="linenos">557</span></a>        <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-558"><a href="#dot_product_attention_multiquery-558"><span class="linenos">558</span></a>        <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-559"><a href="#dot_product_attention_multiquery-559"><span class="linenos">559</span></a>        <span class="n">use_extra_logit</span><span class="o">=</span><span class="n">use_extra_logit</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-560"><a href="#dot_product_attention_multiquery-560"><span class="linenos">560</span></a>        <span class="n">float32_logits</span><span class="o">=</span><span class="n">float32_logits</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-561"><a href="#dot_product_attention_multiquery-561"><span class="linenos">561</span></a>        <span class="n">causal_mask</span><span class="o">=</span><span class="n">causal_mask</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-562"><a href="#dot_product_attention_multiquery-562"><span class="linenos">562</span></a>        <span class="n">query_chunk_size</span><span class="o">=</span><span class="n">query_chunk_size</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-563"><a href="#dot_product_attention_multiquery-563"><span class="linenos">563</span></a>        <span class="n">key_chunk_size</span><span class="o">=</span><span class="n">key_chunk_size</span><span class="p">,</span>
</span><span id="dot_product_attention_multiquery-564"><a href="#dot_product_attention_multiquery-564"><span class="linenos">564</span></a>    <span class="p">)</span>
</span><span id="dot_product_attention_multiquery-565"><a href="#dot_product_attention_multiquery-565"><span class="linenos">565</span></a>    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># remove head dim</span>
</span></pre></div>


            <div class="docstring"><p>Computes dot-product multiquery-attention given query, key, and value.</p>

<p>This is a variant of the multi-head dot product attention introduced in
<a href="https://arxiv.org/abs/1706.03762">https://arxiv.org/abs/1706.03762</a> and implemented in <code>dot_product_attention</code>.
In this function, the key and the value have 1 head whereas query has 1 or
more heads. This variant is called "multi-query" attention.</p>

<p>This implementation is equivalent to
<code>dense_attention.dot_product_attention_multiquery</code>, but is improved by the
memory-efficient attention algorithm (https://arxiv.org/abs/2112.05682),
which is also called FlashAttention (https://arxiv.org/abs/2205.14135).</p>

<p>Note: query, key, value needn't have any batch dimensions.</p>

<p>Args:
    query: queries for calculating attention with shape of <code>[batch..., q_length,
        num_heads, qk_depth_per_head]</code>.
    key: keys for calculating attention with shape of <code>[batch..., kv_length,
        qk_depth_per_head]</code>.
    value: values to be used in attention with shape of <code>[batch..., kv_length,
        v_depth_per_head]</code>.
    bias: bias for the attention weights. This should be broadcastable to the
        shape <code>[batch..., num_heads, q_length, kv_length]</code> This can be used for
        incorporating causal masks, padding masks, proximity bias, etc.
    broadcast_dropout: bool: use a broadcasted dropout along batch dims.
    rescale_logits: bool. Whether to rescale <code>query</code> logits by 1/sqrt(depth_kq).
    dropout_rng: JAX PRNGKey: to be used for dropout
    dropout_rate: dropout rate
    enable_dropout: bool, whether to apply dropout
    dtype: the dtype of the computation (default: float32)
    precision: numerical precision of the computation see <code>jax.lax.Precision</code>
        for details.
    use_extra_logit: whether to include a virtual extra logit equal to zero.
    float32_logits: bool, if True then compute logits in float32 to avoid
        numerical issues with bfloat16.
    causal_mask: Apply a causal mask. This can be used alternatively or in
        addition to the given bias.
    query_chunk_size: Positive integer to control the size of the query chunks.
    key_chunk_size: Positive integer to control the size of the key chunks.</p>

<p>Returns:
    Output of shape <code>[batch..., length, num_heads, v_depth_per_head]</code>.</p>
</div>


                </section>
                <section id="dot_product_attention_multihead">
                            <input id="dot_product_attention_multihead-view-source" class="view-source-toggle-state" type="checkbox" aria-hidden="true" tabindex="-1">
<div class="attr function">
            
        <span class="def">def</span>
        <span class="name">dot_product_attention_multihead</span><span class="signature pdoc-code multiline">(<span class="param">	<span class="n">query</span><span class="p">:</span> <span class="n"><a href="#Array">Array</a></span>,</span><span class="param">	<span class="n">key</span><span class="p">:</span> <span class="n"><a href="#Array">Array</a></span>,</span><span class="param">	<span class="n">value</span><span class="p">:</span> <span class="n"><a href="#Array">Array</a></span>,</span><span class="param">	<span class="n">bias</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n"><a href="#Array">Array</a></span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">broadcast_dropout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">rescale_logits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">dropout_rng</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Any</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">dropout_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span>,</span><span class="param">	<span class="n">enable_dropout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	dtype: Any = &lt;class &#x27;jax.numpy.float32&#x27;&gt;,</span><span class="param">	<span class="n">precision</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">jax</span><span class="o">.</span><span class="n">_src</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">lax</span><span class="o">.</span><span class="n">Precision</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>,</span><span class="param">	<span class="n">use_extra_logit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">float32_logits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>,</span><span class="param">	<span class="n">causal_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span>,</span><span class="param">	<span class="n">query_chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1024</span>,</span><span class="param">	<span class="n">key_chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2048</span></span><span class="return-annotation">) -> <span class="n"><a href="#Array">Array</a></span>:</span></span>

                <label class="view-source-button" for="dot_product_attention_multihead-view-source"><span>View Source</span></label>

    </div>
    <a class="headerlink" href="#dot_product_attention_multihead"></a>
            <div class="pdoc-code codehilite"><pre><span></span><span id="dot_product_attention_multihead-568"><a href="#dot_product_attention_multihead-568"><span class="linenos">568</span></a><span class="k">def</span> <span class="nf">dot_product_attention_multihead</span><span class="p">(</span>
</span><span id="dot_product_attention_multihead-569"><a href="#dot_product_attention_multihead-569"><span class="linenos">569</span></a>        <span class="n">query</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-570"><a href="#dot_product_attention_multihead-570"><span class="linenos">570</span></a>        <span class="n">key</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-571"><a href="#dot_product_attention_multihead-571"><span class="linenos">571</span></a>        <span class="n">value</span><span class="p">:</span> <span class="n">Array</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-572"><a href="#dot_product_attention_multihead-572"><span class="linenos">572</span></a>        <span class="n">bias</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Array</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-573"><a href="#dot_product_attention_multihead-573"><span class="linenos">573</span></a>        <span class="n">broadcast_dropout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-574"><a href="#dot_product_attention_multihead-574"><span class="linenos">574</span></a>        <span class="n">rescale_logits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-575"><a href="#dot_product_attention_multihead-575"><span class="linenos">575</span></a>        <span class="n">dropout_rng</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">PRNGKey</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-576"><a href="#dot_product_attention_multihead-576"><span class="linenos">576</span></a>        <span class="n">dropout_rate</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-577"><a href="#dot_product_attention_multihead-577"><span class="linenos">577</span></a>        <span class="n">enable_dropout</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-578"><a href="#dot_product_attention_multihead-578"><span class="linenos">578</span></a>        <span class="n">dtype</span><span class="p">:</span> <span class="n">DType</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">float32</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-579"><a href="#dot_product_attention_multihead-579"><span class="linenos">579</span></a>        <span class="n">precision</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">lax</span><span class="o">.</span><span class="n">Precision</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-580"><a href="#dot_product_attention_multihead-580"><span class="linenos">580</span></a>        <span class="n">use_extra_logit</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-581"><a href="#dot_product_attention_multihead-581"><span class="linenos">581</span></a>        <span class="n">float32_logits</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-582"><a href="#dot_product_attention_multihead-582"><span class="linenos">582</span></a>        <span class="n">causal_mask</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-583"><a href="#dot_product_attention_multihead-583"><span class="linenos">583</span></a>        <span class="n">query_chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1024</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-584"><a href="#dot_product_attention_multihead-584"><span class="linenos">584</span></a>        <span class="n">key_chunk_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2048</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-585"><a href="#dot_product_attention_multihead-585"><span class="linenos">585</span></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
</span><span id="dot_product_attention_multihead-586"><a href="#dot_product_attention_multihead-586"><span class="linenos">586</span></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Computes dot-product multi-head attention given query, key, and value.</span>
</span><span id="dot_product_attention_multihead-587"><a href="#dot_product_attention_multihead-587"><span class="linenos">587</span></a>
</span><span id="dot_product_attention_multihead-588"><a href="#dot_product_attention_multihead-588"><span class="linenos">588</span></a><span class="sd">    This implementation is equivalent to `dense_attention.dot_product_attention`,</span>
</span><span id="dot_product_attention_multihead-589"><a href="#dot_product_attention_multihead-589"><span class="linenos">589</span></a><span class="sd">    but is more memory-efficient.</span>
</span><span id="dot_product_attention_multihead-590"><a href="#dot_product_attention_multihead-590"><span class="linenos">590</span></a>
</span><span id="dot_product_attention_multihead-591"><a href="#dot_product_attention_multihead-591"><span class="linenos">591</span></a><span class="sd">    Note: query, key, value needn&#39;t have any batch dimensions.</span>
</span><span id="dot_product_attention_multihead-592"><a href="#dot_product_attention_multihead-592"><span class="linenos">592</span></a>
</span><span id="dot_product_attention_multihead-593"><a href="#dot_product_attention_multihead-593"><span class="linenos">593</span></a><span class="sd">    Args:</span>
</span><span id="dot_product_attention_multihead-594"><a href="#dot_product_attention_multihead-594"><span class="linenos">594</span></a><span class="sd">        query: queries for calculating attention with shape of `[batch..., q_length,</span>
</span><span id="dot_product_attention_multihead-595"><a href="#dot_product_attention_multihead-595"><span class="linenos">595</span></a><span class="sd">            num_heads, qk_depth_per_head]`.</span>
</span><span id="dot_product_attention_multihead-596"><a href="#dot_product_attention_multihead-596"><span class="linenos">596</span></a><span class="sd">        key: keys for calculating attention with shape of `[batch..., kv_length,</span>
</span><span id="dot_product_attention_multihead-597"><a href="#dot_product_attention_multihead-597"><span class="linenos">597</span></a><span class="sd">            num_heads, qk_depth_per_head]`.</span>
</span><span id="dot_product_attention_multihead-598"><a href="#dot_product_attention_multihead-598"><span class="linenos">598</span></a><span class="sd">        value: values to be used in attention with shape of `[batch..., kv_length,</span>
</span><span id="dot_product_attention_multihead-599"><a href="#dot_product_attention_multihead-599"><span class="linenos">599</span></a><span class="sd">            num_heads, v_depth_per_head]`.</span>
</span><span id="dot_product_attention_multihead-600"><a href="#dot_product_attention_multihead-600"><span class="linenos">600</span></a><span class="sd">        bias: bias for the attention weights. This should be broadcastable to the</span>
</span><span id="dot_product_attention_multihead-601"><a href="#dot_product_attention_multihead-601"><span class="linenos">601</span></a><span class="sd">            shape `[batch..., num_heads, q_length, kv_length]` This can be used for</span>
</span><span id="dot_product_attention_multihead-602"><a href="#dot_product_attention_multihead-602"><span class="linenos">602</span></a><span class="sd">            incorporating causal masks, padding masks, proximity bias, etc.</span>
</span><span id="dot_product_attention_multihead-603"><a href="#dot_product_attention_multihead-603"><span class="linenos">603</span></a><span class="sd">        broadcast_dropout: bool: use a broadcasted dropout along batch dims.</span>
</span><span id="dot_product_attention_multihead-604"><a href="#dot_product_attention_multihead-604"><span class="linenos">604</span></a><span class="sd">        rescale_logits: bool. Whether to rescale `query` logits by 1/sqrt(depth_kq).</span>
</span><span id="dot_product_attention_multihead-605"><a href="#dot_product_attention_multihead-605"><span class="linenos">605</span></a><span class="sd">        dropout_rng: JAX PRNGKey: to be used for dropout</span>
</span><span id="dot_product_attention_multihead-606"><a href="#dot_product_attention_multihead-606"><span class="linenos">606</span></a><span class="sd">        dropout_rate: dropout rate</span>
</span><span id="dot_product_attention_multihead-607"><a href="#dot_product_attention_multihead-607"><span class="linenos">607</span></a><span class="sd">        enable_dropout: bool, whether to apply dropout</span>
</span><span id="dot_product_attention_multihead-608"><a href="#dot_product_attention_multihead-608"><span class="linenos">608</span></a><span class="sd">        dtype: the dtype of the computation (default: float32)</span>
</span><span id="dot_product_attention_multihead-609"><a href="#dot_product_attention_multihead-609"><span class="linenos">609</span></a><span class="sd">        precision: numerical precision of the computation see `jax.lax.Precision`</span>
</span><span id="dot_product_attention_multihead-610"><a href="#dot_product_attention_multihead-610"><span class="linenos">610</span></a><span class="sd">            for details.</span>
</span><span id="dot_product_attention_multihead-611"><a href="#dot_product_attention_multihead-611"><span class="linenos">611</span></a><span class="sd">        use_extra_logit: whether to include a virtual extra logit equal to zero.</span>
</span><span id="dot_product_attention_multihead-612"><a href="#dot_product_attention_multihead-612"><span class="linenos">612</span></a><span class="sd">        float32_logits: bool, if True then compute logits in float32 to avoid</span>
</span><span id="dot_product_attention_multihead-613"><a href="#dot_product_attention_multihead-613"><span class="linenos">613</span></a><span class="sd">            numerical issues with bfloat16.</span>
</span><span id="dot_product_attention_multihead-614"><a href="#dot_product_attention_multihead-614"><span class="linenos">614</span></a><span class="sd">        causal_mask: Apply a causal mask. This can be used alternatively or in</span>
</span><span id="dot_product_attention_multihead-615"><a href="#dot_product_attention_multihead-615"><span class="linenos">615</span></a><span class="sd">            addition to the given bias.</span>
</span><span id="dot_product_attention_multihead-616"><a href="#dot_product_attention_multihead-616"><span class="linenos">616</span></a><span class="sd">        query_chunk_size: Positive integer to control the size of the query chunks.</span>
</span><span id="dot_product_attention_multihead-617"><a href="#dot_product_attention_multihead-617"><span class="linenos">617</span></a><span class="sd">        key_chunk_size: Positive integer to control the size of the key chunks.</span>
</span><span id="dot_product_attention_multihead-618"><a href="#dot_product_attention_multihead-618"><span class="linenos">618</span></a>
</span><span id="dot_product_attention_multihead-619"><a href="#dot_product_attention_multihead-619"><span class="linenos">619</span></a><span class="sd">    Returns:</span>
</span><span id="dot_product_attention_multihead-620"><a href="#dot_product_attention_multihead-620"><span class="linenos">620</span></a><span class="sd">        Output of shape `[batch..., length, num_heads, v_depth_per_head]`.</span>
</span><span id="dot_product_attention_multihead-621"><a href="#dot_product_attention_multihead-621"><span class="linenos">621</span></a><span class="sd">    &quot;&quot;&quot;</span>
</span><span id="dot_product_attention_multihead-622"><a href="#dot_product_attention_multihead-622"><span class="linenos">622</span></a>    <span class="c1"># queries_per_head</span>
</span><span id="dot_product_attention_multihead-623"><a href="#dot_product_attention_multihead-623"><span class="linenos">623</span></a>    <span class="n">query</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>
</span><span id="dot_product_attention_multihead-624"><a href="#dot_product_attention_multihead-624"><span class="linenos">624</span></a>    <span class="k">if</span> <span class="n">bias</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
</span><span id="dot_product_attention_multihead-625"><a href="#dot_product_attention_multihead-625"><span class="linenos">625</span></a>        <span class="c1"># add num_heads, treat current num_heads dim as queries_per_head</span>
</span><span id="dot_product_attention_multihead-626"><a href="#dot_product_attention_multihead-626"><span class="linenos">626</span></a>        <span class="n">bias</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">expand_dims</span><span class="p">(</span><span class="n">bias</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">3</span><span class="p">)</span>
</span><span id="dot_product_attention_multihead-627"><a href="#dot_product_attention_multihead-627"><span class="linenos">627</span></a>    <span class="n">result</span> <span class="o">=</span> <span class="n">dot_product_attention_queries_per_head</span><span class="p">(</span>
</span><span id="dot_product_attention_multihead-628"><a href="#dot_product_attention_multihead-628"><span class="linenos">628</span></a>        <span class="n">query</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-629"><a href="#dot_product_attention_multihead-629"><span class="linenos">629</span></a>        <span class="n">key</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-630"><a href="#dot_product_attention_multihead-630"><span class="linenos">630</span></a>        <span class="n">value</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-631"><a href="#dot_product_attention_multihead-631"><span class="linenos">631</span></a>        <span class="n">bias</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-632"><a href="#dot_product_attention_multihead-632"><span class="linenos">632</span></a>        <span class="n">broadcast_dropout</span><span class="o">=</span><span class="n">broadcast_dropout</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-633"><a href="#dot_product_attention_multihead-633"><span class="linenos">633</span></a>        <span class="n">rescale_logits</span><span class="o">=</span><span class="n">rescale_logits</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-634"><a href="#dot_product_attention_multihead-634"><span class="linenos">634</span></a>        <span class="n">dropout_rng</span><span class="o">=</span><span class="n">dropout_rng</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-635"><a href="#dot_product_attention_multihead-635"><span class="linenos">635</span></a>        <span class="n">dropout_rate</span><span class="o">=</span><span class="n">dropout_rate</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-636"><a href="#dot_product_attention_multihead-636"><span class="linenos">636</span></a>        <span class="n">enable_dropout</span><span class="o">=</span><span class="n">enable_dropout</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-637"><a href="#dot_product_attention_multihead-637"><span class="linenos">637</span></a>        <span class="n">dtype</span><span class="o">=</span><span class="n">dtype</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-638"><a href="#dot_product_attention_multihead-638"><span class="linenos">638</span></a>        <span class="n">precision</span><span class="o">=</span><span class="n">precision</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-639"><a href="#dot_product_attention_multihead-639"><span class="linenos">639</span></a>        <span class="n">use_extra_logit</span><span class="o">=</span><span class="n">use_extra_logit</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-640"><a href="#dot_product_attention_multihead-640"><span class="linenos">640</span></a>        <span class="n">float32_logits</span><span class="o">=</span><span class="n">float32_logits</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-641"><a href="#dot_product_attention_multihead-641"><span class="linenos">641</span></a>        <span class="n">causal_mask</span><span class="o">=</span><span class="n">causal_mask</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-642"><a href="#dot_product_attention_multihead-642"><span class="linenos">642</span></a>        <span class="n">query_chunk_size</span><span class="o">=</span><span class="n">query_chunk_size</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-643"><a href="#dot_product_attention_multihead-643"><span class="linenos">643</span></a>        <span class="n">key_chunk_size</span><span class="o">=</span><span class="n">key_chunk_size</span><span class="p">,</span>
</span><span id="dot_product_attention_multihead-644"><a href="#dot_product_attention_multihead-644"><span class="linenos">644</span></a>    <span class="p">)</span>
</span><span id="dot_product_attention_multihead-645"><a href="#dot_product_attention_multihead-645"><span class="linenos">645</span></a>    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">squeeze</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">2</span><span class="p">)</span>  <span class="c1"># remove queries_per_head dim</span>
</span></pre></div>


            <div class="docstring"><p>Computes dot-product multi-head attention given query, key, and value.</p>

<p>This implementation is equivalent to <code>dense_attention.dot_product_attention</code>,
but is more memory-efficient.</p>

<p>Note: query, key, value needn't have any batch dimensions.</p>

<p>Args:
    query: queries for calculating attention with shape of <code>[batch..., q_length,
        num_heads, qk_depth_per_head]</code>.
    key: keys for calculating attention with shape of <code>[batch..., kv_length,
        num_heads, qk_depth_per_head]</code>.
    value: values to be used in attention with shape of <code>[batch..., kv_length,
        num_heads, v_depth_per_head]</code>.
    bias: bias for the attention weights. This should be broadcastable to the
        shape <code>[batch..., num_heads, q_length, kv_length]</code> This can be used for
        incorporating causal masks, padding masks, proximity bias, etc.
    broadcast_dropout: bool: use a broadcasted dropout along batch dims.
    rescale_logits: bool. Whether to rescale <code>query</code> logits by 1/sqrt(depth_kq).
    dropout_rng: JAX PRNGKey: to be used for dropout
    dropout_rate: dropout rate
    enable_dropout: bool, whether to apply dropout
    dtype: the dtype of the computation (default: float32)
    precision: numerical precision of the computation see <code>jax.lax.Precision</code>
        for details.
    use_extra_logit: whether to include a virtual extra logit equal to zero.
    float32_logits: bool, if True then compute logits in float32 to avoid
        numerical issues with bfloat16.
    causal_mask: Apply a causal mask. This can be used alternatively or in
        addition to the given bias.
    query_chunk_size: Positive integer to control the size of the query chunks.
    key_chunk_size: Positive integer to control the size of the key chunks.</p>

<p>Returns:
    Output of shape <code>[batch..., length, num_heads, v_depth_per_head]</code>.</p>
</div>


                </section>
    </main>
<script>
    function escapeHTML(html) {
        return document.createElement('div').appendChild(document.createTextNode(html)).parentNode.innerHTML;
    }

    const originalContent = document.querySelector("main.pdoc");
    let currentContent = originalContent;

    function setContent(innerHTML) {
        let elem;
        if (innerHTML) {
            elem = document.createElement("main");
            elem.classList.add("pdoc");
            elem.innerHTML = innerHTML;
        } else {
            elem = originalContent;
        }
        if (currentContent !== elem) {
            currentContent.replaceWith(elem);
            currentContent = elem;
        }
    }

    function getSearchTerm() {
        return (new URL(window.location)).searchParams.get("search");
    }

    const searchBox = document.querySelector(".pdoc input[type=search]");
    searchBox.addEventListener("input", function () {
        let url = new URL(window.location);
        if (searchBox.value.trim()) {
            url.hash = "";
            url.searchParams.set("search", searchBox.value);
        } else {
            url.searchParams.delete("search");
        }
        history.replaceState("", "", url.toString());
        onInput();
    });
    window.addEventListener("popstate", onInput);


    let search, searchErr;

    async function initialize() {
        try {
            search = await new Promise((resolve, reject) => {
                const script = document.createElement("script");
                script.type = "text/javascript";
                script.async = true;
                script.onload = () => resolve(window.pdocSearch);
                script.onerror = (e) => reject(e);
                script.src = "../../search.js";
                document.getElementsByTagName("head")[0].appendChild(script);
            });
        } catch (e) {
            console.error("Cannot fetch pdoc search index");
            searchErr = "Cannot fetch search index.";
        }
        onInput();

        document.querySelector("nav.pdoc").addEventListener("click", e => {
            if (e.target.hash) {
                searchBox.value = "";
                searchBox.dispatchEvent(new Event("input"));
            }
        });
    }

    function onInput() {
        setContent((() => {
            const term = getSearchTerm();
            if (!term) {
                return null
            }
            if (searchErr) {
                return `<h3>Error: ${searchErr}</h3>`
            }
            if (!search) {
                return "<h3>Searching...</h3>"
            }

            window.scrollTo({top: 0, left: 0, behavior: 'auto'});

            const results = search(term);

            let html;
            if (results.length === 0) {
                html = `No search results for '${escapeHTML(term)}'.`
            } else {
                html = `<h4>${results.length} search result${results.length > 1 ? "s" : ""} for '${escapeHTML(term)}'.</h4>`;
            }
            for (let result of results.slice(0, 10)) {
                let doc = result.doc;
                let url = `../../${doc.modulename.replaceAll(".", "/")}.html`;
                if (doc.qualname) {
                    url += `#${doc.qualname}`;
                }

                let heading;
                switch (result.doc.kind) {
                    case "function":
                        if (doc.fullname.endsWith(".__init__")) {
                            heading = `<span class="name">${doc.fullname.replace(/\.__init__$/, "")}</span>${doc.signature}`;
                        } else {
                            heading = `<span class="def">${doc.funcdef}</span> <span class="name">${doc.fullname}</span>${doc.signature}`;
                        }
                        break;
                    case "class":
                        heading = `<span class="def">class</span> <span class="name">${doc.fullname}</span>`;
                        if (doc.bases)
                            heading += `<wbr>(<span class="base">${doc.bases}</span>)`;
                        heading += `:`;
                        break;
                    case "variable":
                        heading = `<span class="name">${doc.fullname}</span>`;
                        if (doc.annotation)
                            heading += `<span class="annotation">${doc.annotation}</span>`;
                        if (doc.default_value)
                            heading += `<span class="default_value"> = ${doc.default_value}</span>`;
                        break;
                    default:
                        heading = `<span class="name">${doc.fullname}</span>`;
                        break;
                }
                html += `
                        <section class="search-result">
                        <a href="${url}" class="attr ${doc.kind}">${heading}</a>
                        <div class="docstring">${doc.doc}</div>
                        </section>
                    `;

            }
            return html;
        })());
    }

    if (getSearchTerm()) {
        initialize();
        searchBox.value = getSearchTerm();
        onInput();
    } else {
        searchBox.addEventListener("focus", initialize, {once: true});
    }

    searchBox.addEventListener("keydown", e => {
        if (["ArrowDown", "ArrowUp", "Enter"].includes(e.key)) {
            let focused = currentContent.querySelector(".search-result.focused");
            if (!focused) {
                currentContent.querySelector(".search-result").classList.add("focused");
            } else if (
                e.key === "ArrowDown"
                && focused.nextElementSibling
                && focused.nextElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.nextElementSibling.classList.add("focused");
                focused.nextElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "ArrowUp"
                && focused.previousElementSibling
                && focused.previousElementSibling.classList.contains("search-result")
            ) {
                focused.classList.remove("focused");
                focused.previousElementSibling.classList.add("focused");
                focused.previousElementSibling.scrollIntoView({
                    behavior: "smooth",
                    block: "nearest",
                    inline: "nearest"
                });
            } else if (
                e.key === "Enter"
            ) {
                focused.querySelector("a").click();
            }
        }
    });
</script></body>
</html>